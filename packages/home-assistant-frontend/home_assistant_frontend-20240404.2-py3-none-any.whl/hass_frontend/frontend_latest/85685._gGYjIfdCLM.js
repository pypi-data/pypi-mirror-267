export const id=85685;export const ids=[85685,47203];export const modules={72586:(e,t,n)=>{n.d(t,{EO:()=>c,ol:()=>i,xo:()=>l});var r=n(81830),o=n(29988),s=n(25786);const a=(e,t,n,s)=>{const a=n((0,r.A)(e,t),s);return a instanceof Date?(0,o.A)(a,t):a},i=(e,t,n,r,o)=>n.time_zone===s.Wj.server?a(e,r.time_zone,t,o):t(e,o),l=(e,t,n,r,o)=>n.time_zone===s.Wj.server?a(e,r.time_zone,t,o):t(e,o),c=(e,t,n,o,a)=>l(e,n,o,a,o.time_zone===s.Wj.server?(0,r.A)(t,a.time_zone):t)},60441:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{LW:()=>p,Xs:()=>u,fU:()=>c,ie:()=>g});var o=n(45081),s=n(47203),a=n(35163),i=n(97484),l=e([s]);s=(l.then?(await l)():l)[0];const c=(e,t,n)=>y(t,n.time_zone).format(e),y=(0,o.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{hour:"numeric",minute:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),g=(e,t,n)=>_(t,n.time_zone).format(e),_=(0,o.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{hour:(0,i.J)(e)?"numeric":"2-digit",minute:"2-digit",second:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),u=(e,t,n)=>d(t,n.time_zone).format(e),d=(0,o.A)(((e,t)=>new Intl.DateTimeFormat(e.language,{weekday:"long",hour:(0,i.J)(e)?"numeric":"2-digit",minute:"2-digit",hourCycle:(0,i.J)(e)?"h12":"h23",timeZone:(0,a.w)(e.time_zone,t)}))),p=(e,t,n)=>m(t,n.time_zone).format(e),m=(0,o.A)(((e,t)=>new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"2-digit",hour12:!1,timeZone:(0,a.w)(e.time_zone,t)})));r()}catch(e){r(e)}}))},35163:(e,t,n)=>{n.d(t,{w:()=>y});var r,o,s,a,i,l=n(25786);const c=null!==(r=null===(o=(s=Intl).DateTimeFormat)||void 0===o||null===(a=(i=o.call(s)).resolvedOptions)||void 0===a?void 0:a.call(i).timeZone)&&void 0!==r?r:"UTC",y=(e,t)=>e===l.Wj.local&&"UTC"!==c?c:t},97484:(e,t,n)=>{n.d(t,{J:()=>s});var r=n(45081),o=n(25786);const s=(0,r.A)((e=>{if(e.time_format===o.Hg.language||e.time_format===o.Hg.system){const t=e.time_format===o.Hg.language?e.language:void 0;return new Date("January 1, 2023 22:00:00").toLocaleString(t).includes("10")}return e.time_format===o.Hg.am_pm}))},47186:(e,t,n)=>{n.d(t,{$:()=>r});const r=(e,t)=>{const n={};for(const r of e){const e=t(r);e in n?n[e].push(r):n[e]=[r]}return n}},60280:(e,t,n)=>{n.d(t,{JW:()=>u,TC:()=>s,VN:()=>a,Vx:()=>i,XQ:()=>g,eM:()=>c,iH:()=>l,k3:()=>_,m4:()=>r,qf:()=>o,yv:()=>y});const r=33524==n.j?["migration_error","setup_error","setup_retry"]:null,o=33524==n.j?["not_loaded","loaded","setup_error","setup_retry"]:null,s=(e,t,n)=>{const r={type:"config_entries/subscribe"};return n&&n.type&&(r.type_filter=n.type),e.connection.subscribeMessage((e=>t(e)),r)},a=(e,t)=>{const n={};return t&&(t.type&&(n.type_filter=t.type),t.domain&&(n.domain=t.domain)),e.callWS({type:"config_entries/get",...n})},i=(e,t)=>e.callWS({type:"config_entries/get_single",entry_id:t}),l=(e,t,n)=>e.callWS({type:"config_entries/update",entry_id:t,...n}),c=(e,t)=>e.callApi("DELETE",`config/config_entries/entry/${t}`),y=(e,t)=>e.callApi("POST",`config/config_entries/entry/${t}/reload`),g=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:"user"}),_=(e,t)=>e.callWS({type:"config_entries/disable",entry_id:t,disabled_by:null}),u=(e,t)=>{const n=[...e],r=e=>{const n=t[e.domain];return"helper"===(null==n?void 0:n.integration_type)?-1:1};return n.sort(((e,t)=>r(t)-r(e)))}},41525:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.d(t,{AN:()=>x,B2:()=>E,BV:()=>S,E$:()=>j,GW:()=>D,KJ:()=>B,Q4:()=>z,RB:()=>k,WN:()=>Z,X4:()=>V,_d:()=>L,al:()=>$,bs:()=>C,c:()=>P,m7:()=>T,oU:()=>W,tb:()=>O,uh:()=>A,yM:()=>N});var o=n(30164),s=n(94365),a=n(37099),i=n(64988),l=n(57991),c=n(18892),y=n(31445),g=n(61365),_=n(93654),u=n(33246),d=n(99955),p=n(72586),m=n(60441),h=n(47186),f=n(60280),w=n(74959),b=e([m]);m=(b.then?(await b)():b)[0];const v=[],T=()=>({stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),k=()=>({stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}),A=()=>({type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}),z=()=>({type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}),W=()=>({type:"battery",stat_energy_from:"",stat_energy_to:""}),P=()=>({type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),D=()=>({type:"water",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}),S=e=>e.callWS({type:"energy/info"}),E=async e=>(await e.loadBackendTranslation("issues","energy"),e.callWS({type:"energy/validate"})),C=e=>e.callWS({type:"energy/get_prefs"}),Z=async(e,t)=>{const n=e.callWS({type:"energy/save_prefs",...t});return I(e),n},J=async(e,t,n,r,o,s="hour")=>e.callWS({type:"energy/fossil_energy_consumption",start_time:t.toISOString(),end_time:null==o?void 0:o.toISOString(),energy_statistic_ids:n,co2_statistic_id:r,period:s}),j=e=>(0,h.$)(e.energy_sources,(e=>e.type)),x=(e,t,n)=>{const r=[];for(const o of e.energy_sources)if(!n||n.includes(o.type))if("solar"!==o.type)if("gas"!==o.type&&"water"!==o.type)if("battery"!==o.type){for(const e of o.flow_from){r.push(e.stat_energy_from),e.stat_cost&&r.push(e.stat_cost);const n=t.cost_sensors[e.stat_energy_from];n&&r.push(n)}for(const e of o.flow_to){r.push(e.stat_energy_to),e.stat_compensation&&r.push(e.stat_compensation);const n=t.cost_sensors[e.stat_energy_to];n&&r.push(n)}}else r.push(o.stat_energy_from),r.push(o.stat_energy_to);else{r.push(o.stat_energy_from),o.stat_cost&&r.push(o.stat_cost);const e=t.cost_sensors[o.stat_energy_from];e&&r.push(e)}else r.push(o.stat_energy_from);return n&&!n.includes("device")||r.push(...e.device_consumption.map((e=>e.stat_consumption))),r},H=async(e,t,n,r,g)=>{const[_,u]=await Promise.all([(0,f.VN)(e,{domain:"co2signal"}),S(e)]),d=_.length?_[0]:void 0;let m;if(d)for(const t of Object.values(e.entities)){if("co2signal"!==t.platform)continue;const n=e.states[t.entity_id];if(n&&"%"===n.attributes.unit_of_measurement){m=n.entity_id;break}}const h=[];for(const e of t.energy_sources)if("grid"===e.type)for(const t of e.flow_from)h.push(t.stat_energy_from);const b=x(t,u,["grid","solar","battery","gas","device"]),v=x(t,u,["water"]),T=[...b,...v],k=(0,o.A)(r||new Date,n),A=k>35?"month":k>2?"day":"hour",z=e.config.unit_system.length||"",W={energy:"kWh",volume:"km"===z?"m続":"ft続"},P={volume:"km"===z?"L":"gal"},D=b.length?(0,w.sz)(e,n,r,b,A,W,["change"]):{},E=v.length?(0,w.sz)(e,n,r,v,A,P,["change"]):{};let C,Z,j,H,I,M={},O={};g&&(Z=(0,p.xo)(n,s.A,e.locale,e.config)&&(0,p.xo)(r||new Date,a.A,e.locale,e.config)?(0,p.ol)(n,i.A,e.locale,e.config,-(0,p.EO)(r||new Date,n,l.A,e.locale,e.config)-1):(0,p.ol)(n,c.A,e.locale,e.config,-1*(k+1)),j=(0,y.A)(n,-1),b.length&&(M=(0,w.sz)(e,Z,j,b,A,W,["change"])),v.length&&(O=(0,w.sz)(e,Z,j,v,A,P,["change"]))),void 0!==m&&(H=J(e,n,h,m,r,k>35?"month":k>2?"day":"hour"),g&&(I=J(e,Z,h,m,j,k>35?"month":k>2?"day":"hour")));const $={},F=T.length?(0,w.Wr)(e,T):[],[L,B,N,V,U,X,K]=await Promise.all([D,E,M,O,F,H,I]),q={...L,...B};g&&(C={...N,...V}),T.length&&U.forEach((e=>{$[e.statistic_id]=e}));return{start:n,end:r,startCompare:Z,endCompare:j,info:u,prefs:t,stats:q,statsMetadata:$,statsCompare:C,co2SignalConfigEntry:d,co2SignalEntity:m,fossilEnergyConsumption:X,fossilEnergyConsumptionCompare:K}},I=e=>{v.forEach((t=>{const n=O(e,{key:t});n.clearPrefs(),n._active&&n.refresh()}))},M=e=>{if(e._refreshTimeout&&clearTimeout(e._refreshTimeout),e._active&&(!e.end||e.end>new Date)){const t=new Date;t.getMinutes()>=20&&t.setHours(t.getHours()+1),t.setMinutes(20,0,0),e._refreshTimeout=window.setTimeout((()=>e.refresh()),t.getTime()-Date.now())}},O=(e,t={})=>{let n="_energy";if(t.key){if(!t.key.startsWith("energy_"))throw new Error("Key need to start with energy_");n=`_${t.key}`}if(e.connection[n])return e.connection[n];v.push(t.key);const r=(0,d.X)(e.connection,n,(async()=>(r.prefs||(r.prefs=await C(e)),M(r),H(e,r.prefs,r.start,r.end,r.compare)))),o=r.subscribe;r.subscribe=e=>{const t=o(e);return r._active++,void 0===r._refreshTimeout&&M(r),()=>{r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),t()}},r._active=0,r.prefs=t.prefs;const s=new Date,a=(0,m.LW)(s,e.locale,e.config).split(":")[0];r.start=(0,p.ol)("0"===a?(0,c.A)(s,-1):s,g.A,e.locale,e.config),r.end=(0,p.ol)("0"===a?(0,c.A)(s,-1):s,_.A,e.locale,e.config);const i=()=>{r._updatePeriodTimeout=window.setTimeout((()=>{r.start=(0,p.ol)(new Date,g.A,e.locale,e.config),r.end=(0,p.ol)(new Date,_.A,e.locale,e.config),i()}),(0,u.A)((0,p.ol)(s,_.A,e.locale,e.config),1).getTime()-Date.now())};return i(),r.clearPrefs=()=>{r.prefs=void 0},r.setPeriod=(t,n)=>{var o;r.start=t,r.end=n,r.start.getTime()!==(0,p.ol)(new Date,g.A,e.locale,e.config).getTime()||(null===(o=r.end)||void 0===o?void 0:o.getTime())!==(0,p.ol)(new Date,_.A,e.locale,e.config).getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):i()},r.setCompare=e=>{r.compare=e},r},$=e=>e.callWS({type:"energy/solar_forecast"}),F=["volume","energy"],L=(e,t={},n)=>{for(const r of e.energy_sources){if("gas"!==r.type)continue;if(n&&n===r.stat_energy_from)continue;const e=t[r.stat_energy_from];if(F.includes(null==e?void 0:e.unit_class))return e.unit_class}},B=(e,t,n={})=>{const r=L(t,n);if(void 0!==r)return"energy"===r?"kWh":"km"===e.config.unit_system.length?"m続":"ft続"},N=e=>"km"===e.config.unit_system.length?"L":"gal",V="/docs/energy/faq/#troubleshooting-missing-entities";r()}catch(e){r(e)}}))},85685:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.r(t),n.d(t,{EnergyViewStrategy:()=>y});var o=n(62659),s=n(40924),a=n(18791),i=n(41525),l=e([i]);i=(l.then?(await l)():l)[0];const c=async()=>(await Promise.all([n.e(40806),n.e(54644),n.e(2948)]).then(n.bind(n,75642)),{type:"panel",cards:[{type:"custom:energy-setup-wizard-card"}]});let y=(0,o.A)([(0,a.EM)("energy-view-strategy")],(function(e,t){return{F:class extends t{constructor(...t){super(...t),e(this)}},d:[{kind:"method",static:!0,key:"generate",value:async function(e,t){const n={cards:[]};let r;try{r=await(0,i.bs)(t)}catch(e){return"not_found"===e.code?c():(n.cards.push({type:"markdown",content:`An error occurred while fetching your energy preferences: ${e.message}.`}),n)}n.type="sidebar";const o=r.energy_sources.find((e=>"grid"===e.type)),s=o&&o.flow_to.length,a=r.energy_sources.some((e=>"solar"===e.type)),l=r.energy_sources.some((e=>"gas"===e.type)),y=r.energy_sources.some((e=>"water"===e.type));return n.cards.push({type:"energy-compare",collection_key:"energy_dashboard"}),o&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_usage_graph_title"),type:"energy-usage-graph",collection_key:"energy_dashboard"}),a&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_solar_graph_title"),type:"energy-solar-graph",collection_key:"energy_dashboard"}),l&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_gas_graph_title"),type:"energy-gas-graph",collection_key:"energy_dashboard"}),y&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_water_graph_title"),type:"energy-water-graph",collection_key:"energy_dashboard"}),o&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_distribution_title"),type:"energy-distribution",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),(o||a)&&n.cards.push({title:t.localize("ui.panel.energy.cards.energy_sources_table_title"),type:"energy-sources-table",collection_key:"energy_dashboard"}),s&&n.cards.push({type:"energy-grid-neutrality-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),a&&s&&(n.cards.push({type:"energy-solar-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),n.cards.push({type:"energy-self-sufficiency-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"})),o&&n.cards.push({type:"energy-carbon-consumed-gauge",view_layout:{position:"sidebar"},collection_key:"energy_dashboard"}),r.device_consumption.length&&(n.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_detail_graph_title"),type:"energy-devices-detail-graph",collection_key:"energy_dashboard"}),n.cards.push({title:t.localize("ui.panel.energy.cards.energy_devices_graph_title"),type:"energy-devices-graph",collection_key:"energy_dashboard"})),n}}]}}),s.mN);r()}catch(e){r(e)}}))},47203:(e,t,n)=>{n.a(e,(async(e,r)=>{try{n.r(t);var o=n(68079),s=n(11703),a=n(3444),i=n(67558),l=n(86935),c=n(39083),y=n(50644),g=n(29051),_=n(73938),u=n(12139);const e=async()=>{const e=(0,_.wb)(),t=[];(0,a.Z)()&&await Promise.all([n.e(92997),n.e(63964)]).then(n.bind(n,63964)),(0,l.Z)()&&await Promise.all([n.e(63789),n.e(92997),n.e(63833)]).then(n.bind(n,63833)),(0,o.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(15105)]).then(n.bind(n,15105)).then((()=>(0,u.T)()))),(0,s.Z6)(e)&&t.push(Promise.all([n.e(63789),n.e(62713)]).then(n.bind(n,62713))),(0,i.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(53506)]).then(n.bind(n,53506))),(0,c.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(49693)]).then(n.bind(n,49693))),(0,y.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(29596)]).then(n.bind(n,29596)).then((()=>n.e(5224).then(n.t.bind(n,5224,23))))),(0,g.Z)(e)&&t.push(Promise.all([n.e(63789),n.e(30317)]).then(n.bind(n,30317))),0!==t.length&&await Promise.all(t).then((()=>(0,u.K)(e)))};await e(),r()}catch(e){r(e)}}),1)}};
//# sourceMappingURL=85685._gGYjIfdCLM.js.map