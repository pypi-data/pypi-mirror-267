export const id=31770;export const ids=[31770];export const modules={72113:(t,e,a)=>{a.a(t,(async(t,s)=>{try{a.d(e,{o:()=>p});var i=a(28945),n=a(30164),o=a(18771),d=a(33246),r=a(56601),c=a(77396),h=a(60441),l=t([c,h]);function u(t,e){let a=new Date(e);return t>2&&0===a.getHours()&&(a=(0,i.A)(a,1)),a.setMinutes(0,0,0),t>35&&a.setDate(1),t>2&&a.setHours(0),a.getTime()}function p(t,e,a,s,i,l,p){const _=(0,n.A)(e,t),k=void 0!==l&&void 0!==p;if(k&&_<=35){const a=(0,o.A)(e,t),s=(0,o.A)(p,l);s>a?e=(0,d.A)(e,s-a):a>s&&(p=(0,d.A)(p,a-s))}const m={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:u(_,e),adapters:{date:{locale:a,config:s}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:_>35?"monthyear":_>7?"date":_>2?"weekday":_>0?"datetime":"hour",minUnit:_>35?"month":_>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:i},ticks:{beginAtZero:!0,callback:t=>(0,r.ZV)(Math.abs(t),a)}}},plugins:{tooltip:{position:"nearest",filter:t=>"0"!==t.formattedValue,itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:t=>{if(_>0)return t[0].label;const e=new Date(t[0].parsed.x);return`${k?`${(0,c.sl)(e,a,s)}: `:""}${(0,h.fU)(e,a,s)} â€“ ${(0,h.fU)((0,d.A)(e,1),a,s)}`},label:t=>`${t.dataset.label}: ${(0,r.ZV)(t.parsed.y,a)} ${i}`}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,r.Yf)(a)};return k&&(m.scales.xAxisCompare={...m.scales.x,suggestedMin:l.getTime(),max:u(_,p),display:!1}),m}[c,h]=l.then?(await l)():l,s()}catch(_){s(_)}}))},31770:(t,e,a)=>{a.a(t,(async(t,s)=>{try{a.r(e),a.d(e,{HuiEnergyDevicesDetailGraphCard:()=>v});var i=a(62659),n=a(65674),o=a(4185),d=a(40924),r=a(18791),c=a(69760),h=a(45081),l=a(76502),u=(a(54373),a(41525)),p=a(74959),_=a(94027),k=a(15821),m=a(72113),f=t([u,m]);[u,m]=f.then?(await f)():f;const g="kWh";let v=(0,i.A)([(0,r.EM)("hui-energy-devices-detail-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_chartData",value:()=>({datasets:[]})},{kind:"field",decorators:[(0,r.wk)()],key:"_chartDatasetExtra",value:()=>[]},{kind:"field",decorators:[(0,r.wk)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_start",value:()=>(0,n.A)()},{kind:"field",decorators:[(0,r.wk)()],key:"_end",value:()=>(0,o.A)()},{kind:"field",decorators:[(0,r.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_hiddenStats",value:()=>new Set},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){var t;return[(0,u.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,k.xP)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?d.qy` <ha-card> ${this._config.title?d.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,c.H)({"has-header":!!this._config.title})}"> <ha-chart-base externalHidden .hass="${this.hass}" .data="${this._chartData}" .extraData="${this._chartDatasetExtra}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,g,this._compareStart,this._compareEnd)}" chart-type="bar" @dataset-hidden="${this._datasetHidden}" @dataset-unhidden="${this._datasetUnhidden}"></ha-chart-base> </div> </ha-card> `:d.s6}},{kind:"method",key:"_datasetHidden",value:function(t){t.stopPropagation(),this._hiddenStats.add(this._data.prefs.device_consumption[t.detail.index].stat_consumption),this.requestUpdate("_hiddenStats")}},{kind:"method",key:"_datasetUnhidden",value:function(t){t.stopPropagation(),this._hiddenStats.delete(this._data.prefs.device_consumption[t.detail.index].stat_consumption),this.requestUpdate("_hiddenStats")}},{kind:"field",key:"_createOptions",value:()=>(0,h.A)(((t,e,a,s,i,n,o)=>{const d=(0,m.o)(t,e,a,s,i,n,o);return{...d,interaction:{mode:"nearest"},plugins:{...d.plugins,legend:{display:!0,labels:{usePointStyle:!0}}}}}))},{kind:"method",key:"_processStatistics",value:function(){const t=this._data,e=t.stats,a=t.statsCompare,s=getComputedStyle(this),i={};t.prefs.device_consumption.forEach((t=>{const a=t.stat_consumption in e&&(0,p.$j)(e[t.stat_consumption])||0;i[t.stat_consumption]=a}));const n=t.prefs.device_consumption.map((t=>t.stat_consumption));n.sort(((t,e)=>i[e]-i[t]));const d=[],r=[],{data:c,dataExtras:h}=this._processDataSet(s,e,t.statsMetadata,t.prefs.device_consumption,n);if(d.push(...c),r.push(...h),a){d.push({order:0,data:[]}),r.push({show_legend:!1}),d.push({order:999,data:[],xAxisID:"xAxisCompare"}),r.push({show_legend:!1});const{data:e,dataExtras:i}=this._processDataSet(s,a,t.statsMetadata,t.prefs.device_consumption,n,!0);d.push(...e),r.push(...i)}this._start=t.start,this._end=t.end||(0,o.A)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:d},this._chartDatasetExtra=r}},{kind:"method",key:"_processDataSet",value:function(t,e,a,s,i,n=!1){const o=[],d=[];return s.forEach(((s,r)=>{var c;const h=(0,l.fI)(r,t);let u=null;const _=[];if(s.stat_consumption in e){const t=e[s.stat_consumption];let a;for(const e of t){if(null===e.change||void 0===e.change)continue;if(u===e.start)continue;const t=new Date(e.start);_.push({x:t.getTime(),y:e.change}),u=e.start,a=e.end}1===_.length&&_.push({x:a,y:0})}const k=i.indexOf(s.stat_consumption),m=!!(null!==(c=this._config)&&void 0!==c&&c.max_devices&&k>=this._config.max_devices);o.push({label:(0,p.$O)(this.hass,s.stat_consumption,a[s.stat_consumption]),hidden:this._hiddenStats.has(s.stat_consumption)||m,borderColor:n?h+"7F":h,backgroundColor:n?h+"32":h+"7F",data:_,order:1+k,stack:"devices",pointStyle:!n&&"circle",xAxisID:n?"xAxisCompare":void 0}),d.push({show_legend:!n&&!m})})),{data:o,dataExtras:d}}},{kind:"get",static:!0,key:"styles",value:function(){return d.AH`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`}}]}}),(0,_.E)(d.WF));s()}catch(t){s(t)}}))}};
//# sourceMappingURL=31770.PJ8sAPVNQSA.js.map