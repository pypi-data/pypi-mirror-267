# 
# This package is managed using Hatch: a modern, extensible Python project manager.
#
# > Additional Hatch-config for this project is in "pyproject.toml"
# 
# > See [Hatch Documentation](https://hatch.pypa.io/latest/).
#

[version]
path = "src/uologging/__init__.py"

[envs.env-vars]
HATCH_ENV_TYPE_VIRTUAL_PATH = "./venv"

[build.hooks.custom]  # See "hatch_build.py"

[build.targets.sdist]
[build.targets.wheel]


#
# "dev" environment: For developers who want to update this code base.
#
# EXAMPLE: Create dev environment, then enter dev shell
#  hatch env create dev
#  hatch --env dev shell
#
# EXAMPLE: Update dev environment
#  > Prequisite: kill any active shells (e.g. spawned via `hatch --env dev shell`).
#  hatch env remove dev
#  hatch env create dev
# 
# EXAMPLE: Run all the tests! This (roughly) ensures that cicd:test will succeed
#  hatch run dev:test
#
# EXAMPLE: Run all the tests, with code-coverage reports!
#  hatch run dev:test-coverage
#
[envs.default]
python = "3.8"
dependencies = [
  "pytest",
  "pytest-coverage",
  "assertpy",
  "autopep8",
  "isort",
  "flake8",
  "hatchling",
]

[envs.default.scripts]
test = "pytest --doctest-modules"
coveragee = "coverage run -m pytest --doctest-modules tests && coverage xml; coverage html;"

#
# "docs" environment: For viewing "docs/" directory, rendered by MkDocs.
# 
# EXAMPLE: Enable viewing docs at https://localhost:8000
#  hatch run docs:serve
#
# EXAMPLE: Build docs into an HTML static website.
#  hatch run docs:build
#
[envs.docs]
dependencies = [
  "mkdocs",
  "mkdocs-material",
]

[envs.docs.scripts]
build = "mkdocs build --clean --strict"
serve = "mkdocs serve --dev-addr localhost:8000"

#
# "cicd" environment: For Continuous Integration and Delivery (CICD) pipelines.
#
# EXAMPLE: Run tests in the context of CICD. Produces test_report.xml for junit report-readers.
#  hatch run cicd:test
#
[envs.cicd]
dependencies = [
  "coverage",
  "pytest",
  "pytest-vcr",
  "assertpy",
  "hatchling",
]

[[envs.cicd.matrix]]
python = ["38", "39", "311"]


[envs.cicd.scripts]
# TODO can we make the xml file name based on the matrix?
test = "pytest --doctest-modules --vcr-record=none --junitxml=test_report.xml src/ tests/"
cov = 'coverage run -m pytest --doctest-modules --junitxml=test_report.xml src/ tests/ && coverage xml --omit="tests/*"'
infer-package-name = "echo uologging"

[envs.cicd.env-vars]
CI = "True"


#
# ! NOTICE: Before using py36, first create python3.6 virtual environment.
#
# Example: Run tests with coverage for python 3.6
#
#   python3.6 -m venv venv36
#   source venv36/bin/activate
#   pip install -e .
#   hatch run py36:cov
#
[envs.py36]
# ! python = "3.6"
path = "./venv36"
type = "virtual"
dependencies = [
  "coverage",
  "pytest",
  "pytest-vcr",
  "assertpy",
  "hatchling",
]

[envs.py36.scripts]
ver = 'python --version'
cov = 'coverage run -m pytest --doctest-modules --junitxml=test_report.xml src/ tests/ && coverage xml --omit="tests/*"'
