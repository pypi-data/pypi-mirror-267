# See: gitlab-foss/lib/gitlab/ci/templates/Python.gitlab-ci.yml
---
image: python:bookworm

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

cache:
  paths:
    - .cache/pip
    - venv/

before_script:
  - python --version
  - python -m venv venv/
  - source venv/bin/activate
  - pip install --editable ".[test]"

test:
  script:
    - make test
    - coverage xml -q
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage.xml
  coverage: '/TOTAL *(?:\d+) *(?:\d+) *(?:\d+) *(?:\d+) *(\d+%)/'

lint:
  script:
    - make lint
