# -*- mode: conf -*-
# This file has been automatically generated by `webdomains`. For any changes
# or local configuration, you should use the following directory instead:
#   {{ domain.local_conf_dir }}

{% if protocol is eq "https" -%}
server {
  listen 80;
  listen [::]:80;

  # Name and aliases of the server
  server_name {{ domain.server_name }};

  # Serve the ACME challenge for Let's Encrypt
  include snippets/acme-challenge.conf;

  # Redirect everything to HTTPS
  location / { return 302 https://$server_name$request_uri; }
}

{% endif %}
server {
  {% if protocol is ne "https" -%}
  listen 80;
  listen [::]:80;
  {% endif %}

  {%- if protocol is ne "http" -%}
  listen 443 ssl;
  listen [::]:443 ssl;

  # SSL/TLS configuration
  ssl_certificate         {{ domain.certs_dir }}/fullchain.pem;
  ssl_certificate_key     {{ domain.certs_dir }}/privkey.pem;
  ssl_trusted_certificate {{ domain.certs_dir }}/chain.pem;
  {% endif %}

  # Name and aliases of the server
  server_name {{ domain.server_name }};

  # Serve the ACME challenge for Let's Encrypt
  include snippets/acme-challenge.conf;

  # Access and error logs
  access_log {{ domain.log_dir }}/access.log;
  error_log {{ domain.log_dir }}/error.log;

  # Include local configuration
  include {{ domain.local_conf_dir }}/*.conf;
}

# Variables for the template rendering, do not edit.
## template_name=server.conf
## template_version=1
## protocol={{ domain.protocol.name }}
