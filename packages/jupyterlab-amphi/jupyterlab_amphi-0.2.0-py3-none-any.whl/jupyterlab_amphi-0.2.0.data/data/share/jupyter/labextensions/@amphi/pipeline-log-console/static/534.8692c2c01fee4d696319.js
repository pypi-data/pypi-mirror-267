"use strict";(self.webpackChunk_amphi_pipeline_log_console=self.webpackChunk_amphi_pipeline_log_console||[]).push([[534],{534:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var n=s(638),o=s(465),i=s(723),a=s(664),r=s(881),l=s(602);class c{constructor(e){this._isDisposed=!1,this._disposed=new l.Signal(this),this._rendermime=null,this._connector=e}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get rendermime(){return this._rendermime}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),l.Signal.clearData(this))}}class d extends c{constructor(e){var t;super(e.connector),this._id=e.id,this._rendermime=null!==(t=e.rendermime)&&void 0!==t?t:null,this._ready=this._connector.ready,this._connector.kernelRestarted.connect(((e,t)=>{this._ready=this._connector.ready}))}get id(){return this._id}get ready(){return this._ready}}class h{constructor(e){this._kernelRestarted=new l.Signal(this),this._session=e.session,this._session.statusChanged.connect(((e,t)=>{switch(t){case"restarting":case"autorestarting":this._kernelRestarted.emit(this._session.ready)}}))}get kernelRestarted(){return this._kernelRestarted}get kernelLanguage(){var e;return(null===(e=this._session.session)||void 0===e?void 0:e.kernel)?this._session.session.kernel.info.then((e=>e.language_info.name)):Promise.resolve("")}get kernelName(){return this._session.kernelDisplayName}get ready(){return this._session.ready}get iopubMessage(){return this._session.iopubMessage}}var p,u=s(256);class m extends u.Widget{constructor(){super(),this._source=null,this.addClass("amphi-MetadataPanel"),this._title=p.createTitle(),this._title.className="amphi-MetadataPanel-title",this._console=p.createConsole(),this._console.className="amphi-MetadataPanel-table",this.node.appendChild(this._title),this.node.appendChild(this._console)}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this.onSourceDisposed,this),this._source=e,this._source&&this._source.disposed.connect(this.onSourceDisposed,this))}dispose(){this.isDisposed||(this.source=null,super.dispose())}onNewLog(e,t,s){if(!this.isAttached)return;this._console.tFoot||(this._console.createTFoot(),this._console.tFoot.className="amphi-MetadataPanel-content");let n=this._console.tFoot.insertRow(0);switch(n.className="amphi-MetadataPanel-table-row fade-background-transition",t){case"info":n.style.backgroundColor="#e5f6ff";break;case"error":n.style.backgroundColor="#ffd7d9";break;case"data":n.style.backgroundColor="white"}n.style.transition="background-color 1s ease-in-out";let o=n.insertCell(0);o.innerHTML=e,o.className="amphi-MetadataPanel-date",o=n.insertCell(1),o.innerHTML=s,this._console.parentElement.scrollTop=0,setTimeout((()=>{n.style.backgroundColor=""}),3e3)}onSourceDisposed(e,t){this.source=null}}!function(e){const t=new Map(Object.entries({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}));e.escapeHtml=function(e){return String(e).replace(/[&<>"'/]/g,(e=>t.get(e)))},e.createConsole=function(){return document.createElement("table")},e.createTitle=function(e=""){const t=document.createElement("p");return t.innerHTML=e,t}}(p||(p={}));class _{constructor(){this._source=null,this._panel=null,this._handlers={}}hasHandler(e){return!!this._handlers[e]}getHandler(e){return this._handlers[e]}addHandler(e){this._handlers[e.id]=e}get panel(){return this._panel}set panel(e){this.panel!==e&&(this._panel=e,e&&!e.source&&(e.source=this._source))}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this._onSourceDisposed,this),this._source=e,this._panel&&!this._panel.isDisposed&&(this._panel.source=this._source),this._source&&this._source.disposed.connect(this._onSourceDisposed,this))}_onSourceDisposed(){this._source=null}}var g=s(262);const y=new g.Token("jupyterlab_extension/logconsole:IPipelineConsoleManager");var f;new g.Token("jupyterlab_extension/logconsole:IPipelineConsole"),function(e){e.open="pipeline-console:open"}(f||(f={}));const k=[{id:"@amphi/pipeline-log-console",requires:[n.ICommandPalette,o.ILayoutRestorer,o.ILabShell],provides:y,autoStart:!0,activate:(e,t,s,o)=>{const i=new _,r=f.open,l=new n.WidgetTracker({namespace:"pipeline-console"});return s.restore(l,{command:r,args:()=>({}),name:()=>"amphi-logConsole"}),e.commands.addCommand(r,{label:"Pipeline Console",execute:()=>{let t=null;for(const s of e.shell.widgets("main"))if("amphi-metadataPanel"===s.id){t=s;break}i.panel&&!i.panel.isDisposed||(i.panel=function(){const e=new m;return e.id="amphi-logConsole",e.title.label="Pipeline Console",e.title.icon=a.listIcon,e.title.closable=!0,e.disposed.connect((()=>{i.panel===e&&(i.panel=null)})),l.add(e),e}()),t&&t.isAttached?i.panel.isAttached||e.shell.add(i.panel,"main",{ref:t.id,mode:"tab-after"}):i.panel.isAttached||e.shell.add(i.panel,"main",{mode:"split-bottom"}),e.shell.activateById(i.panel.id)}}),t.addItem({command:r,category:"Pipeline Console"}),console.log("JupyterLab extension @amphi/pipeline-log-console is activated!"),i}},{id:"@amphi/pipeline-log-console:pipelines",requires:[y,r.IPipelineTracker,o.ILabShell],autoStart:!0,activate:(e,t,s,o)=>{const a={};function r(e){const t=new Date(e);return`${t.toLocaleDateString()}\n${t.toLocaleTimeString()}`}s.widgetAdded.connect(((e,s)=>{t.hasHandler(s.context.sessionContext.path)?a[s.id]=new Promise(((e,n)=>{e(t.getHandler(s.context.sessionContext.path))})):a[s.id]=new Promise(((e,o)=>{const l=s.context.sessionContext,c=new h({session:l}),p={connector:c,id:l.path},u=new d(p);t.addHandler(u),s.disposed.connect((()=>{delete a[s.id],u.dispose()})),u.ready.then((()=>{e(u),c.ready.then((async()=>{l.session.kernel.anyMessage.connect(((e,s)=>{if(t.panel&&"recv"===s.direction)if("execute_result"===s.msg.header.msg_type||"display_data"===s.msg.header.msg_type){const e=s.msg.content;if(e.data["text/html"]){const n=`<div class="display_data">${e.data["text/html"]}</div>`;t.panel.onNewLog(r(s.msg.header.date),"data",n)}}else if("stream"===s.msg.header.msg_type){const e=s.msg;if(e.content.text&&"\n"!==e.content.text){const o=document.createElement("div"),a={host:o,source:e.content.text,sanitizer:new n.Sanitizer};(0,i.renderText)(a).then((()=>{const e=o.outerHTML;t.panel.onNewLog(r(s.msg.header.date),"info",e)}))}}else if("error"===s.msg.header.msg_type){const e=s.msg,o=e.content.traceback.join("\n"),a=`traceback-${Date.now()}`,l=document.createElement("div"),c=`${e.content.evalue}`;l.innerHTML=`<pre><span>${c}</span><br><a href="#" style="text-decoration: underline; color: grey;" id="link-${a}" onClick="document.getElementById('${a}').style.display = document.getElementById('${a}').style.display === 'none' ? 'block' : 'none'; return false;">Show Traceback</a></pre>`;const d=document.createElement("pre");d.id=a,d.style.display="none",l.appendChild(d);const h={host:d,source:o,sanitizer:new n.Sanitizer};(0,i.renderText)(h).then((()=>{const s=l.outerHTML;t.panel.onNewLog(r(e.header.date),"error",s)}))}}))}))}))})),l(o)}));const l=(e,n)=>{var o;const i=null!==(o=null==n?void 0:n.newValue)&&void 0!==o?o:e.currentWidget;i&&s.has(i)&&a[i.id].then((e=>{e&&(t.source=e)}))};l(o),o.currentChanged.connect(l)}}]}}]);