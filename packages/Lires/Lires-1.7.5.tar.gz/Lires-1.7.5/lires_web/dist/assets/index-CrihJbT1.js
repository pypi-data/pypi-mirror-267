var Tt=Object.defineProperty;var Ut=(o,t,e)=>t in o?Tt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var X=(o,t,e)=>(Ut(o,typeof t!="symbol"?t+"":t,e),e);import{d as L,f as R,B as y,C as me,D as ee,E as c,o as ve,G as Rt,H as n,c as x,I as T,w as se,a as w,F as N,J as Q,z as I,K,L as B,M as E,N as Je,O as M,P as At,Q as Bt,R as ne,S as ae,U as ft,V as mt,W as he,X as z,Y as Ze,Z,_ as Qe,$ as We,a0 as Ue,a1 as Re,a2 as Lt,n as Mt,a3 as Ge,a4 as Fe,a5 as qt}from"./@vue-4wI8zz7n.js";import{d as ze,c as Et}from"./pinia-r7fimHge.js";import{u as we,a as vt,c as Ft,b as Ot}from"./vue-router-BYu70c8g.js";import{M as zt}from"./async-mutex-CSJywVGb.js";import{f as Ht}from"./fast-xml-parser-CJG3bOwu.js";import{P as je}from"./plotly.js-dist-DSnwt6vs.js";import{E as Nt,M as Wt}from"./md-editor-v3-J5qE__94.js";import{m as jt}from"./gray-matter-Blu0OJBL.js";import"./vite-plugin-node-polyfills-C8Q2m4YJ.js";import"./strnum-u8jQhLSb.js";import"./copy-to-clipboard-B1uT6SkR.js";import"./toggle-selection-BHUZwh74.js";import"./@vavt-B4fzJ49s.js";import"./@codemirror-A36Vwj5Y.js";import"./@lezer-C8l2HfTs.js";import"./style-mod-Bc2inJdb.js";import"./w3c-keyname-Vcq4gwWv.js";import"./medium-zoom-CHfgT04g.js";import"./markdown-it-DI8MEbma.js";import"./mdurl-k9Sl0PQj.js";import"./uc.micro-kMc2yuuw.js";import"./entities-C20TfXL6.js";import"./linkify-it-DmNjr4Kv.js";import"./punycode.js-Dj65hjkv.js";import"./markdown-it-image-figures-BD49Kf-b.js";import"./markdown-it-task-lists-BNI9E7ji.js";import"./markdown-it-xss-DEpVfk-m.js";import"./xss-DnjGkJ2-.js";import"./cssfilter-BjxKUPhv.js";import"./node-stdlib-browser-d7cmxmpa.js";import"./section-matter-DWrNKXO4.js";import"./kind-of-l3izQsJJ.js";import"./extend-shallow-DA8A8LGH.js";import"./is-extendable-CiA4f1iz.js";import"./js-yaml-B7yGoGZD.js";import"./strip-bom-string-BxrG9K6S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();const Vt=L({__name:"Popup",props:{styleType:{default:"info"},position:{default:"top-center"}},setup(o){const t=o,e=R(()=>t.styleType==="alert"||t.styleType==="error"?{backgroundColor:"rgba(180, 0, 20, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="warning"?{backgroundColor:"rgba(210, 150, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="info"?{backgroundColor:"rgba(0, 0, 0, 0.75)",color:"rgba(255, 255, 255, 1)"}:t.styleType==="success"?{backgroundColor:"rgba(0, 180, 0, 0.9)",color:"rgba(255, 255, 255, 1)"}:{backgroundColor:"rgba(0, 0, 0, 0.5)",color:"var(--color-text)"}),a=R(()=>{if(t.position==="top-center")return{top:"30px",left:"50%",transform:"translate(-50%, 0)"};if(t.position==="center")return{top:"50%",left:"50%",transform:"translate(-50%, -50%)"};throw Error("Incorrect style.")});return(s,i)=>(c(),y("div",{id:"popup",style:ee({...e.value,...a.value})},[me(s.$slots,"default",{},void 0,!0)],4))}}),O=(o,t)=>{const e=o.__vccOpts||o;for(const[a,s]of t)e[a]=s;return e},rt=O(Vt,[["__scopeId","data-v-e0ba6b84"]]),re="->";class H extends Set{static removeSpaces(t){const e=t.split(re);for(let a=0;a<e.length;a++)e[a]=e[a].trim();return t=e.join(re),t}constructor(t=null){t===null&&(t=[]);const e=t instanceof Set?t:new Set(t);e.forEach(a=>H.removeSpaces(a)),super(e)}copy(){return new H(this)}add(t){return super.add(H.removeSpaces(t))}has(t){return super.has(H.removeSpaces(t))}union(t){const e=new H(this);return e.union_(t),e}union_(t){return t.forEach(e=>this.add(e)),this}pop(t){const e=new H(this);return e.pop_(t),e}pop_(t){return t.forEach(e=>this.delete(e)),this}pop_ifcontains_(t){return t.forEach(e=>{this.has(e)&&this.delete(e)}),this}issubset(t){return De.isSubset(this,t)}withParents(){const t=new H(this);return this.forEach(e=>t.union_(De.allParentsOf(e))),t}withChildsFrom(t){const e=new H(this);return this.forEach(a=>e.union_(De.allChildsOf(a,t))),e}allParents(){const t=new H;return this.forEach(e=>t.union_(De.allParentsOf(e))),t}toArray(){return Array.from(this)}}class De{static allParentsOf(t){const e=t.split(re);if(e.length===1)return new H([]);const a=[],s=[];for(let i=0;i<e.length-1;i++)a.push(e[i]),s.push(a.join(re));return new H(s)}static allChildsOf(t,e){const a=new H;for(const s of e)s.startsWith(t)&&s.length>t.length+re.length&&s.substring(t.length,t.length+re.length)===`${re}`&&a.add(s);return a}static tagHierarchy(t){const e=re;function a(l,r){const d=l.split(r);return d.length===1?[l]:[d[0],d.slice(1).join(r)]}function s(l,r=e){const d={},g=l.map(p=>a(p,r));for(const p of g)p[0]in d||(d[p[0]]=[]),p.length===2&&d[p[0]].push(p[1]);const u={};for(const p in d)u[p]=s(d[p],r);return u}function i(l,r=e){for(const d in l){const g=l[d];for(const u in g){const p=[d,u].join(e);g[p]=g[u],delete g[u]}i(g,r)}return l}return i(s(Array.from(t)))}static isSubset(t,e){let a=!0;for(const s of t)if(!e.has(s)){a=!1;break}return a}}class Ie{constructor(t,e){X(this,"summary");X(this,"supp");X(this,"conn");this.summary=e,this.supp={note:null,abstract:null},this.conn=t}get backendUrl(){return this.conn.baseURL}get tags(){return new H(this.summary.tags)}get uid(){return this.summary.uuid}get title(){return this.summary.title}get authors(){return this.summary.authors}get year(){return this.summary.year}get publication(){return this.summary.publication}get url(){return this.summary.url}get bibtex(){return this.summary.bibtex}toString(){return`${this.summary.title} - ${this.authorAbbr()} (${this.summary.year}) [uid: ${this.summary.uuid}]`}fetchAbstract(){return new Promise((t,e)=>{this.conn.reqDatapointAbstract(this.summary.uuid).then(a=>{this.supp.abstract=a,t(a)}).catch(a=>{e(a)})})}uploadAbstract(t){return new Promise((e,a)=>{if(t===this.supp.abstract||t===null){e(!0);return}this.conn.updateDatapointAbstract(this.summary.uuid,t).then(s=>{this.supp.abstract=t,e(s)}).catch(s=>{a(s)})})}fetchNote(){return new Promise((t,e)=>{this.conn.reqDatapointNote(this.summary.uuid).then(a=>{this.supp.note=a,t(a)}).catch(a=>{e(a)})})}uploadNote(t){return t===null?Promise.reject("Note is null"):new Promise((e,a)=>{this.conn.updateDatapointNote(this.summary.uuid,t).then(s=>{this.supp.note=t,this.summary.note_linecount=t.split(`
`).map(i=>i.trim()==""?0:1).reduce((i,l)=>i+l,0),e(s)}).catch(s=>{a(s)})})}deleteMiscFile(t){return this.conn.deleteMiscFile(this.summary.uuid,t)}renameMiscFile(t,e){return this.conn.renameMiscFile(this.summary.uuid,t,e)}listMiscFiles(){const t=this.conn.reqMiscFileList(this.summary.uuid),e=`${this.backendUrl}/misc/${this.summary.uuid}`;return t.then(a=>a.map(s=>{const i=new URLSearchParams;return i.append("fname",s),i.append("_u",V().user.id.toString()),{fname:s,rpath:`./misc/${s}`,url:`${e.toString()}?${i.toString()}`}}))}uploadMisc(t){return new Promise((e,a)=>{this.conn.uploadMiscFiles(this.summary.uuid,t).then(s=>{e(s.map(i=>`./misc/${i}`))},s=>{a(s)})})}uploadDocument(t){return this.conn.uploadDocument(this.summary.uuid,t)}freeDocument(){return this.conn.deleteDocument(this.summary.uuid)}update(t=null){if(t!==null)return this.summary=t,Promise.resolve(t);const e=this.conn.reqDatapointSummary(this.summary.uuid);return e.then(a=>{this.summary=a}),e}destory(){this.summary=Oe}authorAbbr(){let t="";return this.summary.authors.length>1&&(t=" et al."),this.summary.authors[0]+t}authorYear(){return`${this.authorAbbr()} ${this.summary.year}`}yearAuthor(t=" "){return`${this.summary.year}${t}${this.authorAbbr()}`}isDummy(){return this.summary.uuid===Oe.uuid}getRawDocURL(){const t=this.summary.uuid;return this.summary.has_file?`${this.backendUrl}/doc/${t}?_u=${V().user.id}`:!this.summary.has_file&&this.url?this.url:"about:blank"}getOpenDocURL({extraPDFViewerParams:t={},urlHashMark:e=""}={}){const a=`${this.backendUrl}/pdfjs/web/viewer.html`;function s(r,d=a){const g=new URLSearchParams;d===a&&g.append("key",j().encKey),g.append("file",`${r}`);for(const u in t)g.append(u,t[u]);return`${d}?${g.toString()}`}function i(r){return e?(new URL(r).hash&&(r=r.slice(0,r.indexOf("#"))),`${r}#${e}`):r}let l="about:blank";if(this.isDummy()&&(l="about:blank"),this.summary.has_file&&this.summary.file_type==".pdf"){const r=this.getRawDocURL();l=s(i(r))}if(this.summary.has_file&&this.summary.file_type==".html"){const r=this.getRawDocURL();l=i(r)}return!this.summary.has_file&&this.summary.url&&(l=i(this.summary.url)),console.log("Open doc url: ",l),l}docType(){return this.summary.has_file&&this.summary.file_type==".pdf"?"pdf":this.summary.has_file&&this.summary.file_type==".html"?"html":!this.summary.has_file&&this.summary.url?"url":!this.summary.has_file&&!this.summary.url?"":"unknown"}}const Oe={has_file:!1,file_type:"",year:"0000",title:" ",author:" ",authors:[" "],publication:null,tags:[],uuid:" ",url:"about:blank",time_added:0,time_modified:0,bibtex:"",doc_size:0,note_linecount:0,has_abstract:!1};class Kt{constructor(t){X(this,"cache");X(this,"tags");X(this,"uids");X(this,"dataInfoAcquireMutex",new zt);X(this,"conn");X(this,"_initliazed");this.cache={},this.uids=new Array,this.tags=new H,this._initliazed=!1,this.conn=t}get initialized(){return this._initliazed}async init(){await this.updateKeyCache(),await this.updateTagCache(),this._initliazed=!0,console.log("Get init data of size: ",((JSON.stringify(this.uids)+JSON.stringify(this.tags)).length*2/1024/1024).toPrecision(2),"MB")}allTags(){return this.tags}allKeys(){return this.uids}async updateKeyCache(){this.uids=await this.conn.reqAllKeys()}async updateTagCache(){this.tags=new H(await this.conn.reqAllTags())}async update(t,e=!0){let a;return t.uuid in this.cache?(this.cache[t.uuid].update(t),a=this.cache[t.uuid].tags):(this.cache[t.uuid]=new Ie(this.conn,t),a=new H),this.uids.includes(t.uuid)||this.uids.unshift(t.uuid),e&&(i=>{const l=new H;for(const r in this.cache)l.union_(this.cache[r].tags);return this.tags.union_(l),!i.issubset(l)})(a)&&await this.updateTagCache(),this.cache[t.uuid]}clear(){this.cache={},this.uids=new Array,this.tags=new H([]),this._initliazed=!1}async delete(t,e=!0){let a;t in this.cache?(a=this.cache[t].tags,delete this.cache[t]):a=null,this.uids.includes(t)&&(this.uids=this.uids.filter(i=>i!==t)),e&&(i=>{if(i===null)return!0;const l=new H;for(const r in this.cache)l.union_(this.cache[r].tags);return!i.issubset(l)})(a)&&await this.updateTagCache()}hasCache(t){return t in this.cache}getDummy(){return new Ie(this.conn,Oe)}async aget(t){if(!(t in this.cache))try{const e=await this.conn.reqDatapointSummary(t);this.cache[t]=new Ie(this.conn,e)}catch(e){return console.warn("Caught error in aget: ",e),new Ie(this.conn,Oe)}return this.cache[t]}async agetMany(t,e=!0,a=!0){const s=async()=>{this.dataInfoAcquireMutex.acquire();try{const r=Object.keys(this.cache),d=t.filter(p=>!r.includes(p));if(d.length===0)return t.map(p=>this.cache[p]);const g=await this.conn.reqDatapointSummaries(d);console.log("DEBUG: get data points of size: ",g.length),g.map(p=>new Ie(this.conn,p)).forEach(p=>{this.cache[p.uid]=p})}catch(r){throw r}finally{this.dataInfoAcquireMutex.release()}return t.map(r=>this.cache[r])},i=async()=>await Promise.all(t.map(r=>this.aget(r)));if(e)try{return await s()}catch(l){if(a)return console.warn("Caught error in agetMany: ",l),await i();throw l}return await i()}async agetByAuthor(t){const e=await this.conn.filter({searchBy:"author",searchContent:t});return await this.agetMany(e.uids)}getCacheByTags(t){t=new H(t);const e=[];for(const a in this.cache){const s=this.cache[a],i=new H(s.summary.tags);t.issubset(i.withParents())&&e.push(s)}return e}}class ut{constructor(t,e){X(this,"conn");X(this,"info");this.conn=t,this.info=e}get baseURL(){return this.conn.baseURL}avatarURL(t=128,e=-1){let a;return e===null?a="":e<0?a=`&t=${Date.now()}`:a=`&t=${e}`,`${this.baseURL}/user-avatar/${this.info.username}?size=${t}${a}`}}class Zt{constructor(t){X(this,"conn");this.conn=t}async list(){return(await this.conn.reqUserList()).map(e=>new ut(this.conn,e))}async get(t){let e=await this.conn.reqUserInfo(t);return new ut(this.conn,e)}}var pe=function o(t){function e(Y,ie){return Y>>>ie|Y<<32-ie}for(var a=Math.pow,s=a(2,32),i="length",l,r,d="",g=[],u=t[i]*8,p=o.h=o.h||[],f=o.k=o.k||[],_=f[i],v={},D=2;_<64;D++)if(!v[D]){for(l=0;l<313;l+=D)v[l]=D;p[_]=a(D,.5)*s|0,f[_++]=a(D,1/3)*s|0}for(t+="";t[i]%64-56;)t+="\0";for(l=0;l<t[i];l++){if(r=t.charCodeAt(l),r>>8)throw new Error("ASCII check failed");g[l>>2]|=r<<(3-l)%4*8}for(g[g[i]]=u/s|0,g[g[i]]=u,r=0;r<g[i];){var C=g.slice(r,r+=16),S=p;for(p=p.slice(0,8),l=0;l<64;l++){var h=C[l-15],m=C[l-2],k=p[0],$=p[4],b=p[7]+(e($,6)^e($,11)^e($,25))+($&p[5]^~$&p[6])+f[l]+(C[l]=l<16?C[l]:C[l-16]+(e(h,7)^e(h,18)^h>>>3)+C[l-7]+(e(m,17)^e(m,19)^m>>>10)|0),P=(e(k,2)^e(k,13)^e(k,22))+(k&p[1]^k&p[2]^p[1]&p[2]);p=[b+P|0].concat(p),p[4]=p[4]+b|0}for(l=0;l<8;l++)p[l]=p[l]+S[l]|0}for(l=0;l<8;l++)for(r=3;r+1;r--){var q=p[l]>>r*8&255;d+=(q<16?0:"")+q.toString(16)}return d};class Gt{constructor({baseUrlGetter:t=()=>"",tokenGetter:e=()=>"",sessionIDGetter:a=()=>""}){this._baseUrlGetter=t,this._tokenGetter=e,this._sessionIDGetter=a}get baseUrl(){return this._baseUrlGetter()}get token(){return this._tokenGetter()}get sessionID(){return this._sessionIDGetter()}async get(t,e={}){const a=new URL(`${this._baseUrlGetter()}${t}`);return Object.keys(e).forEach(s=>a.searchParams.append(s,e[s])),await this._fetch(a.toString(),{method:"GET"})}async post(t,e={}){const a=new FormData;for(const s in e){let i=e[s];i instanceof Array&&(i=JSON.stringify(i)),a.append(s,i)}return await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"POST",body:a})}async put(t,e){const a=new FormData;return a.append("key",this._tokenGetter()),a.append("session_id",this._sessionIDGetter()),a.append("file",e),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"PUT",body:a})}async delete(t,e={}){const a=new FormData;for(const s in e){let i=e[s];i instanceof Array&&(i=JSON.stringify(i)),a.append(s,i)}return a.append("key",this._tokenGetter()),a.append("session_id",this._sessionIDGetter()),await this._fetch(`${this._baseUrlGetter()}${t}`,{method:"DELETE",body:a})}async _fetch(t,e){if((e==null?void 0:e.method)==="GET"){const s=new URL(t);s.searchParams.append("key",this._tokenGetter()),s.searchParams.append("session_id",this._sessionIDGetter()),t=s.toString()}if((e==null?void 0:e.method)==="POST"||(e==null?void 0:e.method)==="PUT"||(e==null?void 0:e.method)==="DELETE")if(e.body===void 0)e.body=JSON.stringify({key:this._tokenGetter()});else if(typeof e.body=="string")e.body=JSON.stringify({key:this._tokenGetter(),session_id:this._sessionIDGetter(),...JSON.parse(e.body)});else if(e.body instanceof FormData)e.body.has("key")||e.body.append("key",this._tokenGetter()),e.body.has("session_id")||e.body.append("session_id",this._sessionIDGetter());else throw new Error("Not implemented body type");const a=await fetch(t,e);if(!a.ok)throw new Error(`Request failed with status ${a.status}`);return a}}class Jt{constructor(t,e,a=null){if(a===null){const s=Math.random().toString(36).substring(2);a=()=>s}this.fetcher=new Gt({baseUrlGetter:t,tokenGetter:e,sessionIDGetter:a})}get baseURL(){return this.fetcher.baseUrl}async authUsr(t){return await this.fetcher.post("/api/auth",{key:t}).then(e=>e.json())}async status(){return await this.fetcher.get("/api/status").then(t=>t.json())}async reqAllKeys(){return await this.fetcher.get("/api/database/keys").then(t=>t.json())}async reqAllTags(){return await this.fetcher.get("/api/database/tags").then(t=>t.json())}async reqDatabaseFeatureTSNE(t="doc_feature",e=3,a=10){return await this.fetcher.get(`/api/datafeat/tsne/${t}`,{n_component:e.toString(),perplexity:a.toString()}).then(s=>s.json())}async reqDatabaseUsage(){return await this.fetcher.get("/api/database/usage").then(t=>t.json())}async reqDatapointSummary(t){return await this.fetcher.get(`/api/datainfo/${t}`).then(e=>e.json())}async reqDatapointSummaries(t){return await this.fetcher.post("/api/datainfo-list",{uids:JSON.stringify(t)}).then(e=>e.json())}async deleteDatapoint(t){return await this.fetcher.post("/api/dataman/delete",{uuid:t}).then(()=>!0)}async updateDatapoint(t,{bibtex:e=null,tags:a=null,url:s=null}){if(!t&&(e===null||a===null||s===null))throw new Error("uid is null, other fields should be complete");const i={};return t!==null&&(i.uuid=t),e!==null&&(i.bibtex=e),a!==null&&(i.tags=JSON.stringify(a)),s!==null&&(i.url=s),await this.fetcher.post("/api/dataman/update",i).then(l=>l.json())}async reqDatapointAbstract(t){return await this.fetcher.get(`/api/datainfo-supp/abstract/${t}`).then(e=>e.text())}async updateDatapointAbstract(t,e){return await this.fetcher.post(`/api/datainfo-supp/abstract-update/${t}`,{content:e}).then(a=>!0)}async reqDatapointNote(t){return await this.fetcher.get(`/api/datainfo-supp/note/${t}`).then(e=>e.text())}async updateDatapointNote(t,e){return await this.fetcher.post(`/api/datainfo-supp/note-update/${t}`,{content:e}).then(a=>!0)}async _search(t,e){return console.warn("ServerConn.search will be deprecated in the future, use ServerConn.filter instead"),await this.fetcher.post("/api/search",{method:t,kwargs:JSON.stringify(e)}).then(a=>a.json())}async filter({tags:t=[],searchBy:e="title",searchContent:a="",maxResults:s=9999}={}){return await this.fetcher.post("/api/filter/basic",{tags:t,search_by:e,search_content:a,top_k:s}).then(i=>i.json())}async featurizeText(t,e=!1){return await this.fetcher.post("/api/iserver/textFeature",{text:t,require_cache:e}).then(a=>a.json())}reqAISummary(t,e,a=()=>{},s=!0,i="DEFAULT"){this.fetcher.post("/api/summary",{force:s,uuid:t,model:i}).then(l=>{if(!l.ok)throw e("(Error: "+l.status+")"),new Error("HTTP error "+l.status);const r=l.body.getReader(),d=({value:g,done:u})=>{if(u){a();return}let p=new TextDecoder().decode(g);return e(p),r.read().then(d)};return r.read().then(d)})}async reqMiscFileList(t){return await this.fetcher.get(`/api/misc-list/${t}`).then(e=>e.json())}async deleteMiscFile(t,e){return await this.fetcher.delete(`/misc/${t}`,{fname:e}).then(()=>!0)}async renameMiscFile(t,e,a){return await this.fetcher.post(`/misc/${t}`,{fname:e,dst_fname:a}).then(()=>!0)}async uploadMiscFiles(t,e){return(await Promise.all(e.map(s=>new Promise((i,l)=>{this.fetcher.put(`/misc/${t}`,s).then(r=>r.json()).then(i).catch(l)})))).map(s=>s.file_name)}async uploadDocument(t,e){return await this.fetcher.put(`/doc/${t}`,e).then(a=>a.json())}async deleteDocument(t){return await this.fetcher.delete(`/doc/${t}`).then(e=>e.json())}async renameTag(t,e){return await this.fetcher.post("/api/database/tag-rename",{oldTag:t,newTag:e}).then(()=>!0)}async deleteTag(t){return await this.fetcher.post("/api/database/tag-delete",{tag:t}).then(()=>!0)}async reqUserInfo(t){return await this.fetcher.post(`/api/user/info/${t}`).then(e=>e.json())}async updateUserNickname(t){return await this.fetcher.post("/api/user/info-update",{name:t}).then(e=>e.json())}async updateUserPassword(t){return await this.fetcher.post("/api/user/info-update",{password:pe(t)}).then(e=>e.json())}async reqUserList(){return await this.fetcher.post("/api/user/list",{}).then(t=>t.json())}async uploadUserAvatar(t,e){return await this.fetcher.put(`/user-avatar/${t}`,e).then(a=>a.json())}async updateUserAccess(t,e,a,s){const i={};return i.username=t,e!==null&&(i.is_admin=e.toString()),a!==null&&(i.mandatory_tags=JSON.stringify(a)),s!==null&&(i.max_storage=s),await this.fetcher.post("/api/userman/modify",i).then(l=>l.json())}async registerUser(t,e,a,s){return await this.fetcher.post("/api/userman/register",{invitation_code:t,username:e,password:pe(a),name:s}).then(i=>i.json())}async createUser(t,e,a,s,i,l){return await this.fetcher.post("/api/userman/create",{username:t,name:e,password:pe(a),is_admin:s.toString(),mandatory_tags:JSON.stringify(i),max_storage:l}).then(r=>r.json())}async deleteUser(t){return await this.fetcher.post("/api/userman/delete",{username:t}).then(()=>!0)}async reqFeedList({maxResults:t=10,category:e="",timeBefore:a=-1,timeAfter:s=-1}){return console.log("reqFeedList",t,e,a,s),await this.fetcher.post("/api/feed/query",{max_results:t,category:e,time_before:a,time_after:s}).then(i=>i.json())}async reqFeedCategories(){return await this.fetcher.get("/api/feed/categories").then(t=>t.json())}async changelog(){return await this.fetcher.get("/api/info/changelog").then(t=>t.json())}}const fe={};window.g_eventHooks=fe;function le(o,t){if(Array.isArray(o)){for(const e of o)le(e,t);return}fe[o]===void 0&&(fe[o]=[]),fe[o].includes(t)||fe[o].push(t)}function gt(o,t){if(Array.isArray(o)){for(const e of o)gt(e,t);return}fe[o]!==void 0&&(fe[o]=fe[o].filter(e=>e!==t))}function Qt(o,t){ve(()=>{le(o,t),console.log(`registered event callback [${o}]`,t.name)}),Rt(()=>{gt(o,t),console.log(`unregistered event callback [${o}]`,t.name)})}class Yt{constructor(t,e){X(this,"resetRemainingRetries",()=>{this.__remainingRetries=10});X(this,"decreaseRemainingRetries",()=>{this.__remainingRetries-=1});X(this,"isOpen",()=>this.ws?this.ws.readyState===WebSocket.OPEN:!1);X(this,"willTryReconnect",()=>this.__remainingRetries>0);this.__baseUrlGetter=t,this.__tokenGetter=e,this.resetRemainingRetries(),this.sessionID=pe(Date.now().toString()).slice(0,16),this.__eventCallback_records={onopenCallback:()=>{},onmessageCallback:a=>{},oncloseCallback:()=>{},onfailedToConnectCallback:()=>{}}}connect({onopenCallback:t=()=>{},onmessageCallback:e=i=>{},oncloseCallback:a=()=>{},onfailedToConnectCallback:s=()=>{}}={}){this.__eventCallback_records={onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s};const i=new URLSearchParams(window.location.search);i.append("key",this.__tokenGetter()),i.append("session_id",this.sessionID);const l=this.__baseUrlGetter().replace("https://","wss://").replace("http://","ws://")+"/ws?"+i.toString();return console.log("connecting to server websocket at: ",l),this.ws=new WebSocket(l),this.ws.onmessage=r=>{console.log(r);const d=JSON.parse(r.data);if(d.type==="event"){const g=d.content;if(console.log(g),Object.keys(fe).includes(g.type))for(const u of fe[g.type])u(g)}e(r)},this.ws.onopen=()=>{console.log("connected to server websocket"),t(),this.resetRemainingRetries()},this.ws.onclose=()=>{console.log("server websocket closed, will try to reconnect in 1 second"),a(),this.willTryReconnect()?(this.decreaseRemainingRetries(),new Promise(r=>setTimeout(r,1e3)).then(()=>{this.ws.readyState===WebSocket.CLOSED&&this.connect({onopenCallback:t,onmessageCallback:e,oncloseCallback:a,onfailedToConnectCallback:s})})):s()},this}send(t){this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.log("server websocket not ready, cannot send data")}resetReconnect(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.close(),this.resetRemainingRetries(),this.connect(this.__eventCallback_records)}close(){this.ws&&this.ws.readyState===WebSocket.OPEN?(this.__remainingRetries=0,this.ws.close()):console.log("server websocket not ready, cannot close")}}async function Ye(o){if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(o),!0;{const t=document.createElement("textarea");t.value=o,t.style.position="absolute",t.style.left="-99999999px",document.body.prepend(t),t.select();let e=!1;try{document.execCommand("copy")}catch(a){console.log(a),e=!0}finally{t.remove()}return!e}}function Xt(o){window.open(o,"_blank")}function _t(o,t){let e=null;return function(...a){e&&window.clearTimeout(e),e=window.setTimeout(()=>{o(...a),e=null},t)}}function ct(o,t,e=null){let a="";if(e){let s=new Date;s.setTime(s.getTime()+e*24*60*60*1e3),a=`expires=${s.toUTCString()}; `}document.cookie=`${o}=${t}; ${a} path=/; sameSite=Lax`}function en(o){return decodeURIComponent(document.cookie).split("; ").forEach(a=>{if(a.startsWith(`${o}=`)&&a.includes("expires"))return!0}),!1}function tn(o){const e=decodeURIComponent(document.cookie).split("; ");let a="";return e.forEach(s=>{s.indexOf(o)===0&&(a=s.substring(`${o}=`.length))}),a}const F=ze("uiStatus",{state:()=>({tagStatus:{checked:new H,all:new H,unfolded:new H},shownDataUIDs:[],shownDataScores:[],searchState:{searchBy:"title",content:""},unfoldedDataUIDs:[],recentlyReadDataUIDs:[],preferredReaderLeftPanelWidthPerc:.65,showMiscPanel:!1,popupValues:{},databaseLoadingStatus:{nCurrent:0,nTotal:-1},dataEditorOpened:!1}),getters:{databaseLoadingProgress(){return this.databaseLoadingStatus.nTotal===-1?this.databaseLoadingStatus.nCurrent===0?0:1:this.databaseLoadingStatus.nCurrent/this.databaseLoadingStatus.nTotal}},actions:{updateShownData(){const o=V();this.tagStatus.all=o.allTags,console.log("DEBUG: updateShownData() is called."),G().conn.filter({tags:Array.from(this.tagStatus.checked),searchBy:this.searchState.searchBy,searchContent:this.searchState.content}).then(t=>{this.shownDataUIDs=t.uids,this.shownDataScores=t.scores})},addRecentlyReadDataUID(o){this.recentlyReadDataUIDs.includes(o)&&this.recentlyReadDataUIDs.splice(this.recentlyReadDataUIDs.indexOf(o),1),this.recentlyReadDataUIDs.unshift(o),this.recentlyReadDataUIDs.length>5&&this.recentlyReadDataUIDs.pop()},showPopup(o,t="info",e=3e3){const a=Math.random().toString();this.popupValues[a]={content:o,styleType:t},setTimeout(()=>{delete this.popupValues[a]},e)},reloadDatabase(){V().reload(()=>{this.databaseLoadingStatus.nCurrent=0,V().database.clear(),this.updateShownData()},()=>{F().databaseLoadingStatus.nTotal=-1,F().tagStatus.all=V().database.allTags(),this.updateShownData()},()=>{this.showPopup(`Failed to load database from: ${G().conn.baseURL}`,"alert"),F().databaseLoadingStatus.nTotal=-1})}}}),G=ze("connection",{state:()=>{const o=new Yt(j().backend,()=>j().encKey);return{conn:new Jt(j().backend,()=>j().encKey,()=>o.sessionID),wsConn:o}}}),V=ze("data",{state:()=>({database:new Kt(G().conn),userPool:new Zt(G().conn),user:{id:-1,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}}),getters:{allTags(){return this.database.allTags()}},actions:{clearUserInfo(){this.user={id:0,username:"",enc_key:"",name:"",is_admin:!1,mandatory_tags:[],has_avatar:!1,max_storage:0}},reload(o=()=>{this.database.clear()},t=()=>{},e=()=>{}){o();function a(s){s.database.init().then(i=>{t()},i=>{e(i)})}a(this)}}}),j=ze("settings",{state:()=>({__encKey:(()=>{const o=localStorage.getItem("encKey");return o?(localStorage.removeItem("encKey"),ct("encKey",o,1),o):tn("encKey")})(),__showTagPanel:(localStorage.getItem("showTagPanel")||"true")==="true",__show3DScatterPlot:(localStorage.getItem("show3DScatterPlot")||"false")==="true",__readerLayoutType:localStorage.getItem("readerLayoutType")||"2",__numItemsPerPage:localStorage.getItem("numItemsPerPage")||"50",__backendHost:sessionStorage.getItem("backendUrl")||nn(),__backendPort:sessionStorage.getItem("backendPort")||an(),loggedIn:!1}),getters:{encKey(){return this.__encKey},backendHost(){return this.__backendHost},backendPort(){return this.__backendPort},showTagPanel(){return this.__showTagPanel},show3DScatterPlot(){return this.__show3DScatterPlot},readerLayoutType(){return parseInt(this.__readerLayoutType)},numItemsPerPage(){return parseInt(this.__numItemsPerPage)}},actions:{setEncKey(o,t=void 0){t===void 0&&(t=en("encKey")),this.__encKey=o,ct("encKey",o,t?7:null)},setBackendHost(o){this.__backendHost=o,sessionStorage.setItem("backendUrl",o)},setBackendPort(o){this.__backendPort=o,sessionStorage.setItem("backendPort",o)},setShowTagPanel(o){this.__showTagPanel=o,localStorage.setItem("showTagPanel",o.toString())},setShow3DScatterPlot(o){this.__show3DScatterPlot=o,localStorage.setItem("show3DScatterPlot",o.toString())},setReaderLayoutType(o){this.__readerLayoutType=o.toString(),localStorage.setItem("readerLayoutType",o.toString())},setNumItemsPerPage(o){this.__numItemsPerPage=o.toString(),localStorage.setItem("numItemsPerPage",o.toString())},backend(){return`${this.backendHost}:${this.backendPort}`}}});function nn(){let o=window.location.protocol,t=window.location.hostname;return`${o}//${t}`}function an(){const o=window.location.port;return o==="1420"?"8080":o}function Xe(o,t,e){j().setEncKey(o,e),t!==null?V().user=t:V().clearUserInfo(),t?j().loggedIn=!0:j().loggedIn=!1}function sn(){Xe("",null,!0)}async function on(){const o=G().conn,t=j().encKey;try{const e=await o.authUsr(t);return Xe(t,e,!0),e}catch(e){return console.log("settingsAuthentication failed: ",e),null}}function ln(o,t){return pe(o+pe(t))}const rn={class:"loading-widget"},un=L({__name:"LoadingWidget",props:{size:{default:"40px"},border_width:{default:"5px"}},setup(o){const t=o,e=R(()=>({width:t.size,height:t.size,border:t.border_width+" solid var(--color-border)",borderTopColor:"var(--color-primary)"}));return(a,s)=>(c(),y("div",rn,[n("div",{class:"loading-widget__spinner",style:ee(e.value)},null,4)]))}}),He=O(un,[["__scopeId","data-v-1d6933bb"]]),cn={class:"loading-popout"},dn=L({__name:"LoadingPopout",props:{text:{default:"loading"}},setup(o){const t=o;return(e,a)=>(c(),y("div",cn,[x(He,{size:"25px"}),n("label",null,T(t.text),1)]))}}),yt=O(dn,[["__scopeId","data-v-95a13423"]]),Ve=[];class J{static registerThemeChangeCallback(t){Ve.indexOf(t)===-1&&Ve.push(t)}static toggleDarkMode(){document.documentElement.classList.contains("light")?J.setDarkMode(!0):document.documentElement.classList.contains("dark")?J.setDarkMode(!1):(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,J.setDarkMode(!0))}static isDefaultDarkMode(){return!!(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches)}static isDarkMode(){return document.documentElement.classList.contains("light")?!1:!!document.documentElement.classList.contains("dark")}static setDefaultDarkMode(){const t=localStorage.getItem("themeMode");t==="dark"?J.setDarkMode(!0):t=="light"?J.setDarkMode(!1):J.isDefaultDarkMode()&&!J.isDarkMode()&&this.setDarkMode(!0,!1)}static setDarkMode(t,e=!0){t?(document.documentElement.classList.remove("light"),document.documentElement.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"));for(let a of Ve)a(t);if(e){const a=t?"dark":"light";localStorage.getItem("themeMode")!==a&&localStorage.setItem("themeMode",t?"dark":"light")}}static getThemeMode(){const t=localStorage.getItem("themeMode");return t==="dark"?"dark":t==="light"?"light":"auto"}static clear(){document.documentElement.classList.remove("dark"),document.documentElement.classList.remove("light"),this.setDefaultDarkMode(),localStorage.removeItem("themeMode")}}function dt(o,t){let e=o.parentNode;for(;e!=null;){if(e==t)return!0;e=e.parentNode}return!1}function Te(o){if(o===null||typeof o!="object")return o;let t=Array.isArray(o)?[]:{};for(let e in o)t[e]=Te(o[e]);return t}function wt(o,t,e=!1){if(o.length!==t.length)throw new Error("arr.length !== scores.length");const a=new Array;for(let r=0;r<o.length;r++)a.push([o[r],t[r]]);let s;e?s=a.sort((r,d)=>r[1]-d[1]):s=a.sort((r,d)=>d[1]-r[1]);const i=new Array,l=new Array;for(const r of s)i.push(r[0]),l.push(r[1]);return[i,l]}const hn=o=>(ne("data-v-719a0f48"),o=o(),ae(),o),pn={id:"popups"},fn=hn(()=>n("div",null,[n("div",{style:{"font-size":"2em","font-weight":"bold",color:"var(--color-red)"}},"Failed to connect to server"),n("div",{style:{color:"gray"}},"Maximum retry exceeded")],-1)),mn={id:"app"},vn=L({__name:"App",setup(o){const t=we(),e=F(),a=j();t.isReady().then(()=>{if(t.currentRoute.value.query.backendPort&&j().setBackendPort(t.currentRoute.value.query.backendPort),t.currentRoute.value.query.backendHost&&j().setBackendHost(t.currentRoute.value.query.backendHost),t.currentRoute.value.query.credential&&j().setEncKey(t.currentRoute.value.query.credential,!1),window.location.hash.split("?")[0]!=="#/login"){console.log("Authenticating...");const v=()=>{a.loggedIn?a.loggedIn=!1:s()};on().then(D=>{D||v()},()=>{v()})}});function s(){V().$reset(),F().$reset(),i.close(),t.push({path:"/login",query:{from:t.currentRoute.value.fullPath}})}se(()=>a.loggedIn,(v,D)=>{v?f():s()});const i=G().wsConn,l=w(!1),r=w(!1),d=w(window.location.hash.split("?")[0]==="#/login");t.afterEach((v,D)=>{d.value=v.path==="/login"});const g=R(()=>!l.value&&!d.value&&!r.value),u=R(()=>r.value&&!d.value);function p(){i.connect({onopenCallback:()=>{l.value=!0,r.value=!1},oncloseCallback:()=>l.value=!1,onfailedToConnectCallback:()=>r.value=!0})}setInterval(()=>{!i.isOpen()&&l.value&&!d.value&&!r.value&&(l.value=!1,p())},5e3);function f(){p(),e.reloadDatabase()}le("add_entry",v=>{const D=V(),C=v.datapoint_summary;D.database.update(C).then(()=>{console.log("DEBUG: add entry update UI"),e.updateShownData()})}),le(["update_entry","update_note"],v=>{const D=V(),C=v.datapoint_summary;D.database.update(C).then(()=>{console.log("DEBUG: update entry update UI"),e.updateShownData()})}),le("delete_entry",v=>{const D=V(),C=v.uuid;D.database.delete(C).then(()=>{console.log("DEBUG: delete entry update UI"),e.updateShownData()})}),le(["delete_tag","update_tag"],v=>{const D=new H([v.src_tag]),C=V();(async function(){await C.database.updateTagCache();const h=C.database.getCacheByTags(D);await Promise.all(h.map(m=>m.update())),e.updateShownData(),console.log("DEBUG: update tag update UI")})()}),le("update_user",v=>{if(v.username===V().user.username){if(v.user_info===null)throw new Error("assertion failed: User info is null");for(const D of Object.keys(V().user))D!=="enc_key"&&(V().user[D]=v.user_info[D])}});const _=()=>{window.location.reload()};return ve(()=>{J.setDefaultDarkMode()}),(v,D)=>{const C=Je("router-view");return c(),y(N,null,[n("div",pn,[(c(!0),y(N,null,Q(Object.keys(I(e).popupValues),(S,h)=>(c(),K(rt,{key:h,styleType:I(e).popupValues[S].styleType,style:ee({transform:`translate(-50%, ${-50+110*h}%) scale(0.9)`})},{default:E(()=>[M(T(I(e).popupValues[S].content),1)]),_:2},1032,["styleType","style"]))),128))]),g.value?(c(),K(yt,{key:0,text:"connecting..."})):B("",!0),u.value?(c(),K(rt,{key:1,styleType:"info",position:"center"},{default:E(()=>[n("div",{style:{display:"flex","flex-direction":"column","align-items":"center",margin:"10px"}},[fn,n("div",{style:{"font-size":"1.2em","margin-top":"10px"}},[M(" Please check if the server is running, make sure your network is working properly, and try to "),n("a",{style:{"text-decoration":"underline",cursor:"pointer"},onClick:_},"reload the page"),M(". ")])])]),_:1})):B("",!0),n("div",mn,[x(C,null,{default:E(({Component:S})=>[(c(),K(Bt,{exclude:"Reader"},[(c(),K(At(S)))],1024))]),_:1})])],64)}}}),gn=O(vn,[["__scopeId","data-v-719a0f48"]]),_n={for:"chk"},yn={id:"checkCircle"},wn={key:0,id:"checkStatus"},bn=L({__name:"Toggle",props:{checked:{type:Boolean},identifier:{default:""}},emits:["onCheck"],setup(o,{emit:t}){const e=t,a=o;function s(i){e("onCheck",a.identifier)}return(i,l)=>(c(),y("div",{class:"toggle",onClick:s},[n("label",_n,[me(i.$slots,"default",{},void 0,!0)]),n("div",yn,[i.checked?(c(),y("div",wn)):B("",!0)])]))}}),ke=O(bn,[["__scopeId","data-v-582ee950"]]),kn={class:"toggleText"},$n={class:"children slideInDown"},Sn=L({__name:"TagCollapsibleToggle",props:{tagStatus:{},identifier:{default:""},children:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,a=t,s=R({get:()=>e.tagStatus,set:v=>a("update:tagStatus",v)}),i=R(()=>{let v="collapseButton";return Object.keys(e.children).length!==0&&(v+=" collapsible"),v}),l=w(null),r=R(()=>!e.tagStatus.unfolded.has(e.identifier)),d=R(()=>r.value?"triangle-right":"triangle-down rotate90in");function g(v){let D=s.value.unfolded;D.has(e.identifier)?D.delete(e.identifier):D.add(e.identifier)}const u=R(()=>e.tagStatus.checked.has(e.identifier));function p(v){if(v===void 0)return;let D=s.value.checked;D.has(v)?D.delete(v):D.add(v)}const f=w(null),_=v=>{v.button===2&&(g(),v.preventDefault())};return ft(()=>{var v;(v=f.value)==null||v.addEventListener("contextmenu",_)}),mt(()=>{var v;(v=f.value)==null||v.removeEventListener("contextmenu",_)}),(v,D)=>(c(),y(N,null,[n("div",{class:"row",ref_key:"rowDiv",ref:f},[n("div",{id:"button",class:he(i.value),ref_key:"button",ref:l,onClick:g},[Object.keys(e.children).length!==0?(c(),y("div",{key:0,class:he(d.value)},null,2)):B("",!0)],2),n("div",kn,[x(ke,{checked:u.value,identifier:e.identifier,onOnCheck:p},{default:E(()=>[me(v.$slots,"default",{},void 0,!0)]),_:3},8,["checked","identifier"])])],512),z(n("div",$n,[(c(!0),y(N,null,Q(v.children,(C,S)=>(c(),K(bt,{identifier:String(S),children:C,"tag-status":s.value,"onUpdate:tagStatus":D[0]||(D[0]=h=>s.value=h)},{default:E(()=>[M(T(String(S).split(I(re)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tag-status"]))),256))],512),[[Ze,!r.value]])],64))}}),bt=O(Sn,[["__scopeId","data-v-505f8e28"]]),xn={id:"tagSelector-main",class:"hover-scrollable"},Cn=L({__name:"TagSelector",props:{tagStatus:{}},emits:["update:tagStatus"],setup(o,{emit:t}){const e=o,a=t,s=R(()=>De.tagHierarchy(e.tagStatus.all)),i=R(()=>Object.keys(s.value).sort()),l=R({get:()=>e.tagStatus,set:r=>a("update:tagStatus",r)});return(r,d)=>(c(),y("div",xn,[(c(!0),y(N,null,Q(i.value,g=>(c(),K(bt,{identifier:String(g),children:s.value[g],tagStatus:l.value,"onUpdate:tagStatus":d[0]||(d[0]=u=>l.value=u)},{default:E(()=>[M(T(String(g).split(I(re)).slice(-1)[0]),1)]),_:2},1032,["identifier","children","tagStatus"]))),256))]))}}),kt=O(Cn,[["__scopeId","data-v-5557e59e"]]),Dn={key:0,class:"prefix"},Pn=L({__name:"TagBubble",props:{tag:{},tStyle:{default:""}},emits:["click"],setup(o,{emit:t}){const e=o,a=t,s=R(()=>{const i=e.tag.split(re);return i.length==1?["",i[0]]:[i.slice(0,i.length-1).join("·"),i[i.length-1]]});return(i,l)=>(c(),y("div",{class:he(`bubble${i.tStyle?" "+i.tStyle:""}`),onClick:l[0]||(l[0]=()=>a("click"))},[s.value[0]?(c(),y("div",Dn,T(s.value[0]),1)):B("",!0),M(" "+T(s.value[1]),1)],2))}}),In=O(Pn,[["__scopeId","data-v-f454bc70"]]),Tn=L({__name:"TagBubbleContainer",props:{tags:{},highlightTags:{default:null},mutedTags:{default:null},maxWidth:{default:null},middleAlign:{type:Boolean,default:!1}},emits:["clickOnBubble"],setup(o,{emit:t}){const e=o,a=t,s=R(()=>{const i={};for(const l of e.tags)e.highlightTags&&e.highlightTags.has(l)?i[l]="highlight":e.mutedTags&&e.mutedTags.has(l)?i[l]="muted":i[l]="";return i});return(i,l)=>(c(),y("div",{id:"bubbleContainer",style:ee({maxWidth:`${(e.maxWidth?e.maxWidth:999)-10}px`,justifyContent:e.middleAlign?"center":"flex-start"})},[(c(!0),y(N,null,Q(e.tags,r=>(c(),K(In,{onClick:()=>a("clickOnBubble",r),tag:r,"t-style":s.value[r]},null,8,["onClick","tag","t-style"]))),256))],4))}}),et=O(Tn,[["__scopeId","data-v-62e107cd"]]),tt=o=>(ne("data-v-86105994"),o=o(),ae(),o),Un=tt(()=>n("h3",{class:"green"},"Tags",-1)),Rn=tt(()=>n("hr",null,null,-1)),An=tt(()=>n("hr",null,null,-1)),Bn=L({__name:"FileTags",emits:["onCheck"],setup(o,{emit:t}){const e=t,a=F(),s=V(),i=w(null),l=w(null);se(()=>a.unfoldedDataUIDs,()=>{a.unfoldedDataUIDs.length==0?l.value=null:a.shownDataUIDs.includes(a.unfoldedDataUIDs[0])&&s.database.aget(a.unfoldedDataUIDs[0]).then(f=>{l.value=f})});const r=R(()=>l.value==null?null:a.tagStatus.checked.withChildsFrom(l.value.tags)),d=R(()=>{const f=a.tagStatus.checked.copy();return l.value!==null&&f.pop_ifcontains_(l.value.tags),f});function g(){a.tagStatus.checked=new H,a.updateShownData()}se(a.tagStatus,()=>e("onCheck",a.tagStatus),{deep:!0});function u(){const f=prompt("Old tag");if(f&&s.database.allTags().has(f)){const _=prompt("New tag");_&&G().conn.renameTag(f,_).then(()=>{a.showPopup("Tag renamed","success")},()=>{a.showPopup("Failed to rename tag","error")})}else a.showPopup("Invalid tag","warning")}function p(){const f=prompt("Tag to delete");if(f&&s.database.allTags().has(f)){if(!confirm(`Are you sure to delete tag "${f}"?`))return;G().conn.deleteTag(f).then(()=>{a.showPopup("Tag deleted","success")},()=>{a.showPopup("Failed to delete tag","error")})}else a.showPopup("Invalid tag","warning")}return(f,_)=>(c(),y("div",{id:"file-tags-main",ref_key:"ftPanel",ref:i},[n("div",{class:"title"},[n("div",{id:"title-title"},[Un,n("div",{id:"title-buttons"},[n("div",{class:"button",onClick:u},"rename"),n("div",{class:"button",onClick:p},"delete")])]),Rn]),x(kt,{onOnCheck:_[0]||(_[0]=v=>e("onCheck",v)),tagStatus:I(a).tagStatus,"onUpdate:tagStatus":_[1]||(_[1]=v=>I(a).tagStatus=v)},null,8,["tagStatus"]),An,x(et,{onClickOnBubble:_[2]||(_[2]=v=>{I(a).tagStatus.checked.has(v)?I(a).tagStatus.checked.delete(v):I(a).tagStatus.checked.add(v),I(a).updateShownData()}),tags:l.value?l.value.tags:I(a).tagStatus.checked,"highlight-tags":r.value,"muted-tags":d.value,"max-width":i.value?i.value.clientWidth:null},null,8,["tags","highlight-tags","muted-tags","max-width"]),n("div",{class:"buttons"},[n("button",{id:"btnClear",class:"green",onClick:g},"CLEAR SELECTION")])],512))}}),Ln=O(Bn,[["__scopeId","data-v-86105994"]]),Mn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-80q-50%200-85-35t-35-85v-120h120v-560h600v680q0%2050-35%2085t-85%2035H240Zm480-80q17%200%2028.5-11.5T760-200v-600H320v480h360v120q0%2017%2011.5%2028.5T720-160ZM360-600v-80h360v80H360Zm0%20120v-80h360v80H360ZM240-160h360v-80H200v40q0%2017%2011.5%2028.5T240-160Zm0%200h-40%20400-360Z'/%3e%3c/svg%3e",nt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M480%20856q-115%200-197.5-82.5T200%20576q0-115%2082.5-197.5T480%20296q115%200%20197.5%2082.5T760%20576q0%20115-82.5%20197.5T480%20856Z'/%3e%3c/svg%3e",qn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M331%20625h37v-83h48q15.725%200%2026.362-10.638Q453%20520.725%20453%20505v-48q0-15.725-10.638-26.362Q431.725%20420%20416%20420h-85v205Zm37-120v-48h48v48h-48Zm129%20120h84q15%200%2026-10.638%2011-10.637%2011-26.362V457q0-15.725-11-26.362Q596%20420%20581%20420h-84v205Zm37-37V457h47v131h-47Zm133%2037h37v-83h50v-37h-50v-48h50v-37h-87v205ZM260%20856q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h560q24%200%2042%2018t18%2042v560q0%2024-18%2042t-42%2018H260ZM140%20976q-24%200-42-18t-18-42V296h60v620h620v60H140Z'/%3e%3c/svg%3e",En="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Z'/%3e%3c/svg%3e",Fn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M251%20896q-88%200-149.5-61.5T40%20685q0-78%2050-137t127-71q20-97%2094-158.5T482%20257q112%200%20189%2081.5T748%20534v24q72-2%20122%2046.5T920%20727q0%2069-50%20119t-119%2050H251Zm0-60h500q45%200%2077-32t32-77q0-45-32-77t-77-32h-63v-84q0-91-61-154t-149-63q-88%200-149.5%2063T267%20534h-19q-62%200-105%2043.5T100%20685q0%2063%2044%20107t107%2044Zm229-260Z'/%3e%3c/svg%3e",On="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554h189L551%20236v186Z'/%3e%3c/svg%3e",zn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M220%20976q-24%200-42-18t-18-42V236q0-24%2018-42t42-18h361l219%20219v521q0%2024-18%2042t-42%2018H220Zm331-554V236H220v680h520V422H551ZM220%20236v186-186%20680-680Z'/%3e%3c/svg%3e",Hn=o=>(ne("data-v-c6dbcdc2"),o=o(),ae(),o),Nn={key:0,id:"window"},Wn={class:"header"},jn=Hn(()=>n("span",{class:"close-icon"},"✕",-1)),Vn=[jn],Kn=L({__name:"FloatingWindow",props:{title:{default:"_"},show:{type:Boolean},closeKey:{default:"Escape"},compact:{type:Boolean,default:!1},zIndex:{default:100}},emits:["close","onClose","update:show"],setup(o,{emit:t}){const e=o,a=t,s=R({get:()=>e.show,set:r=>{a("update:show",r)}});function i(){s.value=!1,a("onClose"),a("close")}function l(r){r.target===r.currentTarget&&i()}return window.addEventListener("keydown",r=>{r.key===e.closeKey&&(i(),r.preventDefault())}),(r,d)=>s.value?(c(),y("div",Nn,[n("div",{id:"blocker",onClick:l,style:ee({"z-index":r.zIndex-1})},[n("div",{class:"floating-window",style:ee({"z-index":r.zIndex})},[n("div",Wn,[n("label",null,T(e.title),1),n("button",{class:"close-button",onClick:i},Vn)]),n("div",{class:"window-content scrollable",style:ee({margin:e.compact?"0px":"15px",marginTop:e.compact?"0px":"5px"})},[me(r.$slots,"default",{},void 0,!0)],4)],4)],4)])):B("",!0)}}),Se=O(Kn,[["__scopeId","data-v-c6dbcdc2"]]),Zn={id:"query-dialog-main"},Gn={class:"content"},Jn={id:"buttons"},Qn=L({__name:"QueryDialog",props:{show:{type:Boolean},title:{default:"Query"},showCancel:{type:Boolean,default:!0},zIndex:{default:99}},emits:["update:show","onClose","onAccept","onCancel"],setup(o,{emit:t}){const e=o,a=t,s=R({get:()=>e.show,set:i=>{a("update:show",i)}});return(i,l)=>(c(),K(Se,{show:s.value,"onUpdate:show":l[2]||(l[2]=r=>s.value=r),title:i.title,compact:!0,"z-index":i.zIndex,onOnClose:l[3]||(l[3]=()=>a("onClose"))},{default:E(()=>[n("div",Zn,[n("div",Gn,[me(i.$slots,"default",{},void 0,!0)]),n("div",Jn,[n("div",{class:"button ok-button",onClick:l[0]||(l[0]=()=>a("onAccept"))},"OK"),i.showCancel?(c(),y("div",{key:0,class:"button cancel-button last-button",onClick:l[1]||(l[1]=()=>a("onCancel"))},"Cancel")):B("",!0)])])]),_:3},8,["show","title","z-index"]))}}),$e=O(Qn,[["__scopeId","data-v-81948a9f"]]),Yn=o=>(ne("data-v-8779a0ab"),o=o(),ae(),o),Xn={id:"tag-selector-with-entry-main"},ea={style:{textAlign:"left"}},ta=Yn(()=>n("label",{for:"tagSelector"},"Tags",-1)),na={id:"tagSelector",class:"scrollable"},aa={class:"entry"},sa=L({__name:"TagSelectorWithEntry",props:{tagStatus:{},tagInputValue:{default:""}},emits:["update:tagStatus","update:tagInputValue"],setup(o,{emit:t}){const e=o,a=t,s=R({get:()=>e.tagStatus,set:d=>a("update:tagStatus",d)}),i=w(e.tagInputValue);se(()=>e.tagInputValue,d=>{i.value=d});const l=R({get:()=>i.value,set:d=>{a("update:tagInputValue",d),i.value=d}}),r=()=>{const d=l.value.trim();d!==""&&(s.value.all.add(d),s.value.checked.add(d),s.value.unfolded.union_(De.allParentsOf(d)),l.value="")};return(d,g)=>(c(),y("div",Xn,[n("div",ea,[ta,n("div",na,[x(kt,{tagStatus:s.value,"onUpdate:tagStatus":g[0]||(g[0]=u=>s.value=u)},null,8,["tagStatus"])])]),n("div",aa,[z(n("input",{type:"text",placeholder:"New tag","onUpdate:modelValue":g[1]||(g[1]=u=>l.value=u),onKeyup:Qe(r,["enter"])},null,544),[[Z,l.value]]),n("button",{class:he(`green${l.value?" to-be-confirmed":""}`),onClick:r},"ADD",2)])]))}}),oa=O(sa,[["__scopeId","data-v-8779a0ab"]]);async function ia(o){const t=`https://export.arxiv.org/api/query?id_list=${o}`,a=await(await fetch(t,{method:"GET"})).text();let l=new Ht.XMLParser().parse(a).feed.entry;function r(d){return Array.isArray(d.author)?d.author.map(g=>g.name):d.author?[d.author.name]:[]}if(l){const d=l.id.split("/").pop().split("v")[0],g=l.id,u=l.title,p=l.summary,f=r(l),_=l.updated,v=l.published;return{id:d,link:g,title:u,abstract:p,authors:f,updatedTime:_,publishedTime:v}}else throw new Error("Failed to fetch paper from arxiv")}function la(o){return`@article{${o.id},
  author = {${o.authors.join(" and ")}},
  title = {${o.title}},
  journal = {arXiv preprint arXiv:${o.id}},
  year = {${o.publishedTime.split("-")[0]}},
  abstract = {${o.abstract}}
  }`.replace(/  /g,"")}const ht=(o,{entry:t="",title:e="",authors:a=[""],year:s=new Date().getFullYear()}={})=>(t||(t=`${s}_${Math.random().toString(36).substring(7)}`),o=="article"?`@article{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        journal = {},
        year = {${s}},
        abstract = {},
        volume = {},
        number = {},
        pages = {},
        month = {},
        doi = {},
        }`.replace(/  /g,""):o=="inproceedings"?`@inproceedings{${t},
        author = {${a.join(" and ")},
        title = {${e}},
        booktitle = {},
        year = {${s}},
        abstract = {},
        editor = {},
        volume = {},
        number = {},
        series = {},
        pages = {},
        }`.replace(/  /g,""):o=="webpage"?`@misc{${t},
        title = "{${e}}",
        author = "{${a.join(" and ")}}",
        year = {${s}},
        url = "{}",
        note = "{}"
        }`.replace(/  /g,""):o=="misc"?`@misc{${t},
        author = {${a.join(" and ")}},
        title = {${e}},
        year = {${s}},
        url = {},
        }`.replace(/  /g,""):"");class Ke{static async fromArxiv(t){let e=t.toLowerCase();e.startsWith("arxiv:")?e=e.split("arxiv:")[1]:e.includes("arxiv.org/abs/")?e=e.split("arxiv.org/abs/")[1]:e.includes("arxiv.org/pdf/")&&(e=e.split("arxiv.org/pdf/")[1].split(".pdf")[0]);const a=await ia(e);return{bibtex:la(a),url:a.link}}static async fromWebpage(t){var d;const a=await(await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`)).text(),l=(d=new DOMParser().parseFromString(a,"text/html").querySelector("title"))==null?void 0:d.innerText;return{bibtex:`@misc{${t},
            author = {},
            title = {${l}},
            url = {${t}},
            year = {${new Date().getFullYear()}},
            }`.replace(/  /g,""),url:t}}static async fromDoi(t){const e=`https://api.crossref.org/works/${t}/transform/application/x-bibtex`;return{bibtex:await(await fetch(e,{method:"GET"})).text(),url:`https://doi.org/${t}`}}}const ra={key:0,id:"arrow"},ua=["onKeydown","onClick"],ca=L({__name:"Menu",props:{show:{type:Boolean},menuItems:{},position:{},blocker:{type:Boolean,default:!1},middleTop:{type:Boolean,default:!1},zIndex:{default:100},arrow:{type:Boolean,default:!1}},emits:["update:show"],setup(o,{emit:t}){const e=o,a=t,s=R({get:()=>e.show,set:l=>{a("update:show",l)}});function i(){s.value=!1}return(l,r)=>(c(),y(N,null,[l.blocker?(c(),y("div",{key:0,id:"blocker",onClick:i,style:ee({zIndex:e.zIndex-1})},null,4)):B("",!0),n("div",{id:"floatingMenu",style:ee({left:e.position.x+"px",top:e.position.y+"px",visibility:s.value?"visible":"hidden",transform:e.middleTop?"translate(-50%, 0)":"",zIndex:e.zIndex})},[e.arrow?(c(),y("div",ra)):B("",!0),(c(!0),y(N,null,Q(e.menuItems,(d,g)=>(c(),y("div",{class:he(`non-selectable floatingMenuItem${g!==e.menuItems.length-1?"":" floatingMenuItemLast"}`),tabindex:"0",onKeydown:Qe(u=>{d.action(),i()},["enter"]),onClick:u=>{d.action(),i()}},T(d.name),43,ua))),256))],4)],64))}}),da=O(ca,[["__scopeId","data-v-c6b659c7"]]),Pe=L({name:"file-select-button",props:{asLink:{type:Boolean,default:!1},text:{type:String,default:"Upload"},action:{type:Function,required:!0},style:{type:Object,default:()=>({})}},setup(o,t){const e=w(null),a=i=>{const l=i.target;if(l.files&&l.files.length>0){const r=l.files[0];o.action(r)}};function s(){e.value.click()}return t.expose({click:s}),()=>x(N,null,[x("input",{type:"file",id:"upload-file",onChange:a,ref:e,style:{display:"none"}},null),o.asLink?x("a",{class:"btn upload-btn",rel:"noopener noreferrer",onClick:()=>e.value.click(),style:o.style},[o.text]):x("button",{type:"button",class:"btn upload-btn",onClick:()=>e.value.click(),style:o.style},[o.text])])}}),at=L({name:"editable-paragraph",props:{contentEditable:{type:Boolean,default:!0},style:{type:Object,default:()=>({})}},emits:["finish","change"],setup(o,t){const e=w(null),a=f=>{e.value.innerText=f},s=f=>{e.value.contentEditable=f.toString()},i=f=>e.value.contains(f),l=function(){return document.activeElement===e.value},r=R({get(){return e.value.innerText},set(f){e.value.innerText=f}});t.expose({setText:a,setEditable:s,contains:i,innerText:r,hasFocus:l});const d=()=>{t.emit("change",e.value.innerText)},g=()=>{t.emit("finish",e.value.innerText)},u=f=>{if(f.key==="Enter")if(f.ctrlKey||f.metaKey){f.preventDefault();const _=window.getSelection(),v=_==null?void 0:_.getRangeAt(0);if(v){const D=document.createElement("br");v.insertNode(D),v.setStartAfter(D),v.setEndAfter(D),_==null||_.removeAllRanges(),_==null||_.addRange(v)}}else e.value.blur()},p=f=>{var v;f.preventDefault();const _=(v=f.clipboardData)==null?void 0:v.getData("text/plain");document.execCommand("insertText",!1,_)};return()=>x("p",{class:"editable-paragraph",contenteditable:o.contentEditable,ref:e,onInput:d,onBlur:g,onKeydown:u,style:o.style,onPaste:p},[t.slots.default&&t.slots.default()])}}),$t=L({name:"menu-attached",props:{menuItems:{type:Array,required:!0}},setup(o,t){const e=w(!1),a=w(null),s=w({x:0,y:0});return se(e,i=>{if(i){const l=a.value.getBoundingClientRect();s.value={x:l.left+l.width/2,y:l.bottom+5}}else s.value={x:0,y:0}}),()=>x("div",null,[x("div",{ref:a,onClick:()=>e.value=!e.value,onKeydown:i=>{i.key==="Enter"&&(i.preventDefault(),e.value=!e.value)}},[t.slots.default&&t.slots.default()]),x(da,{show:e.value,"onUpdate:show":i=>e.value=i,menuItems:o.menuItems,position:s.value,middleTop:!0,arrow:!0},null)])}}),ha=L({name:"CircularImage",props:{href:{type:String,required:!0},size:{type:String,required:!0},alt:{type:String,default:""}},emits:["click"],setup(o,t){const e={width:`${o.size}`,height:`${o.size}`,borderRadius:"50%",border:"1px solid var(--color-border)",overflow:"hidden"};return()=>x("img",{src:o.href,alt:o.alt,style:e,onClick:()=>t.emit("click")},null)}});function pt(o){function t(u,p){var _;const f=(_=u.split(".").pop())==null?void 0:_.toLowerCase();for(const v of p)if(f===v)return!0;return!1}function e(u){return!!(u.type.startsWith("image/")||t(u.name,["jpg","jpeg","png","gif","bmp","svg","webp"]))}function a(u){return!!(u.type==="application/pdf"||t(u.name,["pdf"]))}function s(u){return!!(u.type==="text/html"||t(u.name,["html"]))}function i(u){return!!(u.type==="text/plain"||t(u.name,["txt","bib","bibtex","nbib","enw","ris"]))}function l(u){return!!(a(u)||s(u)||e(u))}const r=[],d=[],g=[];for(let u=0;u<o.length;u++)i(o[u])?r.push(o[u]):l(o[u])?d.push(o[u]):g.push(o[u]);return{citation:r,document:d,unknown:g}}const ge=o=>(ne("data-v-c51ec443"),o=o(),ae(),o),pa={style:{display:"flex",flexDirection:"column",gap:"10px",padding:"10px",width:"100%",height:"100%"}},fa={style:{margin:"10px"}},ma=ge(()=>n("legend",null,"Source",-1)),va={class:"bibsource-container"},ga=ge(()=>n("legend",{for:"bibsource-arxiv"},"arxiv",-1)),_a={class:"bibsource-container"},ya=ge(()=>n("legend",{for:"bibsource-doi"},"doi",-1)),wa={class:"bibsource-container"},ba=ge(()=>n("legend",{for:"bibsource-webpage"},"webpage",-1)),ka=["placeholder"],$a={key:0},Sa={id:"inputDiv"},xa={id:"inputLeft"},Ca={id:"bibtexArea"},Da={class:"horizontal"},Pa=ge(()=>n("label",{for:"bibtex"},"Bibtex",-1)),Ia={id:"bibtexSource",class:"horizontal"},Ta={id:"urlArea"},Ua=ge(()=>n("label",{for:"url"},"URL: ",-1)),Ra={id:"inputRight"},Aa={key:0,style:{display:"flex","justify-content":"center","align-items":"center","padding-inline":"15px"}},Ba=ge(()=>n("div",{class:"hr"},null,-1)),La={style:{"margin-top":"5px","text-wrap":"nowrap","white-space":"nowrap","margin-inline":"5px"}},Ma=ge(()=>n("div",{class:"hr"},null,-1)),qa={key:1},Ea=ge(()=>n("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"430px",width:"590px",border:"5px dashed var(--color-border)","border-radius":"10px",margin:"15px"}},[n("div",{style:{"font-size":"20px","font-weight":"bold","margin-bottom":"10px"}},"Drop to insert citation or document"),n("div",{style:{"font-size":"12px",opacity:"0.5"}},"(only support bibtex/enw/nbib)")],-1)),Fa=[Ea],Oa=L({__name:"DataEditor",setup(o,{expose:t}){const e=F(),a=G().conn,s=w(!1),i=w(null),l=w(""),r=w(""),d=w(null),g=w({all:new H,checked:new H,unfolded:new H});function u(){const W={uuid:i.value?i.value.summary.uuid:null,bibtex:l.value,tags:Array.from(g.value.checked),url:r.value,file:d.value};_(),e.showPopup("Saving entry...","info"),a.updateDatapoint(W.uuid,{bibtex:W.bibtex,tags:W.tags,url:W.url}).then(U=>{W.file?(e.showPopup("Uploading document...","info"),a.uploadDocument(U.uuid,W.file).then(A=>{e.showPopup("Saved","success")},()=>e.showPopup("Failed to upload document","error"))):e.showPopup("Saved","success")},()=>e.showPopup("Failed to save","error"))}const p=w("");function f({datapoint:W=null,bibtex:U=null,url:A=null,tags:oe=null}){e.dataEditorOpened||(e.dataEditorOpened=!0,W!==null&&(i.value=W,l.value=W.summary.bibtex,r.value=W.summary.url,oe===null&&(oe=new H(W.summary.tags))),U!==null&&(l.value=U),A!==null&&(r.value=A),oe!==null?(Array.isArray(oe)&&(oe=new H(oe)),g.value={all:new H(e.tagStatus.all).union(oe),checked:oe,unfolded:oe.allParents()}):g.value={all:new H(e.tagStatus.all),checked:new H(e.tagStatus.checked),unfolded:new H(e.tagStatus.unfolded)},s.value=!0)}function _(){s.value=!1,i.value=null,l.value="",r.value="",g.value={all:new H(e.tagStatus.all),checked:new H(e.tagStatus.checked),unfolded:new H(e.tagStatus.unfolded)},d.value=null,p.value="",ie.value=!1,e.dataEditorOpened=!1}function v(){return s.value}function D(W){if(i.value)return e.showPopup("Document can only be added to new entry","error"),!1;if(!pt([W]).document)return e.showPopup("Unsupported file","error"),!1;if(d.value=W,console.log("file selected"),l.value.trim().length===0){console.log("try to extract bibtex from file");const U=W.name,A=W.lastModified,oe=ht(h.value,{title:U,year:new Date(A).getFullYear()});l.value=oe}return!0}function C(W){let U=!1;if(!W||W.length===0)return U;const A=pt(W);if((A.citation.length>1||A.document.length>1)&&e.showPopup("Only one citation and one document are allowed","error"),A.citation.length==0&&A.document.length==0&&(console.log("[Error] Got files: ",W),e.showPopup("Unsupported file type","error")),A.citation.length>0){const oe=A.citation[0];if(oe.size<64*1024){const it=new FileReader;it.onload=Pt=>{var lt;const It=(lt=Pt.target)==null?void 0:lt.result;l.value=It},it.readAsText(oe),U=!0}else e.showPopup("Text file too large","error")}return A.document.length>0&&(U=D(A.document[0])),U}t({show:f,close:_,isShown:v,loadFiles:C});const S=w(!1),h=w("article"),m=R(()=>ht(h.value)),k=w(!1),$=w("arxiv"),b={arxiv:W=>Ke.fromArxiv(W),doi:W=>Ke.fromDoi(W),webpage:W=>Ke.fromWebpage(W)},P={arxiv:"e.g. 2106.00001",doi:"e.g. 10.1145/344779.344937",webpage:"e.g. https://news.mit.edu/2021/xxx"},q=w("");function Y(W){e.showPopup("Fetching from BibTeX source...","info"),k.value=!1,q.value="",b[$.value](W).then(U=>{e.showPopup("Obtained bibtex from source","success"),l.value=U.bibtex,r.value=U.url},()=>{e.showPopup("Failed to fetch from source","error")})}const ie=w(!1),ce=w(null),_e=W=>{W.preventDefault(),ie.value=!0},de=W=>{W.preventDefault(),ie.value=!1},be=W=>{var A;W.preventDefault();const U=(A=W.dataTransfer)==null?void 0:A.files;U&&C(U),ie.value=!1};return(W,U)=>(c(),y(N,null,[x($e,{show:S.value,"onUpdate:show":U[4]||(U[4]=A=>S.value=A),onOnAccept:U[5]||(U[5]=()=>{l.value=m.value,S.value=!1}),onOnCancel:U[6]||(U[6]=A=>S.value=!1),"z-index":102,title:"Select template"},{default:E(()=>[n("div",pa,[x(ke,{onOnCheck:U[0]||(U[0]=A=>h.value="article"),checked:h.value=="article"},{default:E(()=>[M("Article")]),_:1},8,["checked"]),x(ke,{onOnCheck:U[1]||(U[1]=A=>h.value="inproceedings"),checked:h.value=="inproceedings"},{default:E(()=>[M("Inproceedings")]),_:1},8,["checked"]),x(ke,{onOnCheck:U[2]||(U[2]=A=>h.value="webpage"),checked:h.value=="webpage"},{default:E(()=>[M("Webpage")]),_:1},8,["checked"]),x(ke,{onOnCheck:U[3]||(U[3]=A=>h.value="misc"),checked:h.value=="misc"},{default:E(()=>[M("Misc")]),_:1},8,["checked"])])]),_:1},8,["show"]),x($e,{show:k.value,"onUpdate:show":U[11]||(U[11]=A=>k.value=A),onOnCancel:U[12]||(U[12]=A=>k.value=!1),onOnAccept:U[13]||(U[13]=()=>{Y(q.value)}),"z-index":102,title:"Source input"},{default:E(()=>[n("div",fa,[n("fieldset",{style:ee({display:"flex",flexDirection:"row",gap:"10px",border:"1px solid var(--color-border)"})},[ma,n("div",va,[z(n("input",{type:"radio",id:"bibsource-arxiv",name:"bibSource",value:"arxiv","onUpdate:modelValue":U[7]||(U[7]=A=>$.value=A)},null,512),[[We,$.value]]),ga]),n("div",_a,[z(n("input",{type:"radio",id:"bibsource-doi",name:"bibSource",value:"doi","onUpdate:modelValue":U[8]||(U[8]=A=>$.value=A)},null,512),[[We,$.value]]),ya]),n("div",wa,[z(n("input",{type:"radio",id:"bibsource-webpage",name:"bibSource",value:"webpage","onUpdate:modelValue":U[9]||(U[9]=A=>$.value=A)},null,512),[[We,$.value]]),ba])],4),z(n("input",{type:"text","onUpdate:modelValue":U[10]||(U[10]=A=>q.value=A),placeholder:P[$.value],style:{width:"100%",marginTop:"10px"}},null,8,ka),[[Z,q.value]])])]),_:1},8,["show"]),x($e,{show:s.value,"onUpdate:show":U[21]||(U[21]=A=>s.value=A),title:i.value?i.value.authorAbbr():"new","show-cancel":!1,onOnAccept:u,onOnCance:_,onOnClose:_},{default:E(()=>[n("div",{id:"data-editor-main",ref_key:"dataEditorComponent",ref:ce,onDragover:_e,onDrop:be,onDragend:de},[ie.value?(c(),y("div",qa,Fa)):(c(),y("div",$a,[n("div",Sa,[n("div",xa,[n("div",Ca,[n("div",Da,[Pa,n("div",Ia,[n("div",{class:"button",onClick:U[14]||(U[14]=A=>S.value=!0)},"template"),n("div",{class:"button",onClick:U[15]||(U[15]=A=>k.value=!0)},"from-source")])]),z(n("textarea",{id:"bibtex","onUpdate:modelValue":U[16]||(U[16]=A=>l.value=A),placeholder:"bibtex / enw / nbib",class:"scrollable wrapword",style:{resize:"none"}},null,512),[[Z,l.value]])]),n("div",Ta,[Ua,z(n("input",{id:"url","onUpdate:modelValue":U[17]||(U[17]=A=>r.value=A),placeholder:"url",type:"text"},null,512),[[Z,r.value]])])]),n("div",Ra,[x(oa,{"tag-status":g.value,"onUpdate:tagStatus":U[18]||(U[18]=A=>g.value=A),"tag-input-value":p.value,"onUpdate:tagInputValue":U[19]||(U[19]=A=>p.value=A)},null,8,["tag-status","tag-input-value"])])]),i.value===null?(c(),y("div",Aa,[Ba,n("div",La,[M(T(d.value?d.value.name:"")+" ",1),d.value?(c(),y("a",{key:1,onClick:U[20]||(U[20]=A=>d.value=null),style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}," (Remove) ")):(c(),K(I(Pe),{key:0,text:"Select document",action:D,"as-link":!0,style:{cursor:"pointer",padding:"3px","border-radius":"5px"}}))]),Ma])):B("",!0)]))],544)]),_:1},8,["show","title"])],64))}}),st=O(Oa,[["__scopeId","data-v-c51ec443"]]),xe=o=>(ne("data-v-be852e8d"),o=o(),ae(),o),za={class:"layout"},Ha={id:"info"},Na=xe(()=>n("td",null,[n("b",null,"Authors")],-1)),Wa={id:"authorTD"},ja=["onClick"],Va={key:0,id:"otherPubTR"},Ka={colspan:"2"},Za={id:"authorPapers"},Ga=xe(()=>n("td",null,[n("b",null,"Publication")],-1)),Ja=xe(()=>n("td",null,[n("b",null,"Year")],-1)),Qa=xe(()=>n("td",null,[n("b",null,"Tags")],-1)),Ya=xe(()=>n("td",null,[n("b",null,"Type")],-1)),Xa={id:"shortSummary"},es={id:"shortSummaryTitle"},ts=xe(()=>n("b",null,"AI Summary",-1)),ns=xe(()=>n("summary",null,[n("b",null,"Related Articles")],-1)),as=L({__name:"DataSummary",props:{datapoint:{}},setup(o){const t=o,e=V(),a=w([]),s=w([]),i=R(()=>Object.fromEntries(a.value.map((h,m)=>[h.summary.uuid,s.value[m].toPrecision(3)]))),l=G().conn,r=w(null),d=w("");function g(h=!1){d.value="Loading...";let m="";u(),l.reqAISummary(t.datapoint.summary.uuid,k=>{k.replace(/\\n/g,"<br>"),m+=k,d.value=m},()=>{u(),console.log("finished")},h)}async function u(){let h=null;if(t.datapoint.supp.abstract?h=t.datapoint.supp.abstract:h=await t.datapoint.fetchAbstract(),h||(d.value&&!d.value.startsWith("Error")&&!d.value.startsWith("Loading")?h=d.value:h=t.datapoint.title),h=="")return;const m=await l.filter({searchBy:"feature",searchContent:h,maxResults:9}),k=await e.database.agetMany(m.uids,!1),$=new Array;for(const b of k){const P=m.uids.indexOf(b.summary.uuid);if(P>=0)$.push(m.scores[P]);else throw new Error("Related article not found in search result, IMPOSSIBLE")}[a.value,s.value]=wt(k,$,!1),a.value&&a.value[0].summary.uuid==t.datapoint.summary.uuid&&(a.value.shift(),s.value.shift())}const p=w(""),f=w([]),_=w({});async function v(){const h=t.datapoint.authors,m=await Promise.all(h.map(k=>e.database.agetByAuthor(k)));_.value={};for(let k=0;k<h.length;k++)_.value[h[k]]=m[k]}const D=R(()=>{const h={};for(const m in _.value)_.value[m]&&_.value[m].length>1?h[m]=_.value[m].length-1:h[m]=null;return h});function C(h){f.value=_.value[h],f.value||(f.value=[]),f.value=f.value.filter(m=>m.summary.uuid!=t.datapoint.summary.uuid),p.value===h?p.value="":p.value=h}ve(()=>{v(),g(!1)});const S=R(()=>{const b=(Math.min(Math.max(window.innerWidth-600,0)/1800,1)-.5)*Math.PI,P=(Math.sin(b)+1)*.5*1200,q=Math.round(P);return`${window.innerWidth-q}px`});return(h,m)=>(c(),y("div",{id:"main",style:ee({width:S.value})},[n("h2",null,T(h.datapoint.summary.title),1),n("div",za,[n("div",Ha,[n("table",null,[n("tr",null,[Na,n("td",Wa,[(c(!0),y(N,null,Q(h.datapoint.summary.authors,k=>(c(),y("div",null,[n("span",null,T(k),1),D.value[k]!==null?(c(),y("a",{key:0,onClick:()=>C(k)}," ("+T(D.value[k])+") ",9,ja)):B("",!0)]))),256))])]),x(Ue,{name:"slideDown"},{default:E(()=>[p.value?(c(),y("tr",Va,[n("td",Ka,[n("b",null,T(`Other publications from ${p.value.toUpperCase()}:`),1),n("div",Za,[x(Ae,{uids:f.value.map(k=>k.summary.uuid)},null,8,["uids"])])])])):B("",!0)]),_:1}),n("tr",null,[Ga,n("td",null,T(h.datapoint.summary.publication),1)]),n("tr",null,[Ja,n("td",null,T(h.datapoint.summary.year),1)]),n("tr",null,[Qa,n("td",null,T(h.datapoint.summary.tags.toString()),1)]),n("tr",null,[Ya,n("td",null,T(h.datapoint.docType()+`${h.datapoint.summary.has_file?" ("+h.datapoint.summary.doc_size.toString()+"M)":""}`),1)])])]),n("div",Xa,[n("div",es,[ts,n("div",{class:"button",onClick:m[0]||(m[0]=k=>g(!0))},"↻")]),n("p",{id:"aiSummary",ref_key:"aiSummaryParagraph",ref:r},T(d.value),513)]),n("details",null,[ns,x(Ae,{uids:a.value.map(k=>k.summary.uuid),scores:i.value},null,8,["uids","scores"])])])],4))}}),ss=O(as,[["__scopeId","data-v-be852e8d"]]),os=o=>(ne("data-v-e46f5683"),o=o(),ae(),o),is={id:"citations",style:{textAlign:"left"}},ls=["onClick"],rs={class:"citation-text",style:{overflowX:"hidden",whiteSpace:"nowrap"}},us={key:0},cs={key:0,id:"moreMain"},ds={class:"row",id:"buttons"},hs=["href"],ps={key:0,class:"row",id:"actions"},fs={id:"abstract"},ms=os(()=>n("summary",null,"Abstract",-1)),vs=L({__name:"FileRowMore",props:{datapoint:{},show:{type:Boolean}},setup(o,{expose:t}){const e=o,a=F(),s=w(null),i=async h=>{h.target instanceof HTMLDetailsElement&&!h.target.open||(s.value.setEditable(!1),s.value.innerText="Loading...",e.datapoint.fetchAbstract().then(m=>{s.value.innerText=m,s.value.setEditable(!0)},()=>{s.value.innerText="Failed to load abstract."}))},l=async h=>{h&&(await e.datapoint.uploadAbstract(h),await e.datapoint.update())},r=w(!1);function d(h,m){return[h,`${m.length>80?m.slice(0,80)+"...":m}`,m]}function g(h){Ye(h).then(m=>{m?a.showPopup("Copied to clipboard.","info"):a.showPopup("Failed to copy to clipboard.","error")})}const u=w(!1);function p(h){a.showPopup("uploading..."),e.datapoint.uploadDocument(h).then(m=>{e.datapoint.update(m),a.showPopup("Document uploaded","success")},()=>a.showPopup("Failed to upload document","error"))}function f(){window.confirm(`Free document? 
${e.datapoint.toString()}`)&&e.datapoint.freeDocument().then(h=>{e.datapoint.update(h),a.showPopup("Document deleted","info")},()=>a.showPopup("Failed to free document","error"))}function _(){const h=e.datapoint.summary.uuid;window.confirm(`[IMPORTANT] Delete? 
${e.datapoint.toString()}`)&&G().conn.deleteDatapoint(h).then(m=>{a.showPopup("Deleted")})}const v=w(null);function D(){v.value.show({datapoint:e.datapoint})}const C=R(()=>s.value===null?!v.value.isShown():!v.value.isShown()&&!s.value.hasFocus());t({editThisDatapoint:D,deleteThisDatapoint:_,shouldEnableEditDatapoint:C});const S=w(!1);return(h,m)=>{const k=Je("router-link");return c(),y(N,null,[x(Se,{show:S.value,"onUpdate:show":m[0]||(m[0]=$=>S.value=$),title:"Summary"},{default:E(()=>[x(ss,{datapoint:h.datapoint},null,8,["datapoint"])]),_:1},8,["show"]),x(Se,{show:r.value,"onUpdate:show":m[1]||(m[1]=$=>r.value=$),title:"Citations"},{default:E(()=>[(c(!0),y(N,null,Q([d("Title",`${h.datapoint.summary.title}`),d("Author-year",`${h.datapoint.authorAbbr()} (${h.datapoint.summary.year})`),d("APA",`${h.datapoint.authorAbbr()} (${h.datapoint.summary.year}). ${h.datapoint.summary.title}. ${h.datapoint.summary.publication}.`),d("Bibtex",h.datapoint.summary.bibtex),d("DocURL",h.datapoint.getRawDocURL()),d("Markdown",`[${h.datapoint.authorAbbr()} (${h.datapoint.summary.year})](${h.datapoint.getRawDocURL()})`),d("UUID",`${h.datapoint.summary.uuid}`)],($,b)=>(c(),y("div",is,[n("div",{onClick:()=>{g($[2]),r.value=!1},style:{cursor:"pointer",display:"flex",flexDirection:"row"}},[n("div",{class:"citation-type",style:ee({marginLeft:"10px",marginRight:"10px",borderRadius:"5px",backgroundColor:"var(--color-background-mute)",padding:"3px",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center"})},T($[0]),5),n("p",rs,T($[1]),1)],8,ls),b!==6?(c(),y("hr",us)):B("",!0)]))),256))]),_:1},8,["show"]),x(st,{ref_key:"dataEditor",ref:v},null,512),x(Ue,{name:"expand-transition"},{default:E(()=>[h.show?(c(),y("div",cs,[n("div",ds,[x(k,{to:`/reader/${e.datapoint.summary.uuid}`},{default:E(()=>[M("Reader")]),_:1},8,["to"]),h.datapoint.url?(c(),y("a",{key:0,href:h.datapoint.url,target:"_blank"},"Link",8,hs)):B("",!0),n("a",{rel:"noopener noreferrer",onClick:m[2]||(m[2]=()=>S.value=!S.value)},"Summary"),n("a",{rel:"noopener noreferrer",onClick:m[3]||(m[3]=()=>r.value=!r.value)},"Cite"),n("a",{rel:"noopener noreferrer",onClick:m[4]||(m[4]=()=>u.value=!u.value)},"Actions")]),x(Ue,{name:"actions"},{default:E(()=>[u.value?(c(),y("div",ps,[n("a",{rel:"noopener noreferrer",class:"btn",onClick:D},"Edit"),h.datapoint.summary.has_file?(c(),y("a",{key:1,rel:"noopener noreferrer",onClick:f,class:"danger btn"},"Free document")):(c(),K(I(Pe),{key:0,action:$=>p($),text:"Upload document","as-link":!0},null,8,["action"])),n("a",{rel:"noopener noreferrer",onClick:_,class:"danger btn"},"Delete")])):B("",!0)]),_:1}),n("div",fs,[n("details",{onToggle:i},[ms,x(I(at),{id:"abstractParagraph",ref_key:"abstractParagraph",ref:s,style:{minHeight:"20px"},onFinish:m[5]||(m[5]=$=>l($))},null,512)],32)])])):B("",!0)]),_:1})],64)}}}),gs=O(vs,[["__scopeId","data-v-e46f5683"]]),_s="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120v-640q0-33%2023.5-56.5T280-840h400q33%200%2056.5%2023.5T760-760v640L480-240%20200-120Zm80-122%20200-86%20200%2086v-518H280v518Zm0-518h400-400Z'/%3e%3c/svg%3e",ys="data:image/svg+xml,%3c?xml%20version='1.0'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2024%2024'%20width='24px'%20height='24px'%3e%3cpath%20d='M%206%202%20C%205.861875%202%205.7278809%202.0143848%205.5976562%202.0410156%20C%204.686084%202.2274316%204%203.033125%204%204%20L%204%2022%20L%2012%2019%20L%2020%2022%20L%2020%204%20C%2020%203.8625%2019.985742%203.7275391%2019.958984%203.5976562%20C%2019.799199%202.8163086%2019.183691%202.2008008%2018.402344%202.0410156%20C%2018.272119%202.0143848%2018.138125%202%2018%202%20L%206%202%20z'/%3e%3c/svg%3e",ws={class:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",flexWrap:"nowrap",gap:"0.25rem"}},bs={id:"marks"},ks=["src"],$s=["src"],Ss={class:"row text"},xs={style:{borderRadius:"10px",marginLeft:"5px",display:"flex",flexDirection:"column"}},Cs={id:"title",style:{display:"flex",fontSize:"1rem"}},Ds={class:"right row"},Ps={id:"statusDiv",style:{display:"flex",flexDirection:"row",alignItems:"center",gap:"2px"}},Is={class:"status"},Ts={key:0,src:Mn,alt:"",class:"icon"},Us={key:1,src:nt,alt:"",class:"icon placeholder"},Rs={class:"status"},As={key:0,src:qn,alt:"",class:"icon"},Bs={key:1,src:En,alt:"",class:"icon"},Ls={key:2,src:Fn,alt:"",class:"icon"},Ms={key:3,src:nt,alt:"",class:"icon placeholder"},qs={class:"status"},Es={key:0,src:On,alt:"",class:"icon"},Fs={key:1,src:zn,alt:"",class:"icon"},Os={key:2,src:nt,alt:"",class:"icon placeholder"},zs=12,Hs=1,Ns=L({__name:"FileRow",props:{datapoint:{},unfoldedIds:{},hoveredIds:{},line_number:{default:0}},emits:["update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,a=t,s=R({get:()=>e.unfoldedIds,set:m=>a("update:unfoldedIds",m)}),i=R({get:()=>e.hoveredIds,set:m=>a("update:hoveredIds",m)}),l=R(()=>s.value.includes(e.datapoint.summary.uuid)),r=w(null),d=w(null),g=w(null),u=w(null);let p=!1;function f(m){if(dt(m.target,r.value)){if(m.target.id=="authorYear"){const k=e.datapoint.getOpenDocURL();k!==""&&Xt(k),p=!0}if(!dt(m.target,g.value)){if(p){p=!1;return}l.value?s.value=s.value.filter(k=>k!==e.datapoint.summary.uuid):s.value=[e.datapoint.summary.uuid]}}}const _=R(()=>e.datapoint.yearAuthor("-")),v=w(!1);se(v,m=>{m?i.value.push(e.datapoint.summary.uuid):i.value=i.value.filter(k=>k!==e.datapoint.summary.uuid)});const D=R(()=>v.value?"var(--color-background-theme-highlight)":s.value.includes(e.datapoint.summary.uuid)?"var(--color-background-theme)":e.line_number%2==0?"var(--color-background-ssoft)":"var(--color-background)");function C(m){const k=e.datapoint.summary.tags.slice();m?k.push("* Bookmark"):k.splice(k.indexOf("* Bookmark"),1);const $=e.datapoint.summary.uuid;G().conn.updateDatapoint($,{tags:k}).then(b=>{e.datapoint.update(b),F().updateShownData()},()=>F().showPopup("Failed to save","error")),p=!0}function S(){var m;return s.value.includes(e.datapoint.summary.uuid)&&v.value&&document.activeElement===document.body&&((m=u.value)==null?void 0:m.shouldEnableEditDatapoint)}function h(m){var k,$;m.code==="Space"&&S()&&((k=u.value)==null||k.editThisDatapoint(),m.preventDefault()),(m.code==="Delete"||m.code==="Backspace")&&S()&&(($=u.value)==null||$.deleteThisDatapoint(),m.preventDefault())}return se(()=>s.value,m=>{m.includes(e.datapoint.summary.uuid)?window.addEventListener("keydown",h):window.removeEventListener("keydown",h)}),(m,k)=>(c(),y("div",{id:"fileRow",class:he(`${l.value?" unfolded":""}`),onClick:f,onMouseover:k[2]||(k[2]=$=>v.value=!0),onMouseleave:k[3]||(k[3]=$=>v.value=!1),ref_key:"dataCard",ref:r,style:ee({backgroundColor:D.value})},[n("div",{id:"init",class:"row",ref_key:"initDiv",ref:d},[n("div",ws,[n("div",bs,[m.datapoint.summary.tags.includes("* Bookmark")?(c(),y("img",{key:0,src:I(ys),alt:"",class:"icon redIcon",onClick:k[0]||(k[0]=()=>C(!1)),style:{height:"1rem"}},null,8,ks)):(c(),y("img",{key:1,src:I(_s),alt:"",class:"icon",onClick:k[1]||(k[1]=()=>C(!0)),style:{height:"1rem"}},null,8,$s))]),n("div",Ss,[n("div",xs,[n("div",Cs,T(m.datapoint.summary.title),1),n("div",{style:ee({marginTop:"0px",padding:"0px",color:"var(--color-text-soft)",fontSize:"0.75rem"})},T(_.value+", "+m.datapoint.publication),5)]),me(m.$slots,"default",{},void 0,!0)])]),n("div",Ds,[n("div",Ps,[n("div",Is,[m.datapoint.summary.has_abstract?(c(),y("img",Ts)):(c(),y("img",Us))]),n("div",Rs,[m.datapoint.docType()=="pdf"?(c(),y("img",As)):m.datapoint.docType()=="html"?(c(),y("img",Bs)):m.datapoint.docType()=="url"?(c(),y("img",Ls)):(c(),y("img",Ms))]),n("div",qs,[m.datapoint.summary.note_linecount>zs?(c(),y("img",Es)):m.datapoint.summary.note_linecount>Hs?(c(),y("img",Fs)):(c(),y("img",Os))])])])],512),n("div",{id:"more",ref_key:"moreDiv",ref:g},[x(gs,{datapoint:m.datapoint,show:l.value,ref_key:"moreComponent",ref:u},null,8,["datapoint","show"])],512)],38))}}),Ws=O(Ns,[["__scopeId","data-v-71763e14"]]),js={id:"datacard-container-main"},Vs={key:0,class:"relatedArticleScore"},Ks={key:1,id:"datacard-container-footer"},Zs=["disabled"],Gs={style:{"margin-left":"10px","margin-right":"10px",display:"flex",gap:"5px"}},Js=["disabled"],Qs=L({__name:"FileRowContainer",props:{uids:{},unfoldedIds:{default:null},hoveredIds:{default:null},scores:{default:null},compact:{type:Boolean,default:!0}},emits:["update:datapoints","update:unfoldedIds","update:hoveredIds"],setup(o,{emit:t}){const e=o,a=t,s=w([]),i=R({get:()=>e.unfoldedIds==null?s.value:e.unfoldedIds,set:h=>{e.unfoldedIds==null?s.value=h:a("update:unfoldedIds",h)}}),l=w([]),r=R({get:()=>e.hoveredIds==null?l.value:e.hoveredIds,set:h=>{e.hoveredIds==null?l.value=h:a("update:hoveredIds",h)}}),d=w(null),g=w(null),u=w(0),p=j(),f=w([]),_=w(!1);function v(){const h=u.value*p.numItemsPerPage,m=Math.min(h+p.numItemsPerPage,e.uids.length),k=e.uids.slice(h,m),$=V().database;let b=!0;(async()=>(await new Promise(P=>setTimeout(P,500)),b&&(_.value=!1)))(),$.agetMany(k).then(P=>{f.value=P,b=!1,_.value=!0})}se([()=>e.uids,()=>u.value,()=>p.numItemsPerPage],()=>{e.uids.length<u.value*p.numItemsPerPage&&(u.value=0),v()}),v();const D=()=>{var h;u.value>=Math.ceil(e.uids.length/p.numItemsPerPage)-1||(u.value++,g.value.setText(""+(u.value+1)),(h=d.value)==null||h.scrollTo({top:0,behavior:"auto"}))},C=()=>{var h;u.value!=0&&(u.value--,g.value.setText(""+(u.value+1)),(h=d.value)==null||h.scrollTo({top:0,behavior:"auto"}))},S=h=>{const m=h.target;m.scrollTop==0||m.scrollTop+m.clientHeight>=m.scrollHeight};return(h,m)=>(c(),y("div",js,[n("div",{id:"datacard-container",style:ee({gap:h.compact?"0px":"5px"}),ref_key:"datacardContainer",ref:d,onScroll:S,class:"scrollable"},[(c(!0),y(N,null,Q(f.value,(k,$)=>(c(),K(Ws,{datapoint:k,"unfolded-ids":i.value,"onUpdate:unfoldedIds":m[0]||(m[0]=b=>i.value=b),"hovered-ids":r.value,"onUpdate:hoveredIds":m[1]||(m[1]=b=>r.value=b),line_number:$,compact:h.compact},{default:E(()=>[e.scores!=null&&e.scores[k.summary.uuid]!=null?(c(),y("label",Vs,T(e.scores[k.summary.uuid]),1)):B("",!0)]),_:2},1032,["datapoint","unfolded-ids","hovered-ids","line_number","compact"]))),256))],36),_.value?B("",!0):(c(),K(Ue,{key:0,name:"fade"},{default:E(()=>[x(yt,{text:"Loading data..."})]),_:1})),h.uids.length>I(p).numItemsPerPage?(c(),y("div",Ks,[n("button",{onClick:C,disabled:u.value==0},"Prev",8,Zs),n("span",Gs,[x(I(at),{ref_key:"pageIndicatorEditableParagrah",ref:g,onFinish:m[2]||(m[2]=k=>{parseInt(k)>0&&parseInt(k)<=Math.ceil(h.uids.length/I(p).numItemsPerPage)&&(u.value=parseInt(k)-1)})},{default:E(()=>[M(T(u.value+1),1)]),_:1},512),M(" / "),n("p",null,T(Math.ceil(h.uids.length/I(p).numItemsPerPage)),1)]),n("button",{onClick:D,disabled:u.value>=Math.ceil(h.uids.length/I(p).numItemsPerPage)-1},"Next",8,Js)])):B("",!0)]))}}),Ae=O(Qs,[["__scopeId","data-v-703bfd64"]]),Ys=["title"],Xs=["src","alt"],eo={for:"icon",class:"iconLabel non-selectable"},to=L({__name:"ToolbarIcon",props:{iconSrc:{},labelText:{},title:{default:""},shortcut:{default:null}},emits:["onClick","click"],setup(o,{expose:t,emit:e}){const a=o,s=R(()=>a.title+(a.shortcut===null?"":` (${a.shortcut})`)),i=e,l=w(null);t({getBoundingClientRect:()=>{var p;return(p=l.value)==null?void 0:p.getBoundingClientRect()}});function d(){i("onClick"),i("click")}function g(p){if(p===null)return null;const f=p.toLowerCase().split("+");return _=>{f.includes("ctrl")&&!_.ctrlKey||f.includes("alt")&&!_.altKey||f.includes("shift")&&!_.shiftKey||f.includes("meta")&&!_.metaKey||f.includes(_.key.toLowerCase())&&(console.log("shortcut triggered: "+p+" | "+a.labelText),d(),_.preventDefault())}}const u=g(a.shortcut);return ft(()=>{u!==null&&window.addEventListener("keydown",u)}),mt(()=>{u!==null&&window.removeEventListener("keydown",u)}),(p,f)=>(c(),y("span",{class:"hoverMaxout105 button non-selecable",onClick:d,onKeydown:Qe(d,["enter"]),tabindex:0,title:`${s.value}`,ref_key:"button",ref:l},[n("img",{id:"icon",class:"icon",src:p.iconSrc,alt:p.labelText.toUpperCase()+"_ICON"},null,8,Xs),n("label",eo,T(p.labelText),1)],40,Ys))}}),ye=O(to,[["__scopeId","data-v-f0fccbdf"]]);let no=window.location.protocol,St;St=`${no}//${window.location.hostname}:${window.location.port}`;const ao=`${St}/documentation/`;console.log("production mode");function Be(){const o=j().backendPort;return`${j().backendHost}:${o}`}const so={name:"Li, Mengxun",email:"mengxunli@whu.edu.cn"},Ee=["SweetiePie","CutiePatootie","CuddleBug","FluffyPaws","HoneyBee","SnuggleMuffin","SugarPlum","AngelFace","PawsomePuppy","TeddyBearHugs","PrettyKitty","LoveBug","BabyDoll","SunshineSmiles","FuzzyWuzzy","BumbleBee","CupcakeQueen","DoodleDaisy","PurrfectPaws","CuddlyKoala","SweetPea","BunnyHop","SparklePony","HappyPanda","DreamyDove","FluffyCloud","CherryBlossom","AngelicWhisper","SnickerDoodle","LuckyLadybug","BlossomButterfly","SugarCubes","CottonCandyDreams","HoneyBunches","FurryFriend","BabyBlueEyes","SweetCheeks","PawsitiveVibes","SnugglyBear","LovelyLlama","PurrfectlyAdorable","TwinkleToes","CuddleBunny","CookieCrumbs","SunnySmiles","FluffyKitten","DarlingDeer","ButterflyKisses","FuzzyWuzzyPanda","SweetDreamer","SillyGoose","DaisyDoodle","CupcakeCutie","BuzzyBee","SnoozySnail","CharmingChick","CandyCane","BerryBlossom","Dimples","CocoaCuddles","CheerfulCherub","PetalPaws","BubblyBumble","AngelWings","JollyJellybean","WhiskerWonder","SprinkleSmiles","GigglyGiraffe","DancingDaisy","SunnySideUp","SnugglySloth","CuteQuokka","PeachyPaws","BouncyBunny","DazzlingDimples","ChirpyChickadee","CandyHeart","CupcakeSprinkle","BuzzyButterfly","SnoozyPanda","CharmingCorgi","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy","ChirpyChickadee","CandyCane","CupcakeCutie","BuzzyButterfly","SnoozySnail","CharmingCherub","CottonCandyCloud","BerryBlush","DimpleDoll","CocoaCuddler","CheerfulChipmunk","PetalWhiskers","BubblyButterfly","AngelFeathers","JollyJumper","WhiskerWanderer","SprinkleSweets","GigglyGazelle","DancingDolphin","SunnySmiles","SnugglySquirrel","CuteKangaroo","PeachyPup","BouncyBear","DazzlingDarling","ChirpyCockatiel","CandyCharm","CupcakeDelight","BuzzyBee","SnoozySloth","CharmingChinchilla","CottonCandyDream","BerryBlossom","DimpleDaisy","CocoaCuddles","CheerfulCheek","PetalPurr","BubblyBumblebee","AngelWhispers","JollyJester","WhiskerWonder","SprinkleSunshine","GigglyGiraffe","DancingDandelion","SunnySideUp","SnugglySheep","CuteKoala","PeachyPanda","BouncyBunny","DazzlingDaisy"],oo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M200-120q-33%200-56.5-23.5T120-200v-560q0-33%2023.5-56.5T200-840h357l-80%2080H200v560h560v-278l80-80v358q0%2033-23.5%2056.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12%2027-18t30-6q16%200%2030.5%206t26.5%2018l56%2057q11%2012%2017%2026.5t6%2029.5q0%2015-5.5%2029.5T897-728L530-360H360Zm481-424-56-56%2056%2056ZM440-440h56l232-232-28-28-29-28-231%20231v57Zm260-260-29-28%2029%2028%2028%2028-28-28Z'/%3e%3c/svg%3e",io={data(){return{usedSpace:0,totalSpace:1,unit:"MB"}},computed:{fillPercentage(){return`${Math.min(this.usedSpace/this.totalSpace,1)*100}%`}},mounted(){this.usedSpace=0,this.totalSpace=1,this.unit="MB",this.fetchDiskUsage()},methods:{fetchDiskUsage(){G().conn.reqDatabaseUsage().then(o=>{const t=(o.disk_usage/1024/1024).toFixed(1),e=(o.disk_limit/1024/1024).toFixed(1);e>1024?(this.unit="GB",this.usedSpace=(t/1024).toFixed(1),this.totalSpace=(e/1024).toFixed(1)):(this.unit="MB",this.usedSpace=t,this.totalSpace=e)},()=>{console.log("failed to fetch disk usage")})}}},lo={id:"disk-usage-main"},ro={class:"disk-usage-bar"},uo={class:"disk-usage-text"};function co(o,t,e,a,s,i){return c(),y("div",lo,[n("div",ro,[n("div",{class:"disk-usage-fill",style:ee({width:i.fillPercentage})},null,4)]),n("div",uo," Space: "+T(s.usedSpace)+" / "+T(s.totalSpace)+" "+T(s.unit),1)])}const ho=O(io,[["render",co],["__scopeId","data-v-6a56d11b"]]),ot=o=>(ne("data-v-7202375c"),o=o(),ae(),o),po={id:"usercard-main"},fo={id:"user-settings"},mo=ot(()=>n("hr",null,null,-1)),vo=ot(()=>n("summary",null,"Change password",-1)),go={id:"password-container"},_o={id:"info"},yo={id:"user-desc"},wo={id:"name-edit"},bo={id:"name"},ko=["src"],$o={key:0,class:"admin_hint"},So=ot(()=>n("div",{style:{height:"0.2rem"}},null,-1)),xo=L({__name:"UserCard",props:{userInfo:{},avatarSize:{default:"168px"}},emits:["update:userInfo"],setup(o,{emit:t}){const e=o,a=G().conn,s=t,i=R(()=>V().user.id===e.userInfo.id),l=w(null),r=w(d());function d(){return`${Be()}/user-avatar/${e.userInfo.username}?t=${Date.now()}&size=256`}function g(C){if(!C.type.startsWith("image/")){F().showPopup("Please select an image file","error");return}F().showPopup("Uploading avatar..."),a.uploadUserAvatar(e.userInfo.username,C).then(S=>{r.value=d(),s("update:userInfo",S)},S=>{F().showPopup(S,"error")})}const u=w(!1),p=w(""),f=w(""),_=w(""),v=w("");function D(){if(p.value===""||p.value===e.userInfo.name||p.value!==e.userInfo.name&&a.updateUserNickname(p.value).then(C=>{s("update:userInfo",C),u.value=!1},C=>{F().showPopup(C,"error")}),_.value!==""||v.value!==""){if(_.value===""){F().showPopup("Please enter the new password","error");return}if(_.value!==v.value){F().showPopup("The new passwords do not match","error");return}if(j().encKey!==pe(e.userInfo.username+pe(f.value))){F().showPopup("The old password is incorrect","error");return}a.updateUserPassword(_.value).then(C=>{const S=pe(e.userInfo.username+pe(_.value));j().setEncKey(S),f.value="",_.value="",v.value="",u.value=!1},C=>{F().showPopup(C,"error")})}}return(C,S)=>(c(),y("div",po,[x($e,{show:u.value,"onUpdate:show":S[4]||(S[4]=h=>u.value=h),title:"User settings",onOnCancel:S[5]||(S[5]=h=>u.value=!1),onOnAccept:D},{default:E(()=>[n("div",fo,[n("b",null,T(e.userInfo.username),1),z(n("input",{type:"text","onUpdate:modelValue":S[0]||(S[0]=h=>p.value=h),placeholder:"Nickname",class:"input"},null,512),[[Z,p.value]]),mo,n("details",null,[vo,n("div",go,[z(n("input",{type:"password","onUpdate:modelValue":S[1]||(S[1]=h=>f.value=h),placeholder:"Old password",class:"input"},null,512),[[Z,f.value]]),z(n("input",{type:"password","onUpdate:modelValue":S[2]||(S[2]=h=>_.value=h),placeholder:"New password",class:"input"},null,512),[[Z,_.value]]),z(n("input",{type:"password","onUpdate:modelValue":S[3]||(S[3]=h=>v.value=h),placeholder:"Confirm new password",class:"input"},null,512),[[Z,v.value]])])])])]),_:1},8,["show"]),n("div",_o,[n("div",{id:"avatar",style:ee(i.value?{cursor:"pointer",borderRadius:"50%"}:{})},[x(I(ha),{href:r.value,size:C.avatarSize,onClick:S[6]||(S[6]=h=>{var m;return i.value?(m=l.value)==null?void 0:m.click():()=>{}})},null,8,["href","size"]),x(I(Pe),{text:"Change avatar",action:g,ref_key:"avatarUploadBtn",ref:l,style:{display:"none"}},null,512)],4),n("div",yo,[n("div",wo,[n("h1",bo,T(e.userInfo.name),1),i.value?(c(),y("img",{key:0,src:I(oo),alt:"",class:"icon",id:"edit-settings-icon",onClick:S[7]||(S[7]=h=>u.value=!0)},null,8,ko)):B("",!0)]),n("p",{onClick:S[8]||(S[8]=h=>u.value=!0),style:{cursor:"pointer"}},[M(T(e.userInfo.username)+" ",1),e.userInfo.is_admin?(c(),y("label",$o,"admin")):B("",!0)]),x(ho),So])]),n("p",{id:"credential",onClick:S[9]||(S[9]=()=>{I(Ye)(I(j)().encKey).then(()=>{I(F)().showPopup("Secret copied to clipboard","info")})})},"-- Credential:"+T(I(j)().encKey.substring(0,12))+" --",1)]))}}),Co=O(xo,[["__scopeId","data-v-7202375c"]]),Do={props:{title:{type:String,required:!0},description:{type:String,required:!0}}},Po={class:"settings-container"},Io={class:"settings-header"},To={class:"widget"};function Uo(o,t,e,a,s,i){return c(),y("div",Po,[n("div",Io,[n("label",null,T(e.title),1),n("p",null,T(e.description),1)]),n("div",To,[me(o.$slots,"default",{},void 0,!0)])])}const Ne=O(Do,[["render",Uo],["__scopeId","data-v-f00f1fc8"]]),Ro=n("option",{value:"auto"},"Auto",-1),Ao=n("option",{value:"light"},"Light",-1),Bo=n("option",{value:"dark"},"Dark",-1),Lo=[Ro,Ao,Bo],Mo=L({__name:"ConfigTheme",setup(o){const t=w("auto");function e(){t.value=J.getThemeMode()}function a(s){s==="auto"?(J.clear(),J.setDefaultDarkMode()):s==="light"?J.setDarkMode(!1):s==="dark"&&J.setDarkMode(!0),e()}return e(),(s,i)=>(c(),K(Ne,{title:"Theme",description:"Change the theme of the app"},{default:E(()=>[z(n("select",{"onUpdate:modelValue":i[0]||(i[0]=l=>t.value=l),onChange:i[1]||(i[1]=l=>a(t.value)),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},Lo,544),[[Re,t.value]])]),_:1}))}}),qo={class:"switch-toggle"},Eo=L({__name:"SwitchToggle",props:{checked:{type:Boolean}},emits:["update:checked"],setup(o,{emit:t}){const a=w(o.checked),s=t,i=w(null);return(l,r)=>(c(),y("div",qo,[z(n("input",{type:"checkbox",id:"toggle","onUpdate:modelValue":r[0]||(r[0]=d=>a.value=d),onChange:r[1]||(r[1]=()=>{s("update:checked",a.value)}),ref_key:"checkerRef",ref:i},null,544),[[Lt,a.value]]),n("label",{class:"switch",onClick:r[2]||(r[2]=d=>{var g;return(g=i.value)==null?void 0:g.click()})})]))}}),Le=O(Eo,[["__scopeId","data-v-58ea3d44"]]),Fo=L({__name:"ConfigShowTags",setup(o){const t=j(),e=R({get:()=>t.showTagPanel,set:a=>t.setShowTagPanel(a)});return(a,s)=>(c(),K(Ne,{title:"Tag Display",description:"Show tag panel on the home page"},{default:E(()=>[x(Le,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),Oo=L({__name:"ConfigShowScatterPlot",setup(o){const t=j(),e=R({get:()=>t.show3DScatterPlot,set:a=>t.setShow3DScatterPlot(a)});return(a,s)=>(c(),K(Ne,{title:"Scatter Plot",description:"Show scatter plot on the home page"},{default:E(()=>[x(Le,{checked:e.value,"onUpdate:checked":s[0]||(s[0]=i=>e.value=i)},null,8,["checked"])]),_:1}))}}),zo=["value"],Ho=L({__name:"ConfigPageCapacity",setup(o){const t=R({get:()=>j().numItemsPerPage,set:a=>j().setNumItemsPerPage(a)}),e=[10,20,50,100,200,500];return(a,s)=>(c(),K(Ne,{title:"Page Capacity",description:"Smaller number can improve performance"},{default:E(()=>[z(n("select",{"onUpdate:modelValue":s[0]||(s[0]=i=>t.value=i),style:{width:"80px",textAlign:"center",padding:"0.2rem",justifySelf:"flex-end"}},[(c(),y(N,null,Q(e,i=>n("option",{value:i,key:i},T(i),9,zo)),64))],512),[[Re,t.value]])]),_:1}))}}),No={style:{display:"flex",flexDirection:"column",gap:"0.5rem",padding:"0.5rem",width:"100%",height:"100%",overflowY:"auto"}},Wo={style:{display:"flex",justifyContent:"center",alignItems:"center"}},jo=n("hr",null,null,-1),Vo=L({__name:"SettingsWindow",setup(o){const t=V().user;return(e,a)=>(c(),y("div",No,[n("div",Wo,[x(Co,{"user-info":I(t),"avatar-size":"120px"},null,8,["user-info"])]),jo,x(Mo),x(Ho),x(Fo),x(Oo)]))}}),Ko="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%2096%20960%20960'%20width='48'%3e%3cpath%20d='M180%20936q-24%200-42-18t-18-42V276q0-24%2018-42t42-18h291v60H180v600h291v60H180Zm486-185-43-43%20102-102H375v-60h348L621%20444l43-43%20176%20176-174%20174Z'/%3e%3c/svg%3e",Zo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='m263-263%20290-143%20143-290-290%20143-143%20290Zm217-177q-17%200-28.5-11.5T440-480q0-17%2011.5-28.5T480-520q17%200%2028.5%2011.5T520-480q0%2017-11.5%2028.5T480-440Zm0%20360q-82%200-155-31.5t-127.5-86Q143-252%20111.5-325T80-480q0-83%2031.5-156t86-127Q252-817%20325-848.5T480-880q83%200%20156%2031.5T763-763q54%2054%2085.5%20127T880-480q0%2082-31.5%20155T763-197.5q-54%2054.5-127%2086T480-80Zm0-60q142%200%20241-99.5T820-480q0-142-99-241t-241-99q-141%200-240.5%2099T140-480q0%20141%2099.5%20240.5T480-140Zm0-340Z'/%3e%3c/svg%3e",Go="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M240-200h120v-240h240v240h120v-360L480-740%20240-560v360Zm-80%2080v-480l320-240%20320%20240v480H520v-240h-80v240H160Zm320-350Z'/%3e%3c/svg%3e",Jo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M440-120v-240h80v80h320v80H520v80h-80Zm-320-80v-80h240v80H120Zm160-160v-80H120v-80h160v-80h80v240h-80Zm160-80v-80h400v80H440Zm160-160v-240h80v80h160v80H680v80h-80Zm-480-80v-80h400v80H120Z'/%3e%3c/svg%3e",Qo={class:"button"},Yo={key:0,id:"navigator"},Xo={class:"nav-toggle"},ei=L({__name:"Toolbar",props:{returnHome:{type:Boolean,default:!0},compact:{type:Boolean,default:!0},showNavigator:{type:Boolean,default:!0}},setup(o){const t=o,e=we();function a(){sn()}const s=w(null);let i=0;window.addEventListener("scroll",function(){const g=window.scrollY||document.documentElement.scrollTop;g<=i||i<10?s.value&&s.value.classList.contains("hidden")&&s.value.classList.remove("hidden"):s.value&&!s.value.classList.contains("hidden")&&s.value.classList.add("hidden"),i=g});const l=w(!1),r=vt(),d=R(()=>r.path.split("/")[1]);return(g,u)=>(c(),y(N,null,[x(Se,{show:l.value,"onUpdate:show":u[0]||(u[0]=p=>l.value=p),title:"Settings"},{default:E(()=>[x(Vo)]),_:1},8,["show"]),n("div",{class:he(`main-toolbar ${t.compact?"compact-layout":"normal-layout shadow"}`),ref_key:"mainDiv",ref:s},[n("div",Qo,[t.returnHome?(c(),K(ye,{key:0,iconSrc:I(Go),labelText:"Home",shortcut:"ctrl+h",onOnClick:u[1]||(u[1]=()=>{I(e).push("/")}),title:"home"},null,8,["iconSrc"])):(c(),K(ye,{key:1,iconSrc:I(Ko),labelText:"Logout",shortcut:"ctrl+q",onOnClick:a,title:"logout"},null,8,["iconSrc"])),x(ye,{iconSrc:I(Jo),labelText:"Settings",shortcut:"ctrl+,",onOnClick:u[2]||(u[2]=()=>{l.value=!0}),title:"Open settings"},null,8,["iconSrc"]),g.showNavigator?B("",!0):(c(),K(I($t),{key:2,menuItems:[{name:"Home",action:()=>{I(e).push("/")}},{name:"Feed",action:()=>{I(e).push("/feed")}},{name:"About",action:()=>{I(e).push("/about")}}]},{default:E(()=>[x(ye,{iconSrc:I(Zo),labelText:"Explore",shortcut:"ctrl+e",title:"look around"},null,8,["iconSrc"])]),_:1},8,["menuItems"]))]),g.showNavigator?(c(),y("div",Yo,[n("div",Xo,[n("div",{class:he(`button ${d.value==="home"||!d.value?"active-nav":""}`),onClick:u[3]||(u[3]=()=>{I(e).push("/")})},"Home",2),n("div",{class:he(`button ${d.value==="feed"?"active-nav":""}`),onClick:u[4]||(u[4]=()=>{I(e).push("/feed")})},"Feed",2),n("div",{class:he(`button ${d.value==="about"?"active-nav":""}`),onClick:u[5]||(u[5]=()=>{I(e).push("/about")})},"About",2)])])):B("",!0),me(g.$slots,"default",{},void 0,!0)],2)],64))}}),Me=O(ei,[["__scopeId","data-v-0d6cb588"]]),ti="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M453-280h60v-166h167v-60H513v-174h-60v174H280v60h173v166Zm27.266%20200q-82.734%200-155.5-31.5t-127.266-86q-54.5-54.5-86-127.341Q80-397.681%2080-480.5q0-82.819%2031.5-155.659Q143-709%20197.5-763t127.341-85.5Q397.681-880%20480.5-880q82.819%200%20155.659%2031.5Q709-817%20763-763t85.5%20127Q880-563%20880-480.266q0%2082.734-31.5%20155.5T763-197.684q-54%2054.316-127%2086Q563-80%20480.266-80Zm.234-60Q622-140%20721-239.5t99-241Q820-622%20721.188-721%20622.375-820%20480-820q-141%200-240.5%2098.812Q140-622.375%20140-480q0%20141%2099.5%20240.5t241%2099.5Zm-.5-340Z'/%3e%3c/svg%3e",xt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M480-160q-133%200-226.5-93.5T160-480q0-133%2093.5-226.5T480-800q85%200%20149%2034.5T740-671v-129h60v254H546v-60h168q-38-60-97-97t-137-37q-109%200-184.5%2075.5T220-480q0%20109%2075.5%20184.5T480-220q83%200%20152-47.5T728-393h62q-29%20105-115%20169t-195%2064Z'/%3e%3c/svg%3e",ni=L({__name:"Plot3d",props:{data:{}},setup(o,{expose:t}){const e=w(null),a=o,s=R(()=>a.data.map(v=>({x:v.x,y:v.y,z:v.z,mode:"markers",type:"scatter3d",hoverinfo:"text",hoverlabel:{bgcolor:"#181818",font:{color:"white"}},text:v.text,marker:{size:3.5,opacity:v.opacity,color:v.color}}))),i={autosize:!0,margin:{l:0,r:0,b:0,t:0},showlegend:!1,scene:{xaxis:{title:"",showticklabels:!1,tickfont:{size:10}},yaxis:{title:"",showticklabels:!1,tickfont:{size:10}},zaxis:{title:"",showticklabels:!1,tickfont:{size:10}}},paper_bgcolor:"#f6f6f6",plot_bgcolor:"#f6f6f6"},l={...i,paper_bgcolor:"#151515",plot_bgcolor:"#151515",font:{color:"white"}},r=w(J.isDarkMode()?"dark":"light");J.registerThemeChangeCallback(()=>{r.value=J.isDarkMode()?"dark":"light",p()});const d=R(()=>r.value==="dark"?l:i),g={modeBarButtonsToRemove:["toImage","sendDataToCloud","resetCameraLastSave3d","resetCameraDefault3d"],displaylogo:!1,responsive:!0};let u=null;function p(){if(!e.value)return;je.react(e.value,s.value,d.value,g),e.value.layout.scene&&u&&je.relayout(e.value,"scene.camera",u)}return t({update:p}),ve(()=>{je.newPlot(e.value,s.value,d.value,g).then(()=>{e.value.on("plotly_relayout",f=>{if(console.log("plotly_relayout",f),!f["scene.camera"])return;const _=f["scene.camera"];u=Te(_)})}),e.value.on("plotly_click",function(f){f.points||console.log("Not clicking on any data.");const _=f.points[0].x,v=f.points[0].y,D=f.points[0].z,C=f.points[0].pointNumber;console.log(`You clicked on ${_}, ${v}, ${D} (point ${C})}`)}),se(s,()=>{p()})}),(f,_)=>(c(),y("div",{id:"ploty-chart",ref_key:"plotlyChart",ref:e},null,512))}}),ai=O(ni,[["__scopeId","data-v-e21cc654"]]),si={id:"main-filtervis"},oi={key:0,id:"plot3dDiv"},ii={key:0,id:"loadingDiv",class:"full"},li={key:1,class:"status"},ri=L({__name:"FilterVis",setup(o){const t=V(),e=w(null),a=F(),s=j(),i=w(null),l=R(()=>{if(i.value===null)return{};const f=t.database.allKeys(),_={};for(const v of f)i.value[v]&&(_[v]=i.value[v]);return _});async function r(f,_="rgb(100, 100, 200)"){const v=l.value;if(!v)f=[];else for(let b=f.length-1;b>=0;b--)v[f[b]]===void 0&&f.splice(b,1);const D=f.length,C=await t.database.agetMany(f),S=new Float32Array(D),h=new Float32Array(D),m=new Float32Array(D),k=new Array(D);for(const[b,P]of f.entries()){let q=v[P];if(q==null)throw new Error("uid not found in feats: "+P);S[b]=q[0],h[b]=q[1],m[b]=q[2];const Y=C[b];k[b]=`${Y.authorYear()}<br>${Y.summary.title}`}let $;if(typeof _=="string")$=_;else if(_ instanceof Array)if(typeof _[0]=="string")$=_;else{const b=_,P=Math.max(...b),q=Math.min(...b),Y={0:J.isDarkMode()?[50,50,50]:[220,220,220],1:[50,200,150]};$=b.map(ce=>{const _e=(ce-q)/(P-q),de=Array(3);for(let be=0;be<3;be++)de[be]=Math.round(Y[0][be]*(1-_e)+Y[1][be]*_e);return`rgb(${de[0]}, ${de[1]}, ${de[2]})`})}else throw new Error("Invalid color type");return{x:S,y:h,z:m,opacity:.75,color:$,text:k}}const d=w(null);async function g(){const f=a.shownDataScores;let _;f?_=await r(Te(a.shownDataUIDs),f):_=await r(Te(a.shownDataUIDs));const D=t.database.allKeys().filter(h=>a.shownDataUIDs.indexOf(h)==-1),C=await r(D,J.isDarkMode()?"rgb(50, 50, 50)":"rgb(220, 220, 220)"),S=await r(Te(a.unfoldedDataUIDs),"rgb(255, 0, 0)");d.value=[_,C,S]}const u=R(()=>Object.keys(l.value).length>0);async function p(){i.value=null;const f=G().conn,_=(await f.status()).n_data;let v;_<50?v=-1:_<100?v=5:_<300?v=8:_<500?v=12:v=15,console.log("dataset size: ",_,"perp: ",v),i.value=await f.reqDatabaseFeatureTSNE("doc_feature",3,v)}return se(()=>[a.shownDataUIDs,a.unfoldedDataUIDs],()=>{g()}),se(()=>s.show3DScatterPlot,f=>{f&&p().then(()=>{g()})}),ve(()=>{s.show3DScatterPlot&&p().then(()=>{g()})}),(f,_)=>(c(),y("div",si,[I(s).show3DScatterPlot?(c(),y("div",oi,[x(ai,{data:d.value?d.value:[],ref_key:"plot3DRef",ref:e},null,8,["data"]),!u.value||!l.value?(c(),y("div",ii,[i.value===null?(c(),K(He,{key:0})):(c(),y("p",li,"Data not ready"))])):B("",!0)])):B("",!0)]))}}),ui=O(ri,[["__scopeId","data-v-b8368217"]]),ci={id:"searchbar"},di={id:"searchbar-container"},hi=["value"],pi=L({__name:"Searchbar",setup(o){const t=F(),e=["title","author","year","note","publication","feature","uuid"],a=w(""),s=w(null);function i(){const d={searchBy:s.value.value,content:a.value};t.searchState=d,console.log(d),t.updateShownData()}const l=_t(i,300);function r(d){return d.charAt(0).toUpperCase()+d.slice(1)}return(d,g)=>(c(),y("div",ci,[n("div",di,[n("select",{ref_key:"searchSelector",ref:s,name:"search_type",id:"searchType",onChange:i},[(c(),y(N,null,Q(e,u=>n("option",{value:u},T(r(u)),9,hi)),64))],544),z(n("input",{type:"text",id:"searchbar-input",placeholder:"Search","onUpdate:modelValue":g[0]||(g[0]=u=>a.value=u),onInput:g[1]||(g[1]=(...u)=>I(l)&&I(l)(...u))},null,544),[[Z,a.value]])])]))}}),fi=O(pi,[["__scopeId","data-v-758a2cfb"]]),mi=o=>(ne("data-v-3c78df46"),o=o(),ae(),o),vi={id:"main-home",class:"gradIn"},gi={class:"horizontal fullHeight"},_i={key:0,id:"left-panel"},yi={id:"right-panel",class:"panel1"},wi={class:"fullWidth"},bi={style:{display:"flex","justify-content":"space-between"}},ki={style:{"flex-grow":"1"}},$i={style:{display:"flex","flex-grow":"0","margin-right":"5px","margin-block":"5px"}},Si={key:1,id:"blankPlaceholder"},xi={key:0,style:{"font-size":"xx-large","font-weight":"bold","user-select":"none"}},Ci=mi(()=>n("br",null,null,-1)),Di={name:"Home",inheritAttrs:!1,customOptions:{}},Pi=L({...Di,setup(o){const t=F(),e=V(),a=j();window.innerWidth<768&&a.setShowTagPanel(!1);const i=we().currentRoute.value.query.tags;i!=null&&(t.tagStatus.checked=new H(i.split("&&")),t.tagStatus.unfolded=t.tagStatus.checked.allParents());const l=w(null);function r(){l.value.show({datapoint:null})}function d(u){var f;u.preventDefault();const p=(f=u.dataTransfer)==null?void 0:f.files;p&&(r(),l.value.loadFiles(p)||l.value.close())}function g(){t.reloadDatabase(),G().wsConn.resetReconnect()}return(u,p)=>(c(),y(N,null,[x(st,{ref_key:"dataEditor",ref:l},null,512),x(Me,{"return-home":!1,compact:!0}),n("div",vi,[n("div",gi,[x(Ue,{name:"left-in"},{default:E(()=>[I(a).showTagPanel?(c(),y("div",_i,[x(Ln,{onOnCheck:p[0]||(p[0]=()=>I(t).updateShownData())})])):B("",!0)]),_:1}),n("div",yi,[n("div",wi,[x(ui)]),n("div",{class:"scrollable",id:"fileSelector",onDragover:p[2]||(p[2]=f=>f.preventDefault()),onDrop:d},[n("div",bi,[n("div",ki,[x(fi)]),n("div",$i,[x(ye,{iconSrc:I(ti),labelText:"New",title:"Add new data to database",onClick:r,shortcut:"ctrl+n"},null,8,["iconSrc"]),x(ye,{iconSrc:I(xt),labelText:"Reload",title:"Reload database",onClick:g},null,8,["iconSrc"])])]),I(t).shownDataUIDs.length>0?(c(),K(Ae,{key:0,uids:I(t).shownDataUIDs,unfoldedIds:I(t).unfoldedDataUIDs,"onUpdate:unfoldedIds":p[1]||(p[1]=f=>I(t).unfoldedDataUIDs=f)},null,8,["uids","unfoldedIds"])):(c(),y("div",Si,[I(e).database.initialized?(c(),y("p",xi,[M(" Nothing to show "),n("p",{style:{"font-size":"medium"}},[M(" Add your first enty by clicking the "),n("b",null,[n("a",{onClick:r,style:{cursor:"pointer","border-radius":"5px","padding-inline":"3px","background-color":"var(--color-background-soft)"}},"⊕ New")]),M(" button above."),Ci])])):(c(),K(He,{key:1}))]))],32)])])])],64))}}),Ii=O(Pi,[["__scopeId","data-v-3c78df46"]]);function Ti(o,t=!1){t&&(o*=1e3);const e=new Date(o);let a=e.getFullYear().toString();a.length!==4&&(a="0".repeat(4-a.length)+a);let s=(e.getMonth()+1).toString();s.length===1&&(s="0"+s);let i=e.getDate().toString();i.length===1&&(i="0"+i);let l=`${a}-${s}-${i} `;const r={hourCycle:"h23",hour:"2-digit",minute:"2-digit",second:"2-digit"};return l+=e.toLocaleTimeString([],r),l}const Ui=o=>(ne("data-v-23118de8"),o=o(),ae(),o),Ri={id:"authorPapers"},Ai={id:"feed-main",class:"slideInFast"},Bi={class:"articleBlock"},Li={class:"titleBlock"},Mi={style:{"font-weight":"bold"}},qi={style:{display:"flex","flex-direction":"row","justify-content":"center","align-items":"center"}},Ei={class:"titleId"},Fi={class:"authors"},Oi={class:"authorSpan"},zi=["href"];const Hi=["onClick"],Ni={key:3},Wi={class:"actions"},ji=["href"],Vi=["href"],Ki=Ui(()=>n("summary",null,"Abstract",-1)),Zi={id:"relatedArticles"},Gi=L({__name:"ArticleBlock",props:{article:{}},setup(o){const t=o,e=V(),a=G().conn,s=w(null);async function i(){var C;(C=s.value)==null||C.show({datapoint:null,bibtex:t.article.bibtex,tags:[],url:t.article.url})}const l=w({});async function r(){for(let C=0;C<t.article.authors.length;C++){const S=t.article.authors[C],h=t.article.authors_other_publications[C],m=await e.database.agetMany(h);l.value[S]=m}}r();const d=R(()=>{const C={};for(const S in l.value)l.value[S]?C[S]=l.value[S].length:C[S]=null;return C}),g=w(!1),u=w([]);function p(C){u.value=l.value[C],u.value||(u.value=[]),g.value=!0}const f=w([]),_=w([]),v=R(()=>{const C={};for(let S=0;S<f.value.length;S++)C[f.value[S].summary.uuid]=_.value[S].toPrecision(4);return C});function D(){f.value.length>0||a.filter({searchBy:"feature",searchContent:t.article.abstract,maxResults:10}).then(C=>{const S=C.scores,h=C.uids,m=wt(h,S);e.database.agetMany(m[0],!1).then(k=>{f.value=k;const $=[];for(const b of k){const P=h.indexOf(b.summary.uuid);P>=0&&$.push(S[P])}_.value=$})})}return(C,S)=>(c(),y(N,null,[x(st,{ref_key:"dataEditor",ref:s},null,512),x(Se,{show:g.value,"onUpdate:show":S[0]||(S[0]=h=>g.value=h),title:"Publications in the database",onOnClose:S[1]||(S[1]=h=>u.value=[])},{default:E(()=>[n("div",Ri,[x(Ae,{uids:u.value.map(h=>h.summary.uuid)},null,8,["uids"])])]),_:1},8,["show"]),n("div",Ai,[n("div",Bi,[n("div",Li,[n("h2",Mi,T(t.article.title),1),n("div",qi,[x(et,{tags:t.article.tags},null,8,["tags"]),n("label",Ei,T(t.article.uuid),1)])]),n("div",Fi,[(c(!0),y(N,null,Q(t.article.authors,(h,m)=>(c(),y("span",Oi,[(c(),y("a",{key:0,class:"link",href:`https://arxiv.org/search/?query=${h}&searchtype=author`,target:"_blank"},T(h),9,zi)),d.value[h]?(c(),y("a",{key:2,class:"pubCount",onClick:()=>p(h)},T(`(${d.value[h]})`),9,Hi)):B("",!0),m<t.article.authors.length-1?(c(),y("span",Ni,", ")):B("",!0)]))),256))]),n("div",Wi,[n("a",{href:C.article.url,target:"_blank"},"Link",8,ji),M(" | "),n("a",{href:`https://arxiv.org/pdf/${C.article.uuid}.pdf`,target:"_blank"},"PDF",8,Vi),M(" | "),n("a",{onClick:i},"Collect")]),n("p",null,"Added: "+T(I(Ti)(t.article.time_added,!0)),1),n("details",null,[Ki,n("p",null,T(t.article.abstract),1)]),n("details",null,[n("summary",{onClick:D},"Related articles"),n("div",Zi,[x(Ae,{uids:f.value.map(h=>h.summary.uuid),scores:v.value},null,8,["uids","scores"])])])])])],64))}}),Ji=O(Gi,[["__scopeId","data-v-23118de8"]]),Ct=o=>(ne("data-v-5b486ca2"),o=o(),ae(),o),Qi={id:"toolbar"},Yi={id:"main"},Xi={style:{"margin-block":"1rem"}},el=["src"],tl={id:"settings"},nl={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem","flex-flow":"row wrap"}},al=["value"],sl=["value"],ol={style:{display:"flex","justify-content":"center","align-items":"center",width:"100%",gap:"0.5rem"}},il={key:0,id:"loadingPlaceholder"},ll=Ct(()=>n("b",null,"Fetching...",-1)),rl={key:1,id:"loadingPlaceholder"},ul=Ct(()=>n("b",null,"No articles found",-1)),cl=[ul],dl=L({__name:"Feed",setup(o){const t=G().conn,e=we();function a(m=0){const k=new Date;return k.setDate(k.getDate()+m),k.toISOString().split("T")[0]}const s=w("arxiv"),i=w(!1),l=w(["arxiv"]),r=w(a(1)),d=w(a(-1)),g=w(parseInt(e.currentRoute.value.query.maxResults)||100),u=w(""),p=w(null),f=w([]),_=R(function(){return[...f.value].sort((k,$)=>{if(p.value===null||!k.feature||!$.feature)return 0;{const b=new Float32Array(k.feature),P=new Float32Array($.feature),q=p.value,Y=b.reduce((ce,_e,de)=>ce+(_e-q[de])**2,0),ie=P.reduce((ce,_e,de)=>ce+(_e-q[de])**2,0);return Y-ie}})});function v(){if(u.value.trim()===""){p.value=null;return}t.featurizeText(u.value).then(m=>{p.value=new Float32Array(m)},()=>{console.log("failed to featurize")})}const D=_t(v,100);g.value>200&&(window.alert("maxResults cannot be larger than 200"),g.value=200);let C=e.currentRoute.value.query.search||"";C!==""&&(u.value=C);const S=w(null);async function h(){f.value=[];const m=G().conn;l.value=["arxiv"].concat(await m.reqFeedCategories()),i.value=!0;const k=new Date(r.value).getTime()/1e3,$=new Date(d.value).getTime()/1e3;try{const b=await m.reqFeedList({maxResults:g.value,category:s.value,timeBefore:k,timeAfter:$});f.value=b,v()}finally{i.value=!1}}return ve(()=>{h().then(()=>S.value.classList.remove("spin"),()=>{S.value.classList.remove("spin"),window.alert("Failed to fetch articles")})}),(m,k)=>(c(),y(N,null,[n("div",Qi,[x(Me,{ref:"toolbar"},null,512)]),n("div",Yi,[n("h1",Xi,[M(" Daily Feed "),n("img",{ref_key:"refreshButton",ref:S,src:I(xt),alt:"",class:"icon spin",title:"refresh the page",onClick:k[0]||(k[0]=$=>{const b=$.target;b.classList.contains("spin")||(b.classList.add("spin"),h().then(()=>b.classList.remove("spin")))})},null,8,el)]),n("div",tl,[n("div",nl,[n("span",null,[M(" Category: "),z(n("select",{name:"category",id:"category-select","onUpdate:modelValue":k[1]||(k[1]=$=>s.value=$),onChange:h},[(c(!0),y(N,null,Q(l.value,$=>(c(),y("option",{value:$},T($),9,al))),256))],544),[[Re,s.value]])]),n("span",null,[M(" Max results: "),z(n("select",{"onUpdate:modelValue":k[2]||(k[2]=$=>g.value=$),onChange:h},[(c(),y(N,null,Q([20,50,100,200,500],$=>n("option",{value:$},T($),9,sl)),64))],544),[[Re,g.value]])]),n("span",null,[M(" From: "),z(n("input",{type:"date","onUpdate:modelValue":k[3]||(k[3]=$=>d.value=$),onChange:h},null,544),[[Z,d.value]])]),n("span",null,[M(" To: "),z(n("input",{type:"date","onUpdate:modelValue":k[4]||(k[4]=$=>r.value=$),onChange:h},null,544),[[Z,r.value]])])]),n("div",ol,[z(n("input",{type:"text",placeholder:"Search",onInput:k[5]||(k[5]=(...$)=>I(D)&&I(D)(...$)),"onUpdate:modelValue":k[6]||(k[6]=$=>u.value=$),autocomplete:"off"},null,544),[[Z,u.value]])])]),_.value.length===0&&i.value?(c(),y("div",il,[ll,x(He)])):B("",!0),_.value.length===0&&!i.value?(c(),y("div",rl,cl)):B("",!0),(c(!0),y(N,null,Q(_.value,$=>(c(),K(Ji,{article:$},null,8,["article"]))),256))])],64))}}),hl=O(dl,[["__scopeId","data-v-5b486ca2"]]),pl={class:"main"},fl={id:"login",class:"slideIn"},ml={class:"loginLine"},vl={class:"loginLine"},gl=["type"],_l={class:"options"},yl={key:0,class:"error"},wl=L({__name:"LoginInput",setup(o){const t=w(""),e=w(""),a=w(""),s=w(!0),i=w(!1),l=R(()=>i.value?"text":"password"),r=w("Login"),d=we(),g=w(""),u=w("");d.isReady().then(()=>{Mt(()=>{g.value=j().backendHost,u.value=j().backendPort})});function p(){j().setBackendHost(g.value),j().setBackendPort(u.value),r.value="Connecting...";const f=ln(t.value,e.value);G().conn.authUsr(f).then(v=>{Xe(f,v,s.value),a.value="";const D=d.currentRoute.value.query.from;D?(console.log("Redirecting to",D),d.push(D)):d.push("/"),r.value="Login"},v=>{a.value=v,r.value="Login"})}return(f,_)=>(c(),y("div",pl,[n("div",fl,[n("form",null,[n("div",ml,[z(n("input",{class:"key-input",type:"text",id:"username-input","onUpdate:modelValue":_[0]||(_[0]=v=>t.value=v),placeholder:"Username",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[Z,t.value]])]),n("div",vl,[z(n("input",{class:"key-input",type:l.value,id:"password-input","onUpdate:modelValue":_[1]||(_[1]=v=>e.value=v),placeholder:"Password"},null,8,gl),[[Ge,e.value]])]),n("div",_l,[x(ke,{checked:s.value,onOnCheck:_[2]||(_[2]=()=>{s.value=!s.value})},{default:E(()=>[M("Stay login")]),_:1},8,["checked"]),x(ke,{checked:i.value,onOnCheck:_[3]||(_[3]=()=>{i.value=!i.value})},{default:E(()=>[M("Show key")]),_:1},8,["checked"])]),B("",!0),n("button",{type:"submit",onClick:Fe(p,["prevent"])},T(r.value),1)]),a.value?(c(),y("p",yl,T(a.value),1)):B("",!0)])]))}}),bl=O(wl,[["__scopeId","data-v-f6f2f179"]]),kl={data(){return{invitationCode:"",username:"",password:"",passwordConfirm:"",name:"",showPassword:!1}},emits:["register-success","register-fail"],components:{SwitchToggle:Le},methods:{submitForm(){if(this.password!==this.passwordConfirm){this.$emit("register-fail","Passwords do not match");return}G().conn.registerUser(this.invitationCode,this.username,this.password,this.name).then(()=>{this.$emit("register-success")},o=>{this.$emit("register-fail",o)})}}},Ce=o=>(ne("data-v-7a61f3c2"),o=o(),ae(),o),$l={style:{color:"var(--color-text-soft)","padding-inline":"0.5rem","margin-bottom":"1rem","font-size":"small"}},Sl={id:"show-password-container"},xl=Ce(()=>n("label",null,"Show password",-1)),Cl=Ce(()=>n("td",{style:{color:"var(--color-theme)"}},"Invitation Code",-1)),Dl=Ce(()=>n("td",null,"Username",-1)),Pl=Ce(()=>n("td",null,"Password",-1)),Il={style:{display:"flex","flex-direction":"row"}},Tl=["type"],Ul=Ce(()=>n("td",null,"Confirm Password",-1)),Rl=["type"],Al=Ce(()=>n("td",null,"Name",-1)),Bl=Ce(()=>n("tr",null,[n("td",{colspan:"2",style:{"text-align":"center",padding:"0px"}},[n("button",{type:"submit"},"REGISTER")])],-1));function Ll(o,t,e,a,s,i){const l=Je("SwitchToggle");return c(),y("form",{onSubmit:t[6]||(t[6]=(...r)=>i.submitForm&&i.submitForm(...r)),id:"registration-form"},[n("div",$l,[M(" Get an invitation code from the server administrator "),n("div",Sl,[x(l,{checked:s.showPassword,"onUpdate:checked":t[0]||(t[0]=r=>s.showPassword=r)},null,8,["checked"]),xl])]),n("table",null,[n("tr",null,[Cl,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=r=>s.invitationCode=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[Z,s.invitationCode]])])]),n("tr",null,[Dl,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=r=>s.username=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[Z,s.username]])])]),n("tr",null,[Pl,n("td",null,[n("div",Il,[z(n("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[3]||(t[3]=r=>s.password=r),required:""},null,8,Tl),[[Ge,s.password]])])])]),n("tr",null,[Ul,n("td",null,[z(n("input",{type:`${s.showPassword?"text":"password"}`,"onUpdate:modelValue":t[4]||(t[4]=r=>s.passwordConfirm=r),required:""},null,8,Rl),[[Ge,s.passwordConfirm]])])]),n("tr",null,[Al,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=r=>s.name=r),required:"",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[Z,s.name]])])]),Bl])],32)}const Ml=O(kl,[["render",Ll],["__scopeId","data-v-7a61f3c2"]]),ql={id:"login-main"},El={id:"container"},Fl={for:"login",id:"info"},Ol=["href"],zl=L({__name:"Login",setup(o){J.setDefaultDarkMode();const t=w(!1);return(e,a)=>(c(),y(N,null,[x(Se,{title:"User registration",show:t.value,"onUpdate:show":a[2]||(a[2]=s=>t.value=s),compact:!0},{default:E(()=>[x(Ml,{onRegisterSuccess:a[0]||(a[0]=()=>{t.value=!1,I(F)().showPopup("Registration successful","success")}),onRegisterFail:a[1]||(a[1]=s=>I(F)().showPopup(s,"error"))})]),_:1},8,["show"]),n("div",ql,[n("div",El,[x(bl),n("label",Fl,[M(" Need assistant? - "),n("a",{onClick:a[3]||(a[3]=s=>t.value=!0)},"Register"),M(" | "),n("a",{href:`mailto:${I(so).email}`},"Contact me",8,Ol)])])])],64))}}),Hl=O(zl,[["__scopeId","data-v-a5e435c3"]]);class Nl{constructor(t){X(this,"router");this.router=t}getURLParams(){const t={},e=this.router.currentRoute.value.query;for(const a in e)t[a]=e[a];return t}setURLParam(t,e){const a=this.getURLParams();a[t]=e,this.router.push({query:a})}updateURLWithParam(t,e){const a=this.getURLParams();return a[t]=e,this.router.resolve({query:a}).href}}function Wl(o,{router:t=null,datapoint:e=null}){const a=t?new Nl(t):null;if(o=o.replace(/^---[\s\S]*?---/,""),e){const s=V().user;o=o.replace(new RegExp("./misc/","g"),`${Be()}/misc/${e.summary.uuid}?_u=${s.id}&&fname=`),a&&(window.location.href.includes("/reader/")?o=o.replace(new RegExp("\\$\\{doc\\}#","g"),a.updateURLWithParam("docHashMark","")):o=o.replace(new RegExp("\\$\\{doc\\}#","g"),`${e.getOpenDocURL()}#`))}return o}const jl=o=>(ne("data-v-e74ce2dd"),o=o(),ae(),o),Vl={id:"noteEditor"},Kl={key:2,id:"save-hint"},Zl={style:{"padding-inline":"5px","padding-block":"0.5rem"}},Gl={key:0,style:{display:"flex",gap:"5px"}},Jl=jl(()=>n("label",{class:"frontmatter-label"},"LINKS",-1)),Ql=["href"],Yl={key:1,style:{display:"flex"}},Xl={id:"btn-container"},er=["id"],tr={key:0,id:"misc-container",class:"hover-scrollable"},nr={key:0,style:{"font-weight":"bold",color:"var(--color-text-soft)",top:"0.5rem"}},ar=["href"],sr={key:0,style:{color:"var(--color-text-soft)"}},or={class:"misc-file-op-container"},ir=["onClick"],lr=["onClick"],rr=["onClick"],ur=L({__name:"NoteEditor",props:{datapoint:{},theme:{default:"light"}},setup(o,{expose:t}){const e=o,a=we(),s=w(""),i=w({});se(()=>s.value,b=>{try{const P=jt(b);if(typeof P.data!="object"||P.data===i.value)return;i.value=P.data,console.log("DEBUG: front matter",i.value)}catch{}});const l=R(()=>Wl(s.value,{router:a,datapoint:e.datapoint})),r=w(null),d=F(),g=w([]),u=w(""),p=R(()=>u.value===s.value?"":"Unsaved");async function f(){if(e.datapoint.isDummy())return;const b=await e.datapoint.fetchNote();u.value=b,s.value=b,b.trim().length>0&&(m.value=!0)}async function _(){g.value=await e.datapoint.listMiscFiles()}async function v(){e.datapoint.isDummy()||await Promise.all([f(),_()])}v(),se(()=>e.datapoint,()=>{v(),console.log("datapoint changed, fetching note and misc files...")});async function D(){await e.datapoint.uploadNote(s.value),u.value=s.value}const C=async b=>{await e.datapoint.deleteMiscFile(b),g.value=g.value.filter(P=>P.fname!==b),F().showPopup("File deleted","info")},S=async(b,P)=>{if(b.split(".").pop()!==P.split(".").pop()){F().showPopup("File extension must be the same","error");return}await e.datapoint.renameMiscFile(b,P),s.value=s.value.replace(b,P),_(),F().showPopup("File renamed","info")},h=async b=>{(await e.datapoint.uploadMisc(b)).map(q=>r.value.insert(()=>({targetValue:`![image](${q})`,select:!1,deviationStart:0,deviationEnd:0}))),D(),_()},m=w(!1);function k(b){return s.value.indexOf(b)>=0}function $(b){const P=window.prompt(b);if(!P)throw new Error("User cancelled");return P}return t({preview:m,fetchNote:f}),Qt("update_note",b=>{if(b.session_id===G().wsConn.sessionID)return;b.datapoint_summary.uuid===e.datapoint.uid&&v().then(()=>{F().showPopup("update from other clients","info")})}),(b,P)=>(c(),y("div",Vl,[n("div",{class:"editor",onDblclick:P[1]||(P[1]=q=>m.value=!1)},[m.value?(c(),K(I(Wt),{key:1,"model-value":l.value,theme:b.theme,"preview-theme":"vuepress"},null,8,["model-value","theme"])):(c(),K(I(Nt),{key:0,ref_key:"mdEditor",ref:r,modelValue:s.value,"onUpdate:modelValue":P[0]||(P[0]=q=>s.value=q),preview:!1,language:"en-US",theme:b.theme,onOnSave:D,onOnUploadImg:h,toolbars:["bold","underline","italic","-","strikeThrough","title","quote","unorderedList","orderedList","task","-","link","-","revoke","next","save","=","catalog"]},null,8,["modelValue","theme"])),!m.value&&p.value?(c(),y("div",Kl,T(p.value),1)):B("",!0)],32),n("div",Zl,[(c(!0),y(N,null,Q(i.value,(q,Y)=>(c(),y(N,{key:Y},[Y=="links"?(c(),y("div",Gl,[Jl,(c(!0),y(N,null,Q(q,(ie,ce)=>(c(),y(N,{key:b.i},[typeof ce=="string"?(c(),y("a",{key:0,class:"frontmatter-link",href:ie,target:"_blank"},T(ce),9,Ql)):B("",!0)],64))),128))])):(c(),y("div",Yl,[M(" [unknown-entry] "),n("b",null,T(Y)+": ",1),M(T(q),1)]))],64))),128))]),n("div",Xl,[n("button",{onClick:P[2]||(P[2]=q=>m.value=!m.value)},T(m.value?"Edit":"Preview"),1),x(I(Pe),{action:q=>{e.datapoint.uploadMisc([q]).then(Y=>{I(F)().showPopup("File uploaded","success"),_(),r.value.insert(()=>({targetValue:`[${q.name}](${Y[0]})`,select:!1,deviationStart:0,deviationEnd:0}))})}},null,8,["action"])]),n("div",{id:"misc-toggle",onClick:P[3]||(P[3]=()=>{I(d).showMiscPanel=!I(d).showMiscPanel})},[n("div",{id:I(d).showMiscPanel?"triangle-down":"triangle"},null,8,er)]),I(d).showMiscPanel?(c(),y("div",tr,[g.value.length===0?(c(),y("div",nr," No attached files. ")):B("",!0),(c(!0),y(N,null,Q(g.value,q=>(c(),y("div",{key:q.fname,class:"misc-file"},[n("div",null,[n("a",{href:q.url,target:"_blank"},T(q.fname),9,ar),k(q.fname)?B("",!0):(c(),y("label",sr," (no-ref) "))]),n("div",or,[n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:Y=>{I(Ye)(q.fname),I(F)().showPopup("Copied")}}," copy ",8,ir),n("a",{style:{color:"var(--color-text-soft)",cursor:"pointer"},onClick:Y=>S(q.fname,$("New name"))}," rename ",8,lr),k(q.fname)?B("",!0):(c(),y("a",{key:0,style:{color:"var(--color-danger)",cursor:"pointer"},onClick:Y=>C(q.fname)}," delete ",8,rr))])]))),128))])):B("",!0)]))}}),cr=O(ur,[["__scopeId","data-v-e74ce2dd"]]),dr=o=>(ne("data-v-42acbd7b"),o=o(),ae(),o),hr={id:"body"},pr=["src"],fr=dr(()=>n("div",{style:{color:"var(--color-text-soft)","font-weight":"bold","font-size":"large"}},"No file, drag and drop to  ",-1)),mr=L({__name:"ReaderBody",props:{datapoint:{},layoutType:{}},setup(o,{expose:t}){const e=o,a=we(),s=R(()=>{const k=a.currentRoute.value.query.docHashMark;return k||""}),i=w(null),l=w(null),r=w(null),d=w(!1),g=w(null);t({noteEditor:g});function u(m){r.value&&r.value.contains(m.target)&&(d.value=!0)}function p(){d.value=!1}const f=R({get:()=>F().preferredReaderLeftPanelWidthPerc,set:m=>{F().preferredReaderLeftPanelWidthPerc=m}});function _(m){if(d.value&&i.value&&l.value&&r.value){const $=("touches"in m?m.touches[0].clientX:m.clientX)-i.value.getBoundingClientRect().left;i.value.style.width=`${$}px`,l.value.style.width=`calc(100% - ${$}px)`,f.value=$/($+l.value.getBoundingClientRect().width),f.value=Math.max(.1,Math.min(.9,f.value))}}window.addEventListener("mousedown",u),window.addEventListener("touchstart",u),window.addEventListener("mouseup",p),window.addEventListener("touchend",p),window.addEventListener("mousemove",_),window.addEventListener("touchmove",_);const v=R(()=>e.layoutType==0||e.layoutType==2),D=R(()=>e.layoutType==1||e.layoutType==2);function C(m){m==2&&(i.value.style.width=`${f.value*100}%`,l.value.style.width=`${(1-f.value)*100}%`),j().setReaderLayoutType(m)}se(()=>e.layoutType,(m,k)=>{console.log("layoutType changed:",k,"->",m),C(m)});const S=w(J.isDarkMode()?"dark":"light");J.registerThemeChangeCallback(()=>S.value=J.isDarkMode()?"dark":"light");const h=R(()=>`${e.datapoint.getOpenDocURL({extraPDFViewerParams:{"color-mode":S.value},urlHashMark:s.value})}`);return ve(()=>{C(e.layoutType)}),(m,k)=>(c(),y("div",hr,[z(n("div",{class:"pane",id:"left-pane",ref_key:"leftPane",ref:i},[m.datapoint.summary.has_file?(c(),y("iframe",{key:0,src:h.value,title:"doc",frameborder:"0",style:ee({"pointer-events":d.value?"none":"auto"})},null,12,pr)):(c(),y("div",{key:1,style:{display:"flex","justify-content":"center","align-items":"center",height:"100%",width:"100%"},onDragover:k[0]||(k[0]=$=>$.preventDefault()),onDrop:k[1]||(k[1]=$=>{var P;$.preventDefault();const b=(P=$.dataTransfer)==null?void 0:P.files;b&&b.length==1&&m.datapoint.uploadDocument(b[0]).then(()=>{I(F)().showPopup("File uploaded")})})},[fr,x(I(Pe),{action:$=>m.datapoint.uploadDocument($),text:"upload","as-link":!0,style:{"font-weight":"bold","font-size":"large",cursor:"pointer"}},null,8,["action"])],32))],512),[[Ze,v.value]]),m.layoutType==2?(c(),y("div",{key:0,id:"splitter",ref_key:"splitter",ref:r,onMousedown:u,onTouchstart:u},null,544)):B("",!0),z(n("div",{class:"pane",id:"right-pane",ref_key:"rightPane",ref:l},[x(cr,{datapoint:m.datapoint,theme:S.value,ref_key:"noteEditor",ref:g},null,8,["datapoint","theme"])],512),[[Ze,D.value]])]))}}),vr=O(mr,[["__scopeId","data-v-42acbd7b"]]),gr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M180-120q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H180Zm390%200q-24%200-42-18t-18-42v-600q0-24%2018-42t42-18h210q24%200%2042%2018t18%2042v600q0%2024-18%2042t-42%2018H570Zm210-660H570v600h210v-600ZM570-180h210-210Z'/%3e%3c/svg%3e",_r="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='48'%20viewBox='0%20-960%20960%20960'%20width='48'%3e%3cpath%20d='M220-160q-24%200-42-18t-18-42v-143h60v143h520v-143h60v143q0%2024-18%2042t-42%2018H220Zm230-153v-371L330-564l-43-43%20193-193%20193%20193-43%2043-120-120v371h-60Z'/%3e%3c/svg%3e",yr={id:"toolbarOps"},wr={id:"recently-read"},br={id:"main-reader",class:"gradIn"},kr={name:"Reader",inheritAttrs:!1,customOptions:{}},$r=L({...kr,setup(o){const t=V(),e=F(),a=vt(),s=we(),i=w(t.database.getDummy());async function l(){const v=await t.database.aget(a.params.id);v&&(i.value=v),e.addRecentlyReadDataUID(v.uid),t.database.agetMany(e.recentlyReadDataUIDs).then(D=>{d(D)}),console.log("Reader: updated datapoint",v.summary.title,"uid",v.uid)}se(()=>a.params.id,()=>{l()});const r=w([]);function d(v){const D=[];for(const C of v)C.summary.uuid!==a.params.id&&D.push({name:C.authorYear(),action:()=>{s.push("/reader/"+C.summary.uuid)}});console.log("Reader: updated recent read menu items",D),r.value=D}const g=w(j().readerLayoutType);window.innerWidth<800&&(g.value=0);function u(){if(window.innerWidth<800)g.value=(g.value+1)%2;else switch(g.value){case 0:g.value=2;break;case 1:g.value=2;break;case 2:g.value=0;break}}const p=w(null);function f(v){function D(){i.value.uploadDocument(v).then(C=>{i.value.update(C),e.showPopup("Document uploaded","success")},()=>e.showPopup("Failed to upload document","error"))}i.value.summary.has_file?i.value.freeDocument().then(C=>{i.value.update(C),D()},()=>e.showPopup("Failed to free document","error")):D()}const _=w(null);return ve(()=>{console.log("Reader mounted"),l()}),(v,D)=>(c(),y(N,null,[x(I(Pe),{action:f,ref_key:"fileSelectionBtn",ref:p,style:{display:"none"}},null,512),x(Me,{compact:!0,"show-navigator":!1},{default:E(()=>[n("div",yr,[x(ye,{iconSrc:I(gr),labelText:"layout",shortcut:"ctrl+r",onOnClick:u,title:"change layout"},null,8,["iconSrc"]),x(ye,{iconSrc:I(_r),labelText:"replace",shortcut:"ctrl+u",onOnClick:D[0]||(D[0]=()=>p.value.click()),title:"upload a new document"},null,8,["iconSrc"]),x(I($t),{"menu-items":r.value},{default:E(()=>[n("div",wr,T(`${i.value.authorAbbr()} (${i.value.summary.year})`),1)]),_:1},8,["menu-items"])])]),_:1}),n("div",br,[x(vr,{datapoint:i.value,layoutType:g.value,ref_key:"readerBody",ref:_},null,8,["datapoint","layoutType"])])],64))}}),Sr=O($r,[["__scopeId","data-v-65a770f6"]]),xr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%3e%3cpath%20d='M160-400v-80h280v80H160Zm0-160v-80h440v80H160Zm0-160v-80h440v80H160Zm360%20560v-123l221-220q9-9%2020-13t22-4q12%200%2023%204.5t20%2013.5l37%2037q8%209%2012.5%2020t4.5%2022q0%2011-4%2022.5T863-380L643-160H520Zm300-263-37-37%2037%2037ZM580-220h38l121-122-18-19-19-18-122%20121v38Zm141-141-19-18%2037%2037-18-19Z'/%3e%3c/svg%3e",te=o=>(ne("data-v-a87fab58"),o=o(),ae(),o),Cr={id:"users-widget-main"},Dr={id:"user-editor-main"},Pr={class:"horizontal"},Ir=["src"],Tr={id:"user-editor"},Ur={class:"horizontal"},Rr={class:"horizonal",style:{display:"flex","align-items":"center",gap:"0.5rem"}},Ar=te(()=>n("b",null,"Administrator ",-1)),Br={class:"full-width left-align"},Lr=te(()=>n("b",null,"Max Storage (MB):",-1)),Mr=te(()=>n("br",null,null,-1)),qr={key:0,class:"full-width left-align"},Er=te(()=>n("b",null,"Mandatory Tags:",-1)),Fr={id:"mandatory-tag-edit"},Or={id:"delete-user-dialog-main"},zr=te(()=>n("p",{style:{color:"var(--color-danger)"}}," All data under this user will be deleted! ",-1)),Hr=te(()=>n("hr",{style:{"margin-block":"1rem"}},null,-1)),Nr={id:"create-user-main"},Wr={id:"create-user-table"},jr=te(()=>n("td",null,"Username:",-1)),Vr=te(()=>n("td",null,"Name:",-1)),Kr=te(()=>n("td",null,"Password:",-1)),Zr=te(()=>n("td",null,"Max Storage (MB):",-1)),Gr=te(()=>n("td",null,"Mandatory Tags:",-1)),Jr=te(()=>n("td",null,"Administrator:",-1)),Qr={style:{display:"flex","align-items":"center","padding-block":"0.25rem"}},Yr={id:"user-widget-header"},Xr=te(()=>n("div",null,[n("b",null," Users ")],-1)),eu={key:0},tu=te(()=>n("th",null," Avatar ",-1)),nu=te(()=>n("th",null," Username ",-1)),au=te(()=>n("th",null," Name ",-1)),su=te(()=>n("th",null," Storage ",-1)),ou=te(()=>n("th",null," Accessibility ",-1)),iu={class:"user-line"},lu={key:0},ru=["onClick"],uu=["src"],cu={class:"center full-width full-height"},du=["src"],hu={class:"username"},pu={style:{"text-align":"right"}},fu={key:1,class:"admin_hint"},mu={key:0,colspan:"5"},vu=L({__name:"UsersWidget",setup(o){const t=w([]),e=R(()=>V().user.is_admin),a=G().conn,s=w(!1),i=w({});function l($){if(!e.value)return;const b=JSON.parse(JSON.stringify($));i.value=b,i.value.max_storage/=1024*1024,s.value=!0}function r($){const b=$.split(";").map(P=>P.trim());b.length===1&&b[0]===""?i.value.mandatory_tags=[]:i.value.mandatory_tags=b}function d(){console.log(i.value),a.updateUserAccess(i.value.username,i.value.is_admin,i.value.mandatory_tags,i.value.max_storage*1024*1024).then($=>{s.value=!1},$=>{console.log($),F().showPopup($,"error")})}const g=w(!1),u=w("");function p(){if(u.value!==i.value.username){F().showPopup("Wrong input","error");return}a.deleteUser(i.value.username).then($=>{F().showPopup(`User ${i.value.username} deleted`,"info"),g.value=!1,s.value=!1},$=>{console.log($),F().showPopup($,"error")})}const f=w(!1),_=w(""),v=w(Ee[Math.floor(Math.random()*Ee.length)]),D=w(""),C=w(!1),S=w(""),h=w(100);function m(){f.value=!1,_.value="",v.value=Ee[Math.floor(Math.random()*Ee.length)],D.value="",C.value=!1,S.value=""}function k(){if(_.value===""){F().showPopup("Please enter the username","error");return}const $=S.value.split(";").map(b=>b.trim());$.length===1&&$[0]===""&&$.splice(0,1),a.createUser(_.value,v.value,D.value,C.value,$,h.value).then(b=>{F().showPopup(`User ${_.value} created`,"success"),m()},b=>{console.log(b),F().showPopup(b,"error")})}return ve(()=>{a.reqUserList().then($=>{t.value=$},$=>{console.log($)})}),le("add_user",$=>{const b=$.user_info;t.value.push(b)}),le("update_user",$=>{const b=$.user_info;t.value.map((P,q)=>{P.id===b.id&&(t.value[q]=b)})}),le("delete_user",$=>{const b=$.username;t.value=t.value.filter(P=>P.username!==b)}),($,b)=>(c(),y("div",Cr,[x($e,{show:s.value,"onUpdate:show":b[4]||(b[4]=P=>s.value=P),title:"editor",onOnAccept:d,onOnCancel:b[5]||(b[5]=()=>s.value=!1)},{default:E(()=>[n("div",Dr,[n("div",Pr,[n("img",{src:`${I(Be)()}/user-avatar/${i.value.username}?size=128`,alt:"",class:"avatar-big"},null,8,Ir),n("div",Tr,[n("div",Ur,[n("h2",null,T(i.value.name),1),M(" ("+T(i.value.username)+") ",1)]),n("div",Rr,[Ar,x(Le,{checked:i.value.is_admin,"onUpdate:checked":b[0]||(b[0]=P=>i.value.is_admin=P)},null,8,["checked"])]),n("div",Br,[Lr,Mr,z(n("input",{type:"number","onUpdate:modelValue":b[1]||(b[1]=P=>i.value.max_storage=P)},null,512),[[Z,i.value.max_storage]])]),i.value.is_admin?B("",!0):(c(),y("div",qr,[Er,n("div",Fr,[x(I(at),{style:{width:"100%"},"content-editable":!i.value.is_admin,onFinish:b[2]||(b[2]=P=>r(P))},{default:E(()=>[M(T(i.value.mandatory_tags.join("; ")),1)]),_:1},8,["content-editable"])])]))])]),n("input",{id:"delete-user-button",type:"button",value:"Delete user",onClick:b[3]||(b[3]=()=>{g.value=!0})})])]),_:1},8,["show"]),x($e,{show:g.value,"onUpdate:show":b[7]||(b[7]=P=>g.value=P),title:"Delete user",onOnCancel:b[8]||(b[8]=()=>{g.value=!1,u.value=""}),onOnClose:b[9]||(b[9]=()=>{g.value=!1,u.value=""}),onOnAccept:p},{default:E(()=>[n("div",Or,[n("p",null,[M(" Are you sure to delete user "),n("b",null,T(i.value.name)+" ("+T(i.value.username)+")",1),M("? "),zr]),Hr,M(" Type "),n("b",null,T(i.value.username),1),M(" to confirm: "),z(n("input",{type:"text",id:"delete-user-input","onUpdate:modelValue":b[6]||(b[6]=P=>u.value=P),autocomplete:"off"},null,512),[[Z,u.value]])])]),_:1},8,["show"]),x($e,{show:f.value,"onUpdate:show":b[16]||(b[16]=P=>f.value=P),onOnCancel:m,onOnAccept:k,onOnClose:m},{default:E(()=>[n("div",Nr,[n("table",Wr,[n("tr",null,[jr,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":b[10]||(b[10]=P=>_.value=P),autocomplete:"off",class:"create-user-input"},null,512),[[Z,_.value]])])]),n("tr",null,[Vr,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":b[11]||(b[11]=P=>v.value=P),autocomplete:"off",class:"create-user-input"},null,512),[[Z,v.value]])])]),n("tr",null,[Kr,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":b[12]||(b[12]=P=>D.value=P),autocomplete:"off",class:"create-user-input"},null,512),[[Z,D.value]])])]),n("tr",null,[Zr,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":b[13]||(b[13]=P=>h.value=P),autocomplete:"off",class:"create-user-input"},null,512),[[Z,h.value]])])]),n("tr",null,[Gr,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":b[14]||(b[14]=P=>S.value=P),autocomplete:"off",class:"create-user-input",placeholder:"Separate with semicolon ';'"},null,512),[[Z,S.value]])])]),n("tr",null,[Jr,n("td",Qr,[x(Le,{checked:C.value,"onUpdate:checked":b[15]||(b[15]=P=>C.value=P)},null,8,["checked"])])])])])]),_:1},8,["show"]),n("div",Yr,[Xr,e.value?(c(),y("div",{key:0,id:"add-user-div",onClick:b[17]||(b[17]=()=>f.value=!0)},"+")):B("",!0)]),n("table",null,[n("tr",null,[e.value?(c(),y("th",eu)):B("",!0),tu,nu,au,su,ou]),(c(!0),y(N,null,Q(t.value,P=>(c(),y("tr",iu,[e.value?(c(),y("td",lu,[n("div",{class:"edit-button",onClick:()=>l(P)},[n("img",{src:I(xr),alt:"",class:"icon"},null,8,uu)],8,ru)])):B("",!0),n("td",null,[n("div",cu,[n("img",{src:`${I(Be)()}/user-avatar/${P.username}?size=60`,alt:"",class:"avatar"},null,8,du)])]),n("td",hu,T(P.username),1),n("td",null,T(P.name),1),n("td",pu,T(P.max_storage/1024/1024>1024?`${(P.max_storage/1024/1024/1024).toFixed(1)} G`:`${(P.max_storage/1024/1024).toFixed(0)} M`),1),n("td",null,[P.is_admin?(c(),y("label",fu,"ADMIN")):(c(),K(et,{key:0,tags:P.mandatory_tags,"max-width":200,"middle-align":!0},null,8,["tags"]))])]))),256)),n("tr",null,[t.value.length===0?(c(),y("td",mu," No users ")):B("",!0)])])]))}}),Dt=O(vu,[["__scopeId","data-v-a87fab58"]]),ue=o=>(ne("data-v-f3cfe7c7"),o=o(),ae(),o),gu={class:"toolbar"},_u={id:"about-main",class:"slideIn"},yu=ue(()=>n("h1",null,"About",-1)),wu=ue(()=>n("div",{class:"content"},[n("p",null,[M(" Lires is a self-hosted web application for research literature management. "),n("br"),M(" It is open source and available at "),n("a",{href:"https://github.com/MenxLi/Lires",target:"_blank"},"GitHub - MenxLi/Lires"),M(". "),n("br")])],-1)),bu={class:"content"},ku=ue(()=>n("h2",null," Resources ",-1)),$u=["href"],Su=["href"],xu=["href"],Cu={key:0,class:"content"},Du=ue(()=>n("h2",null," Management ",-1)),Pu=ue(()=>n("summary",null,"Server status ",-1)),Iu=ue(()=>n("b",null,"Backend",-1)),Tu=ue(()=>n("b",null,"Version",-1)),Uu=ue(()=>n("b",null,"Uptime",-1)),Ru=ue(()=>n("b",null,"Connection count",-1)),Au=ue(()=>n("summary",null,"User management",-1)),Bu={style:{border:"1px solid var(--color-border)","border-radius":"10px",display:"flex","justify-content":"center","margin-block":"10px",padding:"10px",width:"100%"}},Lu={id:"versionHistory",class:"content"},Mu=ue(()=>n("h1",{style:{"margin-bottom":"0px"}}," Version history ",-1)),qu={class:"block"},Eu={key:0},Fu={key:1},Ou=L({__name:"About",setup(o){const t=w([]),e=w(!1),a=G().conn,s=()=>{a.changelog().then(u=>{t.value=u},u=>{console.error(u)})},i=w(-1),l=R(()=>{if(i.value===-1)return"N/A";const u=Math.floor(i.value/3600),p=Math.floor((i.value-u*3600)/60),f=Math.floor(i.value-u*3600-p*60);return`${u}h ${p}m ${f}s`}),r=w({backend:Be(),version:"",uptime:l,_uptime:-1,numDocs:-1,numConnections:-1}),d=()=>{a.status().then(u=>{i.value=u.uptime,r.value.version=u.version,r.value.numDocs=u.n_data,r.value.numConnections=u.n_connections},u=>{console.error(u)})},g=R(()=>t.value.slice().reverse());return s(),d(),window.setInterval(()=>i.value++,1e3),le("login",()=>r.value.numConnections++),le("logout",()=>r.value.numConnections--),(u,p)=>(c(),y(N,null,[n("div",gu,[x(Me)]),n("div",_u,[yu,wu,n("div",bu,[ku,n("ul",null,[n("li",null,[n("a",{href:I(ao),target:"_blank"},"User manual",8,$u)]),n("li",null,[n("a",{href:I(j)().backend()+`/api/api.zip?key=${I(j)().encKey}`},"Javascript API",8,Su)]),n("li",null,[n("a",{href:I(j)().backend()+`/api/api.py?key=${I(j)().encKey}`},"Python API",8,xu)]),n("li",null,[n("a",{onClick:p[0]||(p[0]=f=>e.value=!0),style:{cursor:"pointer"}},"Change log")])])]),I(V)().user.is_admin?(c(),y("div",Cu,[Du,n("details",null,[Pu,n("ul",null,[n("li",null,[Iu,M(": "+T(r.value.backend),1)]),n("li",null,[Tu,M(": "+T(r.value.version),1)]),n("li",null,[Uu,M(": "+T(r.value.uptime),1)]),n("li",null,[Ru,M(": "+T(r.value.numConnections),1)])])]),n("details",null,[Au,n("div",Bu,[x(Dt)])])])):B("",!0),x(Se,{show:e.value,"onUpdate:show":p[1]||(p[1]=f=>e.value=f),title:"Change log"},{default:E(()=>[n("div",Lu,[Mu,(c(!0),y(N,null,Q(g.value.length,f=>(c(),y("div",qu,[n("h2",null,T(g.value[f-1][0].toString()),1),n("ul",null,[(c(!0),y(N,null,Q(g.value[f-1][1],_=>(c(),y("li",null,[typeof _=="string"?(c(),y("div",Eu,T(_),1)):typeof _=="object"?(c(),y("div",Fu,[M(T(Object.keys(_)[0])+" ",1),n("ul",null,[(c(!0),y(N,null,Q(_[Object.keys(_)[0]],v=>(c(),y("li",null,T(v),1))),256))])])):B("",!0)]))),256))])]))),256))])]),_:1},8,["show"])])],64))}}),zu=O(Ou,[["__scopeId","data-v-f3cfe7c7"]]),Hu={},Nu={id:"widget-container-main"};function Wu(o,t){return c(),y("div",Nu,[me(o.$slots,"default",{},void 0,!0)])}const ju=O(Hu,[["render",Wu],["__scopeId","data-v-257ac3c4"]]),Vu={id:"main-dashboard",class:"slideIn"},Ku=L({__name:"Dashboard",setup(o){return(t,e)=>(c(),y(N,null,[x(Me),n("div",Vu,[x(ju,null,{default:E(()=>[x(Dt)]),_:1})])],64))}}),Zu=O(Ku,[["__scopeId","data-v-6b501763"]]),qe=o=>(ne("data-v-cde2a28d"),o=o(),ae(),o),Gu={key:0,class:"test"},Ju=qe(()=>n("td",null," Test API ",-1)),Qu=qe(()=>n("td",null," HTTP Method ",-1)),Yu=["value"],Xu=qe(()=>n("td",null," Request Body ",-1)),ec=["onUpdate:modelValue"],tc=["onUpdate:modelValue"],nc=["onClick"],ac=qe(()=>n("button",{type:"submit"},"Send Request",-1)),sc={key:0,style:{"text-align":"left"}},oc=qe(()=>n("h2",{style:{"font-weight":"bold"}},"Response",-1)),ic={key:1},lc=L({__name:"_Test",setup(o){const e=["get","post","put","delete"],a=w("post"),s=w(""),i=G().conn.fetcher,l=w([{key:"",value:""}]),r=R(()=>{const u={};return l.value.forEach(p=>{p.key&&(u[p.key]=p.value)}),u}),d=w("");async function g(){if(a.value&&s.value)try{let u;switch(a.value){case"get":u=await i.get(s.value,r.value);break;case"post":u=await i.post(s.value,r.value);break;case"delete":u=await i.delete(s.value,r.value);break;case"put":throw new Error("PUT method is not implemented yet")}d.value=await(u==null?void 0:u.json())}catch(u){console.error("HTTP request failed:",u),d.value=u.toString()}}return(u,p)=>I(!1)?(c(),y("div",Gu,[n("form",{onSubmit:Fe(g,["prevent"])},[n("table",null,[n("tr",null,[Ju,n("td",null,[z(n("input",{type:"text","onUpdate:modelValue":p[0]||(p[0]=f=>s.value=f),placeholder:"/api/xxx",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,512),[[Z,s.value]])])]),n("tr",null,[Qu,n("td",null,[z(n("select",{"onUpdate:modelValue":p[1]||(p[1]=f=>a.value=f),style:{width:"100%"}},[(c(),y(N,null,Q(e,f=>n("option",{value:f},T(f.toUpperCase()),9,Yu)),64))],512),[[Re,a.value]])])]),n("tr",null,[Xu,n("td",null,[(c(!0),y(N,null,Q(l.value,(f,_)=>(c(),y("div",{key:_,style:{display:"flex",gap:"0.5rem","margin-bottom":"0.5rem"}},[z(n("input",{type:"text","onUpdate:modelValue":v=>l.value[_].key=v,placeholder:"key",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,ec),[[Z,l.value[_].key]]),z(n("input",{type:"text","onUpdate:modelValue":v=>l.value[_].value=v,placeholder:"value",style:{"flex-grow":"1"},autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"},null,8,tc),[[Z,l.value[_].value]]),n("a",{onClick:Fe(v=>l.value.splice(_,1),["prevent"]),style:{cursor:"pointer","padding-inline":"0.5rem","border-radius":"0.5rem"}}," Remove ",8,nc)]))),128)),n("button",{onClick:p[2]||(p[2]=Fe(f=>l.value.push({key:"",value:""}),["prevent"]))},"Add Field")])])]),ac],32),d.value?(c(),y("div",sc,[oc,n("pre",null,T(d.value),1)])):B("",!0)])):(c(),y("p",ic," Test is not available in production "))}}),rc=O(lc,[["__scopeId","data-v-cde2a28d"]]),uc=[{path:"/",component:Ii},{path:"/feed",component:hl},{path:"/login",component:Hl},{path:"/reader/:id",component:Sr},{path:"/about",component:zu},{path:"/dashboard/:username",component:Zu},{path:"/_test",component:rc}],cc=Ft({history:Ot(),routes:uc}),dc=Et();qt(gn).use(dc).use(cc).mount("#app");
