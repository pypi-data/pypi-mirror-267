(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[350],{7812:function(e,t,r){Promise.resolve().then(r.bind(r,42882))},1801:function(e,t,r){"use strict";async function i(e,t){let{arg:r}=t;console.log(JSON.stringify(r));let i=await fetch(""+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!(i.status>=200&&i.status<300))throw Error(await i.text());let l=await i.json();if(!i.ok)throw Error(l.message);return l}r.d(t,{_i:function(){return l},gz:function(){return o},hw:function(){return s},sj:function(){return n},wG:function(){return i}});let l=async function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let i=await fetch(""+t[0],t[1]);if(!i.ok)throw Error(await i.text());return i.json()},n=async(e,t)=>{let r=await fetch(""+e,t);if(!r.ok)throw Error(await r.text());return r};async function s(e,t){let{arg:r}=t,i=await fetch("".concat("").concat(e,"/").concat(r),{method:"DELETE"});if(!i.ok)throw Error(await i.text());return i}async function o(e,t){let{arg:r}=t,i=await fetch("".concat("").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!i.ok)throw Error(await i.text());return i}},74333:function(e,t,r){"use strict";r.d(t,{Bf:function(){return o},JB:function(){return a},ZP:function(){return s}});var i=r(81252),l=r(1801),n=r(2265);function s(){let{data:e,error:t,isLoading:r}=(0,i.ZP)("/v1/streamers",l._i);return{isLoading:r,streamers:e}}function o(){let{data:e,error:t,isLoading:r}=(0,i.ZP)("/v1/users",l._i),[s,o]=(0,n.useState)([]);return(0,n.useEffect)(()=>{if(!e||0===e.length)return;let t=async e=>{try{let t=await (0,l._i)("/bili/space/myinfo?user=".concat(e.value),void 0),r=await (0,l.sj)("/bili/proxy?url=".concat(t.data.face)),i=await r.blob();return{...e,name:t.data.name,face:URL.createObjectURL(i)}}catch(i){console.error(i);let t=await (0,l.sj)("/bili/proxy?url=https://i0.hdslb.com/bfs/face/member/noface.jpg"),r=await t.blob();return{...e,name:"Cookie已失效",face:URL.createObjectURL(r)}}};Promise.all(e.map(t)).then(o)},[e]),{isLoading:r,isError:t,biliUsers:s}}function a(){var e;let{data:t,error:r,isLoading:n}=(0,i.ZP)("/bili/archive/pre",l._i);return{isLoading:n,isError:r,typeTree:null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.typelist.map(e=>({label:e.name,value:e.id,children:e.children}))}}},42882:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var i=r(57437),l=r(86951),n=r(30977),s=r(66488),o=r(20685),a=r(96202),c=r(74401),d=r(2265),u=r(74333),h=r(93038),m=r(1801),x=r(81252),p=e=>{let{children:t,entity:r,onOk:n}=e,s="该项为必填项",a=(0,d.useRef)(),{data:c,error:u,isLoading:p}=(0,x.ZP)("/v1/upload/streamers",m._i),[f,g]=(0,d.useState)(!1),j=()=>{g(!0)},C=async()=>{var e;let t=await (null===(e=a.current)||void 0===e?void 0:e.validate());await n(t),g(!1)},b=d.Children.map(t,e=>{if(d.isValidElement(e))return d.cloneElement(e,{onClick:()=>{var t,r;j(),null===(t=(r=e.props).onClick)||void 0===t||t.call(r)}})}),y=null==c?void 0:c.map(e=>({value:e.id,label:e.template_name}));return(0,i.jsxs)(i.Fragment,{children:[b,(0,i.jsx)(l.u_,{title:"录播管理",visible:f,onOk:C,style:{width:600},onCancel:()=>{g(!1)},bodyStyle:{overflow:"auto",maxHeight:"calc(100vh - 320px)",paddingLeft:10,paddingRight:10},children:(0,i.jsxs)(l.Form,{initValues:r,getFormApi:e=>a.current=e,children:[(0,i.jsx)(l.Form.Input,{field:"remark",label:"录播备注",trigger:"blur",rules:[{required:!0,message:s}]}),(0,i.jsx)(l.Form.Input,{field:"url",label:"直播链接",trigger:"blur",rules:[{required:!0,message:s}]}),(0,i.jsx)(l.Form.Input,{field:"filename_prefix",label:{text:"文件名模板",optional:!0},placeholder:"{streamer}%Y-%m-%d %H_%M_%S{title}"}),(0,i.jsx)(l.Form.Select,{showClear:!0,field:"upload_id",label:{text:"投稿模板",optional:!0},style:{width:176},optionList:y}),(0,i.jsx)(l.UO,{keepDOM:!0,children:(0,i.jsxs)(l.UO.Panel,{header:"更多设置",itemKey:"processors",children:[(0,i.jsx)(l.Form.Input,{field:"format",label:"视频格式",placeholder:"flv",style:{width:176},helpText:"视频保存格式。如需使用mp4格式，必须切换downloader为ffmpeg或者streamlink，youtube不支持。"}),(0,i.jsx)(l.OF,{field:"preprocessor",children:e=>{let{add:t,arrayFields:r}=e;return(0,i.jsxs)(l.Form.Section,{text:"下载前处理",children:[(0,i.jsx)("div",{className:"semi-form-field-extra",children:"开始下载直播时触发，将按自定义顺序执行自定义操作，仅支持shell指令"}),(0,i.jsx)(l.zx,{icon:(0,i.jsx)(o.Z,{}),onClick:t,theme:"light",children:"添加行"}),r.map((e,t)=>{let{field:r,key:n,remove:o}=e;return(0,i.jsxs)("div",{style:{width:1e3,display:"flex"},children:[(0,i.jsx)(l.Form.Input,{field:"".concat(r,"[run]"),label:"run = ",labelPosition:"inset",rules:[{required:!0,message:s}],style:{width:400,marginRight:16}}),(0,i.jsx)(l.zx,{type:"danger",theme:"borderless",icon:(0,i.jsx)(h.Z,{}),onClick:o,style:{margin:12}})]},n)})]})}}),(0,i.jsx)(l.OF,{field:"downloaded_processor",children:e=>{let{add:t,arrayFields:r}=e;return(0,i.jsxs)(l.Form.Section,{text:"下载后处理",children:[(0,i.jsx)("div",{className:"semi-form-field-extra",children:"准备上传直播时触发，将按自定义顺序执行自定义操作，仅支持shell指令，如果对上传的视频进行修改，需要保证和filename_prefix命名规则一致，会自动检测上传"}),(0,i.jsx)(l.zx,{icon:(0,i.jsx)(o.Z,{}),onClick:t,theme:"light",children:"添加行"}),r.map((e,t)=>{let{field:r,key:n,remove:o}=e;return(0,i.jsxs)("div",{style:{width:1e3,display:"flex"},children:[(0,i.jsx)(l.Form.Input,{field:"".concat(r,"[run]"),label:"run = ",labelPosition:"inset",rules:[{required:!0,message:s}],style:{width:400,marginRight:16}}),(0,i.jsx)(l.zx,{type:"danger",theme:"borderless",icon:(0,i.jsx)(h.Z,{}),onClick:o,style:{margin:12}})]},n)})]})}}),(0,i.jsx)(l.OF,{field:"postprocessor",children:e=>{let{add:t,arrayFields:r}=e;return(0,i.jsxs)(l.Form.Section,{text:"上传完成后处理",children:[(0,i.jsxs)("div",{className:"semi-form-field-extra",children:["上传完成后触发，将按自定义顺序执行自定义操作，当postprocessor不存在时，默认执行删除文件操作，示例：",(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"run = echo hello!"})," 执行任意命令，等同于在shell中运行,视频文件路径作为标准输入传入",(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"mv = backup/"})," 移动文件到backup目录下",(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"run = python3 path/to/mail.py"})," 执行一个 Python 脚本，可以用来发送邮件等。",(0,i.jsx)("a",{href:"https://biliup.github.io/biliup/Guide.html#%E4%B8%8A%E4%BC%A0%E5%AE%8C%E6%88%90%E5%90%8E%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5",target:"_blank",children:"自动发信通知脚本示例"}),(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"run = sh ./run.sh"})," 执行一个shell脚本，用途多样，主要调用系统内的cli工具。",(0,i.jsx)("a",{href:"https://gist.github.com/UVJkiNTQ/ae4282e8f9fe4e45b3144b57605b4178",target:"_blank",children:"自动上传网盘脚本示例"}),(0,i.jsx)("br",{}),(0,i.jsx)("code",{children:"rm"}),"  删除文件，为默认操作"]}),(0,i.jsx)(l.zx,{icon:(0,i.jsx)(o.Z,{}),onClick:t,theme:"light",children:"添加行"}),r.map((e,t)=>{var r,n;let{field:o,key:c,remove:d}=e;return(0,i.jsxs)("div",{style:{width:1e3,display:"flex"},children:[(0,i.jsxs)(l.Form.Select,{field:"".concat(o,".cmd"),label:"操作",rules:[{required:!0,message:s}],noLabel:!0,children:[(0,i.jsx)(l.Form.Select.Option,{value:"run",children:"run（运行）"}),(0,i.jsx)(l.Form.Select.Option,{value:"mv",children:"mv（移动到）"}),(0,i.jsx)(l.Form.Select.Option,{value:"rm",children:"rm（删除文件）"})]}),(null===(n=a.current)||void 0===n?void 0:null===(r=n.getValue(o))||void 0===r?void 0:r.cmd)!=="rm"?(0,i.jsx)(l.Form.Input,{field:"".concat(o,".value"),label:"=",labelPosition:"inset",rules:[{required:!0,message:s}],style:{width:300,marginRight:16}}):null,(0,i.jsx)(l.zx,{type:"danger",theme:"borderless",icon:(0,i.jsx)(h.Z,{}),onClick:d,style:{margin:12}})]},c)})]})}}),(0,i.jsx)(l.OF,{field:"opt_args",children:e=>{let{add:t,arrayFields:r}=e;return(0,i.jsxs)(l.Form.Section,{text:"ffmpeg参数",children:[(0,i.jsx)("div",{className:"semi-form-field-extra",children:'如："-ss"、"00:00:16"，每个参数需单独一行'}),(0,i.jsx)(l.zx,{icon:(0,i.jsx)(o.Z,{}),onClick:t,theme:"light",children:"添加行"}),r.map((e,t)=>{let{field:r,key:n,remove:o}=e;return(0,i.jsxs)("div",{style:{width:1e3,display:"flex"},children:[(0,i.jsx)(l.Form.Input,{field:r,label:"参数".concat(t+1),labelPosition:"left",rules:[{required:!0,message:s}]}),(0,i.jsx)(l.zx,{type:"danger",theme:"borderless",icon:(0,i.jsx)(h.Z,{}),onClick:o,style:{margin:12}})]},n)})]})}})]})})]})})]})},f=r(15584);function g(){let{Header:e,Content:t}=l.Layout,{Text:r}=l.Typography,{streamers:d,isLoading:h}=(0,u.ZP)(),{trigger:x}=(0,f.Z)("/v1/streamers",m.hw),{trigger:g}=(0,f.Z)("/v1/streamers",m.gz),{trigger:j}=(0,f.Z)("/v1/streamers",m.wG),C=async e=>{await x(e)},b=e=>((null==e?void 0:e.postprocessor)&&(e.postprocessor=e.postprocessor.map(e=>{if("rm"===e)return{cmd:"rm"};if("object"==typeof e&&!e.cmd){let[t,r]=Object.entries(e)[0];return{cmd:t,value:r}}return e})),e),y=null==d?void 0:d.map(e=>{let t;switch(e.status){case"Working":t=(0,i.jsx)(l.Vp,{color:"red",children:"直播中"});break;case"Idle":t=(0,i.jsx)(l.Vp,{color:"green",children:"空闲"});break;case"Pending":t=(0,i.jsx)(l.Vp,{color:"grey",children:"未知"});break;case"Inspecting":t=(0,i.jsx)(l.Vp,{color:"indigo",children:"检测中"})}return{...b(e),status:t}}),v=async e=>{(null==e?void 0:e.postprocessor)&&(e.postprocessor=e.postprocessor.map(e=>{let{cmd:t,value:r}=e;return"rm"===t?"rm":{[t]:r}}));try{await j(e)}catch(e){throw l.P_.error({title:"创建失败",content:(0,i.jsx)(l.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}}),e}},w=async e=>{delete e.status,(null==e?void 0:e.postprocessor)&&(e.postprocessor=e.postprocessor.map(e=>{let{cmd:t,value:r}=e;return"rm"===t?"rm":{[t]:r}}));try{await g(e)}catch(e){throw l.P_.error({title:"更新失败",content:(0,i.jsx)(l.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}}),e}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e,{style:{backgroundColor:"var(--semi-color-bg-1)",position:"sticky",top:0,zIndex:1},children:(0,i.jsx)(l.JL,{header:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{style:{backgroundColor:"rgba(var(--semi-green-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",display:"flex",padding:"6px"},children:(0,i.jsx)(n.Z,{size:"large"})}),(0,i.jsx)("h4",{style:{marginLeft:"12px"},children:"录播管理"})]}),mode:"horizontal",footer:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.zx,{theme:"borderless",icon:(0,i.jsx)(s.Z,{size:"large"}),style:{color:"var(--semi-color-text-2)",marginRight:"12px"},onClick:()=>window.location.href="/static/ds_update.log"}),(0,i.jsx)(p,{onOk:v,children:(0,i.jsx)(l.zx,{icon:(0,i.jsx)(o.Z,{}),theme:"solid",style:{marginRight:10},children:"新建"})})]})})}),(0,i.jsx)(t,{style:{padding:"24px",backgroundColor:"var(--semi-color-bg-0)"},children:(0,i.jsx)("main",{children:(0,i.jsx)(l.aV,{grid:{gutter:12,xs:20,sm:18,md:12,lg:8,xl:6,xxl:4},dataSource:y,renderItem:e=>(0,i.jsx)(l.aV.Item,{children:(0,i.jsxs)(l.Card,{shadows:"hover",style:{maxWidth:360,margin:"8px 2px",flexGrow:1},bodyStyle:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)("div",{style:{position:"absolute",right:"10%",top:9},children:e.status}),(0,i.jsxs)("div",{style:{flexGrow:1},children:[(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between"},children:(0,i.jsx)("h3",{style:{color:"var(--semi-color-text-0)",fontWeight:500,maxWidth:"60%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.remark})}),(0,i.jsx)(r,{ellipsis:{showTooltip:{opts:{style:{wordBreak:"break-all"}}}},type:"tertiary",children:e.url}),(0,i.jsx)("div",{style:{margin:"0",display:"flex",padding:"0 0 32px 0px",justifyContent:"flex-end"},children:(0,i.jsxs)(l.hE,{theme:"borderless",style:{position:"absolute",right:"10%",bottom:"15%"},children:[(0,i.jsx)(p,{onOk:w,entity:e,children:(0,i.jsx)(l.zx,{theme:"borderless",icon:(0,i.jsx)(a.Z,{})})}),(0,i.jsx)("span",{className:"semi-button-group-line semi-button-group-line-borderless semi-button-group-line-primary"}),(0,i.jsx)(l.gn,{title:"确定是否要删除？",content:"此操作将不可逆",onConfirm:async()=>await C(e.id),children:(0,i.jsx)(l.zx,{theme:"borderless",icon:(0,i.jsx)(c.Z,{})})})]})})]})]})})})})})]})}},74401:function(e,t,r){"use strict";var i=r(2265);let l=(0,r(79238).A)(function(e){return i.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 5V4H14V5H10ZM8 5V3C8 2.44772 8.44772 2 9 2H15C15.5523 2 16 2.44772 16 3V5H19H20C20.5523 5 21 5.44772 21 6C21 6.55228 20.5523 7 20 7H19V21C19 21.5523 18.5523 22 18 22H6C5.44772 22 5 21.5523 5 21V7H4C3.44772 7 3 6.55228 3 6C3 5.44772 3.44772 5 4 5H5H8ZM15 7H9H7V20H17V7H15ZM9 9.5C9 9.22386 9.22386 9 9.5 9H10.5C10.7761 9 11 9.22386 11 9.5V16.5C11 16.7761 10.7761 17 10.5 17H9.5C9.22386 17 9 16.7761 9 16.5V9.5ZM13 9.5C13 9.22386 13.2239 9 13.5 9H14.5C14.7761 9 15 9.22386 15 9.5V16.5C15 16.7761 14.7761 17 14.5 17H13.5C13.2239 17 13 16.7761 13 16.5V9.5Z",fill:"currentColor"}))},"delete_stroked");t.Z=l},96202:function(e,t,r){"use strict";var i=r(2265);let l=(0,r(79238).A)(function(e){return i.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M21.1422 4.41421L19.728 3C18.9469 2.21895 17.6806 2.21895 16.8995 3L15.4853 4.41423L14.7782 5.12132L8.31076 11.5888C8.16555 11.734 8.06856 11.9204 8.03299 12.1227L7.42936 15.5547C7.37287 15.8759 7.47654 16.2045 7.70714 16.435C7.93773 16.6656 8.26628 16.7693 8.58746 16.7128L12.0195 16.1092C12.2218 16.0736 12.4082 15.9766 12.5534 15.8314L19.0209 9.36396L19.728 8.65687L21.1422 7.24264C21.9232 6.46159 21.9232 5.19526 21.1422 4.41421ZM19.0209 6.53554L19.728 5.82843L18.3138 4.41421L17.6066 5.12132L19.0209 6.53554ZM17.6066 7.94977L16.1924 6.53555L9.9481 12.7799L9.64628 14.4959L11.3623 14.1941L17.6066 7.94977ZM2 5C2 4.44771 2.44772 4 3 4H10C10.5523 4 11 4.44771 11 5C11 5.55228 10.5523 6 10 6H4V20H18V14C18 13.4477 18.4477 13 19 13C19.5523 13 20 13.4477 20 14V21C20 21.5523 19.5523 22 19 22H3C2.44772 22 2 21.5523 2 21V5Z",fill:"currentColor"}))},"edit_2_stroked");t.Z=l},93038:function(e,t,r){"use strict";var i=r(2265);let l=(0,r(79238).A)(function(e){return i.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 23C18.0751 23 23 18.0751 23 12C23 5.92487 18.0751 1 12 1C5.92487 1 1 5.92487 1 12C1 18.0751 5.92487 23 12 23ZM6.5 10.5H17.5C18.3284 10.5 19 11.1716 19 12C19 12.8284 18.3284 13.5 17.5 13.5H6.5C5.67157 13.5 5 12.8284 5 12C5 11.1716 5.67157 10.5 6.5 10.5Z",fill:"currentColor"}))},"minus_circle");t.Z=l},30977:function(e,t,r){"use strict";var i=r(2265);let l=(0,r(79238).A)(function(e){return i.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 2C2.89543 2 2 2.89543 2 4V20C2 21.1046 2.89543 22 4 22H11C11.5523 22 12 21.5523 12 21C12 20.4477 11.5523 20 11 20H4V4L20 4V14C20 14.5523 20.4477 15 21 15C21.5523 15 22 14.5523 22 14V4C22 2.89543 21.1046 2 20 2H4ZM9.49614 7.13176C9.18664 6.9549 8.80639 6.95617 8.49807 7.13509C8.18976 7.31401 8 7.64353 8 8V16C8 16.3565 8.18976 16.686 8.49807 16.8649C8.80639 17.0438 9.18664 17.0451 9.49614 16.8682L16.4961 12.8682C16.8077 12.6902 17 12.3589 17 12C17 11.6411 16.8077 11.3098 16.4961 11.1318L9.49614 7.13176ZM13.9844 12L10 14.2768V9.72318L13.9844 12ZM14.5 17C14.2239 17 14 17.2239 14 17.5V18.5C14 18.7761 14.2239 19 14.5 19H15.5C15.7761 19 16 18.7761 16 18.5V17.5C16 17.2239 15.7761 17 15.5 17H14.5ZM14.5 20C14.2239 20 14 20.2239 14 20.5V21.5C14 21.7761 14.2239 22 14.5 22H15.5C15.7761 22 16 21.7761 16 21.5V20.5C16 20.2239 15.7761 20 15.5 20H14.5ZM17 17.5C17 17.2239 17.2239 17 17.5 17H21.5C21.7761 17 22 17.2239 22 17.5V18.5C22 18.7761 21.7761 19 21.5 19H17.5C17.2239 19 17 18.7761 17 18.5V17.5ZM17.5 20C17.2239 20 17 20.2239 17 20.5V21.5C17 21.7761 17.2239 22 17.5 22H21.5C21.7761 22 22 21.7761 22 21.5V20.5C22 20.2239 21.7761 20 21.5 20H17.5Z",fill:"currentColor"}))},"video_list_stroked");t.Z=l}},function(e){e.O(0,[951,252,562,971,69,744],function(){return e(e.s=7812)}),_N_E=e.O()}]);